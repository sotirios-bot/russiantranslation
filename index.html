<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Best AI English to Russian Translator</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: #f0f4ff;
      min-height: 100vh;
      color: #1a1a2e;
    }

    /* â”€â”€ PAGE LAYOUT (left ad | content | right ad) â”€â”€ */
    .page-wrap {
      display: grid;
      grid-template-columns: 160px 1fr 160px;
      gap: 20px;
      max-width: 1320px;
      margin: 0 auto;
      padding: 0 12px;
      align-items: start;
    }

    /* â”€â”€ AD BANNERS â”€â”€ */
    .ad-banner {
      position: sticky;
      top: 20px;
      width: 160px;
      min-height: 600px;
      background: #fff;
      border: 2px dashed #c0d0f0;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: #a0b0d0;
      font-size: 0.78rem;
      font-weight: 600;
      text-align: center;
      letter-spacing: 0.5px;
      padding: 16px;
      margin-top: 24px;
    }
    .ad-banner .ad-icon { font-size: 2rem; opacity: 0.5; }
    .ad-banner .ad-label { text-transform: uppercase; font-size: 0.68rem; letter-spacing: 1px; color: #b0bcd8; }
    .ad-banner .ad-size { font-size: 0.72rem; color: #c0cce8; }

    @media (max-width: 1000px) {
      .page-wrap { grid-template-columns: 1fr; }
      .ad-banner { display: none; }
    }

    /* â”€â”€ MAIN CONTENT â”€â”€ */
    .app { padding: 24px 0 40px; }

    /* â”€â”€ HEADER â”€â”€ */
    header { text-align: center; padding: 20px 0 28px; }
    header h1 {
      font-size: 2.2rem;
      font-weight: 800;
      color: #2253cb;
      letter-spacing: -0.5px;
      line-height: 1.2;
    }
    header p {
      color: #5570a0;
      margin-top: 10px;
      font-size: 0.95rem;
      max-width: 680px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.65;
    }

    /* â”€â”€ CARD â”€â”€ */
    .card {
      background: #fff;
      border: 1px solid #d0dcf5;
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 18px;
      box-shadow: 0 4px 20px rgba(34,83,203,0.07);
    }

    /* â”€â”€ DIRECTION TOGGLE â”€â”€ */
    .direction-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 18px;
      margin-bottom: 24px;
    }
    .lang-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f0f4ff;
      border: 2px solid #d0dcf5;
      border-radius: 50px;
      padding: 10px 22px;
      font-size: 1rem;
      font-weight: 600;
      min-width: 150px;
      justify-content: center;
      color: #3a4a7a;
      transition: all 0.2s;
    }
    .lang-pill.active-lang { border-color: #2253cb; color: #2253cb; background: #eaf0ff; }
    .swap-btn {
      background: #2253cb;
      border: none;
      border-radius: 50%;
      width: 48px; height: 48px;
      font-size: 1.3rem;
      cursor: pointer;
      color: #fff;
      transition: transform 0.3s, box-shadow 0.2s, background 0.2s;
      flex-shrink: 0;
      box-shadow: 0 4px 14px rgba(34,83,203,0.3);
    }
    .swap-btn:hover { transform: rotate(180deg); box-shadow: 0 6px 20px rgba(34,83,203,0.45); background: #1a40a8; }

    /* â”€â”€ GENDER SELECTORS â”€â”€ */
    .gender-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 22px; }
    .gender-box label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: #7a8fb5;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .gender-btns { display: flex; gap: 8px; }
    .g-btn {
      flex: 1;
      padding: 10px 8px;
      border: 2px solid #d0dcf5;
      border-radius: 12px;
      background: #f8faff;
      color: #7a8fb5;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      text-align: center;
      font-weight: 500;
    }
    .g-btn:hover { border-color: #2253cb; color: #2253cb; background: #eaf0ff; }
    .g-btn.on {
      background: #eaf0ff;
      border-color: #2253cb;
      color: #2253cb;
      font-weight: 700;
      box-shadow: 0 0 0 3px rgba(34,83,203,0.1);
    }

    /* â”€â”€ INPUT â”€â”€ */
    .input-wrap { position: relative; }
    textarea {
      width: 100%;
      min-height: 130px;
      background: #f8faff;
      border: 2px solid #d0dcf5;
      border-radius: 14px;
      padding: 16px;
      color: #1a1a2e;
      font-size: 1.05rem;
      font-family: inherit;
      resize: vertical;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      line-height: 1.6;
    }
    textarea:focus { border-color: #2253cb; box-shadow: 0 0 0 3px rgba(34,83,203,0.1); background: #fff; }
    textarea::placeholder { color: #b0bcd8; }
    .char-count { text-align: right; font-size: 0.78rem; color: #b0bcd8; margin-top: 5px; }

    /* â”€â”€ TRANSLATE BTN â”€â”€ */
    .translate-btn {
      width: 100%;
      padding: 16px;
      background: #2253cb;
      border: none;
      border-radius: 14px;
      color: #fff;
      font-size: 1.05rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      cursor: pointer;
      margin-top: 14px;
      transition: all 0.2s;
      box-shadow: 0 4px 16px rgba(34,83,203,0.3);
    }
    .translate-btn:hover:not(:disabled) { background: #1a40a8; transform: translateY(-2px); box-shadow: 0 8px 24px rgba(34,83,203,0.4); }
    .translate-btn:disabled { opacity: 0.55; cursor: not-allowed; transform: none; }
    .hint { text-align: center; font-size: 0.75rem; color: #b0bcd8; margin-top: 8px; }
    .hint kbd {
      background: #eaf0ff;
      border: 1px solid #d0dcf5;
      border-radius: 4px;
      padding: 1px 5px;
      color: #2253cb;
      font-size: 0.72rem;
    }

    /* â”€â”€ LOADING â”€â”€ */
    .loading { display: none; text-align: center; padding: 30px; color: #7a8fb5; }
    .loading.show { display: block; }
    .spinner {
      display: inline-block;
      width: 36px; height: 36px;
      border: 3px solid rgba(34,83,203,0.15);
      border-top-color: #2253cb;
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ RESULTS â”€â”€ */
    .results { display: none; }
    .results.show { display: block; }
    .results-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
      font-size: 0.78rem;
      color: #7a8fb5;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      font-weight: 700;
    }
    .results-header::before, .results-header::after { content: ''; flex: 1; height: 1px; background: #d0dcf5; }

    /* â”€â”€ 2-COLUMN RESULTS â”€â”€ */
    .results-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-bottom: 18px;
    }
    @media (max-width: 600px) { .results-grid { grid-template-columns: 1fr; } }

    .result-card {
      border-radius: 16px;
      padding: 20px;
      border: 2px solid;
      background: #fff;
      position: relative;
      box-shadow: 0 2px 12px rgba(34,83,203,0.06);
    }
    .result-card.formal { border-color: rgba(34,83,203,0.3);  background: #fafcff; }
    .result-card.casual { border-color: rgba(251,146,60,0.35); background: #fffaf6; }

    .rc-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .rc-label { font-size: 0.72rem; text-transform: uppercase; letter-spacing: 1.2px; font-weight: 700; }
    .formal .rc-label { color: #2253cb; }
    .casual .rc-label { color: #ea7000; }

    .copy-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      opacity: 0.4;
      transition: opacity 0.2s, transform 0.2s;
      padding: 2px;
    }
    .copy-btn:hover { opacity: 1; transform: scale(1.2); }

    .rc-text { font-size: 1.05rem; line-height: 1.75; color: #1a1a2e; min-height: 52px; }
    .rc-note { font-size: 0.78rem; color: #9aadcc; margin-top: 8px; font-style: italic; }

    /* â”€â”€ BREAKDOWN â”€â”€ */
    .breakdown-card {
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid #d0dcf5;
      background: #fff;
      box-shadow: 0 2px 12px rgba(34,83,203,0.06);
    }
    .breakdown-title {
      padding: 16px 22px 12px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: #7a8fb5;
      font-weight: 700;
      border-bottom: 1px solid #eaf0ff;
      background: #fafcff;
    }
    table { width: 100%; border-collapse: collapse; }
    thead th {
      padding: 10px 18px;
      text-align: left;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #9aadcc;
      background: #f8faff;
      border-bottom: 1px solid #eaf0ff;
      font-weight: 700;
    }
    tbody tr { transition: background 0.15s; }
    tbody tr:hover { background: #f8faff; }
    tbody td { padding: 11px 18px; border-bottom: 1px solid #f0f4ff; font-size: 0.93rem; vertical-align: middle; }
    tbody tr:last-child td { border-bottom: none; }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .tag-verb   { background: rgba(34,83,203,0.1);  color: #2253cb; }
    .tag-noun   { background: rgba(234,112,0,0.1);  color: #ea7000; }
    .tag-phrase { background: rgba(26,158,92,0.1);  color: #1a9e5c; }
    .tag-adj    { background: rgba(160,50,220,0.1); color: #a032dc; }
    .tag-adv    { background: rgba(220,150,0,0.1);  color: #c68800; }

    .orig-word  { color: #3a4a7a; font-weight: 500; }
    .trans-word { color: #2253cb; font-weight: 700; }
    .note-cell  { color: #9aadcc; font-size: 0.82rem; }

    /* â”€â”€ FAQ â”€â”€ */
    .faq-section { margin: 32px 0 24px; }
    .faq-title {
      font-size: 1.35rem;
      font-weight: 800;
      color: #2253cb;
      margin-bottom: 18px;
      text-align: center;
    }
    .faq-item {
      background: #fff;
      border: 1px solid #d0dcf5;
      border-radius: 14px;
      margin-bottom: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(34,83,203,0.05);
    }
    .faq-q {
      width: 100%;
      background: none;
      border: none;
      padding: 16px 20px;
      text-align: left;
      font-size: 0.97rem;
      font-weight: 600;
      color: #1a1a2e;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      transition: background 0.2s;
    }
    .faq-q:hover { background: #f0f4ff; }
    .faq-q.open { color: #2253cb; background: #eaf0ff; }
    .faq-icon { font-size: 1rem; flex-shrink: 0; transition: transform 0.25s; color: #2253cb; }
    .faq-q.open .faq-icon { transform: rotate(45deg); }
    .faq-a {
      display: none;
      padding: 0 20px 16px;
      font-size: 0.93rem;
      color: #5570a0;
      line-height: 1.7;
      border-top: 1px solid #eaf0ff;
      padding-top: 14px;
    }
    .faq-a.open { display: block; }

    /* â”€â”€ TOAST â”€â”€ */
    #toast {
      position: fixed;
      bottom: 24px; right: 24px;
      background: #2253cb;
      border-radius: 10px;
      padding: 10px 18px;
      font-size: 0.88rem;
      color: #fff;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.25s, transform 0.25s;
      pointer-events: none;
      z-index: 9999;
      box-shadow: 0 4px 16px rgba(34,83,203,0.35);
    }
    #toast.show { opacity: 1; transform: translateY(0); }

    /* â”€â”€ FOOTER â”€â”€ */
    footer {
      text-align: center;
      padding: 24px 0 16px;
      border-top: 1px solid #d0dcf5;
      margin-top: 10px;
    }
    .footer-brand { font-size: 0.88rem; font-weight: 700; color: #2253cb; letter-spacing: 1px; text-transform: uppercase; }
    .footer-address { font-size: 0.78rem; color: #9aadcc; margin-top: 4px; }
  </style>
</head>
<body>

<div class="page-wrap">

  <!-- LEFT AD -->
  <div class="ad-banner">
    <div class="ad-icon">ğŸ“¢</div>
    <div class="ad-label">Advertisement</div>
    <div class="ad-size">160 Ã— 600</div>
    <div style="margin-top:8px; font-size:0.7rem; color:#c0cce8;">AdSense / Yandex<br>Banner Here</div>
  </div>

  <!-- MAIN CONTENT -->
  <div class="app">

    <header>
      <h1>ğŸ‡¬ğŸ‡§ â†” ğŸ‡·ğŸ‡º Best AI English to Russian Translator</h1>
      <p id="subheading">âœ¨ Smart English to Russian and Russian to English translations with gender context, formality levels &amp; learning breakdowns âœ¨</p>
    </header>

    <!-- INPUT CARD -->
    <div class="card">

      <div class="direction-row">
        <div class="lang-pill active-lang" id="srcPill">ğŸ‡¬ğŸ‡§ English</div>
        <button class="swap-btn" onclick="swapDirection()" title="Swap languages">â‡„</button>
        <div class="lang-pill" id="tgtPill">ğŸ‡·ğŸ‡º Russian</div>
      </div>

      <div class="gender-row">
        <div class="gender-box">
          <label id="speakerLabel">ğŸ‘¤ I am speaking as...</label>
          <div class="gender-btns">
            <button class="g-btn on" id="sp-m" onclick="setGender('speaker','male')"><span id="maleLabel1">ğŸ‘¨ Male</span></button>
            <button class="g-btn"    id="sp-f" onclick="setGender('speaker','female')"><span id="femaleLabel1">ğŸ‘© Female</span></button>
          </div>
        </div>
        <div class="gender-box">
          <label id="listenerLabel">ğŸ—£ï¸ I am talking to...</label>
          <div class="gender-btns">
            <button class="g-btn on" id="ls-m" onclick="setGender('listener','male')"><span id="maleLabel2">ğŸ‘¨ Male</span></button>
            <button class="g-btn"    id="ls-f" onclick="setGender('listener','female')"><span id="femaleLabel2">ğŸ‘© Female</span></button>
          </div>
        </div>
      </div>

      <div class="input-wrap">
        <textarea id="inputText" placeholder="âœï¸  Type or paste your text here..." oninput="countChars()"></textarea>
        <div class="char-count"><span id="charNum">0</span> <span id="charsLabel">characters</span></div>
      </div>

      <button class="translate-btn" id="translateBtn" onclick="doTranslate()">
        ğŸ”„ &nbsp;<span id="translateBtnText">Translate</span>
      </button>
      <p class="hint">Press <kbd>Enter</kbd> or <kbd>Ctrl+Enter</kbd> to translate</p>

    </div>

    <!-- LOADING -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="margin-top:12px; color:#7a8fb5;" id="loadingText">Translatingâ€¦ ğŸŒ</p>
    </div>

    <!-- RESULTS -->
    <div class="results" id="results">

      <div class="results-header" id="resultsHeader">âœ¨ Translations</div>

      <div class="results-grid">
        <div class="result-card formal">
          <div class="rc-head">
            <span class="rc-label" id="formalLabel">ğŸ© Formal</span>
            <button class="copy-btn" onclick="copyCard('formalText')" title="Copy">ğŸ“‹</button>
          </div>
          <div class="rc-text" id="formalText"></div>
          <div class="rc-note" id="formalNote"></div>
        </div>
        <div class="result-card casual">
          <div class="rc-head">
            <span class="rc-label" id="casualLabel">ğŸ˜Š Casual</span>
            <button class="copy-btn" onclick="copyCard('casualText')" title="Copy">ğŸ“‹</button>
          </div>
          <div class="rc-text" id="casualText"></div>
          <div class="rc-note" id="casualNote"></div>
        </div>
      </div>

      <!-- WORD BREAKDOWN -->
      <div class="breakdown-card">
        <div class="breakdown-title" id="breakdownTitle">ğŸ“š Word &amp; Phrase Breakdown â€” for learning</div>
        <table>
          <thead>
            <tr>
              <th id="thType">Type</th>
              <th id="thOrig">Original</th>
              <th id="thTrans">Translation</th>
              <th id="thNotes">Notes</th>
            </tr>
          </thead>
          <tbody id="breakdownBody">
            <tr><td colspan="4" style="padding:14px 18px; color:#b0bcd8;">Readyâ€¦</td></tr>
          </tbody>
        </table>
      </div>

    </div><!-- /results -->

    <!-- FAQ -->
    <div class="faq-section">
      <div class="faq-title" id="faqTitle">â“ Frequently Asked Questions</div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸŒ How accurate is this English to Russian translator?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">This translator uses Google's translation engine to deliver high-quality, context-aware results. It handles everyday language, business phrases, and conversational text well. For highly specialised legal or medical content, we always recommend a professional review.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸ© What is the difference between formal and casual Russian?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">Formal Russian uses <strong>Ğ’Ñ‹</strong> (capitalised "you") when addressing someone with respect â€” in business, with strangers, or elders. Casual Russian uses <strong>Ñ‚Ñ‹</strong> with friends, family, and peers. Choosing the wrong form can come across as rude or overly stiff, which is why this translator gives you both options.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸ‘© Why does gender matter in Russian translation?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">Russian grammar assigns grammatical gender to nouns, and past-tense verbs must agree with the speaker's gender. For example, "I went" is <strong>Ñ Ğ¿Ğ¾ÑˆÑ‘Ğ»</strong> (male) or <strong>Ñ Ğ¿Ğ¾ÑˆĞ»Ğ°</strong> (female). Selecting your gender ensures the translation is grammatically correct for you personally.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸ’¼ Can I use this translator for business communications?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">Yes! The <strong>Formal</strong> translation mode is specifically designed for professional and business contexts. It uses the polite Ğ’Ñ‹ form and appropriate vocabulary for emails, letters, and meetings. Always select "Formal" when writing to clients, managers, or official contacts.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸ“š What does the Word Breakdown section do?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">The Word &amp; Phrase Breakdown translates individual key words and common phrases from your text separately. Each word is labelled as a verb, noun, adjective, or phrase â€” making it a powerful tool for anyone learning Russian or English, helping you understand the building blocks of the translation.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸ”„ Can I translate Russian back to English?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">Absolutely. Click the <strong>â‡„ swap button</strong> between the language pills to switch from English â†’ Russian to Russian â†’ English. The entire interface â€” including labels, buttons, and breakdown tags â€” switches to Russian so you always work in your source language.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>âš¡ How do I translate quickly without using the mouse?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">Simply press <strong>Enter</strong> after typing your text to trigger the translation instantly. You can also use <strong>Ctrl + Enter</strong>. This makes the translator feel like a fast, keyboard-native tool â€” no clicking required.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸ†“ Is this translator free to use?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">Yes â€” this translator is completely free. There are no subscriptions, no sign-ups, and no usage limits for normal use. It is powered by open translation technology and developed by <strong>Mytheon Technologies</strong>, based in Almaty, Kazakhstan.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸ“ Is Russian grammar very different from English?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">Yes, significantly. Russian is a highly inflected language â€” nouns, adjectives, and pronouns change their endings depending on their role in the sentence (called <strong>cases</strong>). There are 6 grammatical cases, 3 genders, and verb conjugations that depend on tense and the speaker's gender. This is why context-aware translation matters so much.</div>
      </div>

      <div class="faq-item">
        <button class="faq-q" onclick="toggleFaq(this)">
          <span>ğŸ—£ï¸ Why should I select who I am talking to?</span>
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-a">In Russian, certain adjectives and terms of address change depending on the gender of the person you are speaking to. For example, "Dear" is <strong>Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹</strong> for a male and <strong>Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ</strong> for a female. Selecting the listener's gender ensures these forms are correct and natural-sounding.</div>
      </div>

    </div><!-- /faq -->

    <footer>
      <div class="footer-brand">âš¡ Powered by MYTHEON TECHNOLOGIES</div>
      <div class="footer-address">133/1 Gagarin Avenue, Almaty, Kazakhstan</div>
    </footer>

  </div><!-- /app -->

  <!-- RIGHT AD -->
  <div class="ad-banner">
    <div class="ad-icon">ğŸ“¢</div>
    <div class="ad-label">Advertisement</div>
    <div class="ad-size">160 Ã— 600</div>
    <div style="margin-top:8px; font-size:0.7rem; color:#c0cce8;">AdSense / Yandex<br>Banner Here</div>
  </div>

</div><!-- /page-wrap -->

<div id="toast">ğŸ“‹ Copied!</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let direction    = 'en-ru';
let speakerGend  = 'male';
let listenerGend = 'male';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI STRINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LANG = {
  'en-ru': {
    speakerLabel:'ğŸ‘¤ I am speaking as...',listenerLabel:'ğŸ—£ï¸ I am talking to...',
    male:'ğŸ‘¨ Male',female:'ğŸ‘© Female',
    placeholder:'âœï¸  Type or paste your text here...',
    charsLabel:'characters',translateBtn:'Translate',
    loading:'Translatingâ€¦ ğŸŒ',resultsHeader:'âœ¨ Translations',
    formalLabel:'ğŸ© Formal',casualLabel:'ğŸ˜Š Casual',
    breakdownTitle:'ğŸ“š Word & Phrase Breakdown â€” for learning',
    thType:'Type',thOrig:'Original',thTrans:'Translation',thNotes:'Notes',
    analysing:'ğŸ” Analysingâ€¦',noBreakdown:'No breakdown available.',
    noText:'âœï¸ Please type some text first!',copied:'ğŸ“‹ Copied!',
    tagVerb:'Verb',tagNoun:'Noun',tagAdj:'Adj',tagAdv:'Adverb',tagPhrase:'Phrase',
    noteVerbF:'ğŸ‘© fem. form',noteNoun:'ğŸ“Œ learn gender',notePhrase:'ğŸ’¬ Phrase',
    formalNote:'ğŸ© Polite "Ğ’Ñ‹" form â€” use in business &amp; with strangers',
    casualNote:'ğŸ˜Š Friendly "Ñ‚Ñ‹" form â€” use with friends &amp; family',
    formalNoteRu:'ğŸ© Direct translation',casualNoteRu:'ğŸ˜Š Casual Russian form',
    faqTitle:'â“ Frequently Asked Questions',
    errText:'âŒ Translation failed â€” check your connection.',
  },
  'ru-en': {
    speakerLabel:'ğŸ‘¤ Ğ¯ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ ĞºĞ°Ğº...',listenerLabel:'ğŸ—£ï¸ Ğ¯ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ°Ñ€Ğ¸Ğ²Ğ°Ñ Ñ...',
    male:'ğŸ‘¨ ĞœÑƒĞ¶Ñ‡Ğ¸Ğ½Ğ°',female:'ğŸ‘© Ğ–ĞµĞ½Ñ‰Ğ¸Ğ½Ğ°',
    placeholder:'âœï¸  Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ·Ğ´ĞµÑÑŒ...',
    charsLabel:'ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²',translateBtn:'ĞŸĞµÑ€ĞµĞ²ĞµÑÑ‚Ğ¸',
    loading:'ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ğ¼â€¦ ğŸŒ',resultsHeader:'âœ¨ ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹',
    formalLabel:'ğŸ© ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹',casualLabel:'ğŸ˜Š ĞĞµÑ„Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹',
    breakdownTitle:'ğŸ“š Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ ÑĞ»Ğ¾Ğ² Ğ¸ Ñ„Ñ€Ğ°Ğ· â€” Ğ´Ğ»Ñ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ',
    thType:'Ğ¢Ğ¸Ğ¿',thOrig:'ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»',thTrans:'ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´',thNotes:'Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸',
    analysing:'ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼â€¦',noBreakdown:'Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.',
    noText:'âœï¸ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚!',copied:'ğŸ“‹ Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!',
    tagVerb:'Ğ“Ğ»Ğ°Ğ³Ğ¾Ğ»',tagNoun:'Ğ¡ÑƒÑ‰ĞµÑÑ‚.',tagAdj:'ĞŸÑ€Ğ¸Ğ»Ğ°Ğ³.',tagAdv:'ĞĞ°Ñ€ĞµÑ‡Ğ¸Ğµ',tagPhrase:'Ğ¤Ñ€Ğ°Ğ·Ğ°',
    noteVerbF:'ğŸ‘© Ğ¶ĞµĞ½ÑĞºĞ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°',noteNoun:'ğŸ“Œ Ğ·Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ Ñ€Ğ¾Ğ´',notePhrase:'ğŸ’¬ Ğ¤Ñ€Ğ°Ğ·Ğ°',
    formalNote:'ğŸ© ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´',casualNote:'ğŸ˜Š Ğ˜Ğ· Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ñ‹',
    formalNoteRu:'ğŸ© ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´',casualNoteRu:'ğŸ˜Š Ğ˜Ğ· Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ñ‹',
    faqTitle:'â“ Ğ§Ğ°ÑÑ‚Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹',
    errText:'âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ.',
  }
};
const t = k => LANG[direction][k] || LANG['en-ru'][k];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPDATE ALL UI TEXT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateUI() {
  document.getElementById('speakerLabel').textContent    = t('speakerLabel');
  document.getElementById('listenerLabel').textContent   = t('listenerLabel');
  document.getElementById('maleLabel1').textContent      = t('male');
  document.getElementById('femaleLabel1').textContent    = t('female');
  document.getElementById('maleLabel2').textContent      = t('male');
  document.getElementById('femaleLabel2').textContent    = t('female');
  document.getElementById('inputText').placeholder       = t('placeholder');
  document.getElementById('charsLabel').textContent      = t('charsLabel');
  document.getElementById('translateBtnText').textContent= t('translateBtn');
  document.getElementById('loadingText').textContent     = t('loading');
  document.getElementById('resultsHeader').textContent   = t('resultsHeader');
  document.getElementById('formalLabel').textContent     = t('formalLabel');
  document.getElementById('casualLabel').textContent     = t('casualLabel');
  document.getElementById('breakdownTitle').textContent  = t('breakdownTitle');
  document.getElementById('thType').textContent          = t('thType');
  document.getElementById('thOrig').textContent          = t('thOrig');
  document.getElementById('thTrans').textContent         = t('thTrans');
  document.getElementById('thNotes').textContent         = t('thNotes');
  document.getElementById('faqTitle').textContent        = t('faqTitle');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function countChars() {
  document.getElementById('charNum').textContent = document.getElementById('inputText').value.length;
}

function swapDirection() {
  direction = direction === 'en-ru' ? 'ru-en' : 'en-ru';
  document.getElementById('srcPill').textContent = direction === 'en-ru' ? 'ğŸ‡¬ğŸ‡§ English' : 'ğŸ‡·ğŸ‡º Russian';
  document.getElementById('tgtPill').textContent = direction === 'en-ru' ? 'ğŸ‡·ğŸ‡º Russian' : 'ğŸ‡¬ğŸ‡§ English';
  document.getElementById('srcPill').classList.add('active-lang');
  document.getElementById('tgtPill').classList.remove('active-lang');
  document.getElementById('results').classList.remove('show');
  document.getElementById('inputText').value = '';
  countChars();
  updateUI();
}

function setGender(role, val) {
  if (role === 'speaker') {
    speakerGend = val;
    document.getElementById('sp-m').classList.toggle('on', val === 'male');
    document.getElementById('sp-f').classList.toggle('on', val === 'female');
  } else {
    listenerGend = val;
    document.getElementById('ls-m').classList.toggle('on', val === 'male');
    document.getElementById('ls-f').classList.toggle('on', val === 'female');
  }
}

function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg || t('copied');
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 1800);
}

async function copyCard(id) {
  const text = document.getElementById(id).textContent;
  try { await navigator.clipboard.writeText(text); }
  catch {
    const ta = Object.assign(document.createElement('textarea'), { value: text });
    document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
  }
  showToast(t('copied'));
}

function toggleFaq(btn) {
  const ans = btn.nextElementSibling;
  const isOpen = btn.classList.contains('open');
  // close all
  document.querySelectorAll('.faq-q.open').forEach(b => {
    b.classList.remove('open');
    b.nextElementSibling.classList.remove('open');
  });
  if (!isOpen) {
    btn.classList.add('open');
    ans.classList.add('open');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRANSLATION API â€” Google Translate (unofficial)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function fetchGoogle(text, sl, tl) {
  const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sl}&tl=${tl}&dt=t&q=${encodeURIComponent(text)}`;
  const r = await fetch(url);
  if (!r.ok) throw new Error('HTTP ' + r.status);
  const d = await r.json();
  // Join all translation segments
  return d[0].map(seg => seg[0]).join('');
}

const delay = ms => new Promise(res => setTimeout(res, ms));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RUSSIAN GRAMMAR HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TY_TO_VY = [
  [/\bÑ‚Ñ‹\b/g,'Ğ’Ñ‹'],[/\bÑ‚ĞµĞ±Ñ\b/g,'Ğ’Ğ°Ñ'],[/\bÑ‚ĞµĞ±Ğµ\b/g,'Ğ’Ğ°Ğ¼'],
  [/\bÑ‚Ğ¾Ğ±Ğ¾Ğ¹\b/g,'Ğ’Ğ°Ğ¼Ğ¸'],[/\bÑ‚Ğ²Ğ¾Ğ¹\b/g,'Ğ’Ğ°Ñˆ'],[/\bÑ‚Ğ²Ğ¾Ñ\b/g,'Ğ’Ğ°ÑˆĞ°'],
  [/\bÑ‚Ğ²Ğ¾Ñ‘\b/g,'Ğ’Ğ°ÑˆĞµ'],[/\bÑ‚Ğ²Ğ¾Ğ¸\b/g,'Ğ’Ğ°ÑˆĞ¸'],[/\bÑ‚Ğ²Ğ¾ĞµĞ³Ğ¾\b/g,'Ğ’Ğ°ÑˆĞµĞ³Ğ¾'],
  [/\bÑ‚Ğ²Ğ¾ĞµĞ¹\b/g,'Ğ’Ğ°ÑˆĞµĞ¹'],[/\bÑ‚Ğ²Ğ¾ĞµĞ¼Ñƒ\b/g,'Ğ’Ğ°ÑˆĞµĞ¼Ñƒ'],
];
const VY_TO_TY = [
  [/\bĞ’Ñ‹\b/g,'Ñ‚Ñ‹'],[/\bĞ’Ğ°Ñ\b/g,'Ñ‚ĞµĞ±Ñ'],[/\bĞ’Ğ°Ğ¼\b/g,'Ñ‚ĞµĞ±Ğµ'],
  [/\bĞ’Ğ°Ğ¼Ğ¸\b/g,'Ñ‚Ğ¾Ğ±Ğ¾Ğ¹'],[/\bĞ’Ğ°Ñˆ\b/g,'Ñ‚Ğ²Ğ¾Ğ¹'],[/\bĞ’Ğ°ÑˆĞ°\b/g,'Ñ‚Ğ²Ğ¾Ñ'],
  [/\bĞ’Ğ°ÑˆĞµ\b/g,'Ñ‚Ğ²Ğ¾Ñ‘'],[/\bĞ’Ğ°ÑˆĞ¸\b/g,'Ñ‚Ğ²Ğ¾Ğ¸'],[/\bĞ’Ğ°ÑˆĞµĞ³Ğ¾\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ³Ğ¾'],
  [/\bĞ’Ğ°ÑˆĞµĞ¹\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ¹'],[/\bĞ’Ğ°ÑˆĞµĞ¼Ñƒ\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ¼Ñƒ'],
];
const GENDER_MAP_F = [
  [/\bĞ¿Ñ€Ğ¸ÑˆÑ‘Ğ»\b/g,'Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ°'],[/\bÑƒÑˆÑ‘Ğ»\b/g,'ÑƒÑˆĞ»Ğ°'],[/\bĞ½Ğ°ÑˆÑ‘Ğ»\b/g,'Ğ½Ğ°ÑˆĞ»Ğ°'],
  [/\bĞ±Ñ‹Ğ»\b/g,'Ğ±Ñ‹Ğ»Ğ°'],[/\bÑĞºĞ°Ğ·Ğ°Ğ»\b/g,'ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°'],[/\bĞ¿Ğ¾ĞµÑ…Ğ°Ğ»\b/g,'Ğ¿Ğ¾ĞµÑ…Ğ°Ğ»Ğ°'],
  [/\bĞ¿Ñ€Ğ¸ĞµÑ…Ğ°Ğ»\b/g,'Ğ¿Ñ€Ğ¸ĞµÑ…Ğ°Ğ»Ğ°'],[/\bÑĞ´ĞµĞ»Ğ°Ğ»\b/g,'ÑĞ´ĞµĞ»Ğ°Ğ»Ğ°'],[/\bĞ¿Ğ¾ÑˆÑ‘Ğ»\b/g,'Ğ¿Ğ¾ÑˆĞ»Ğ°'],
  [/\bÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»\b/g,'Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ°'],[/\bĞ·Ğ½Ğ°Ğ»\b/g,'Ğ·Ğ½Ğ°Ğ»Ğ°'],[/\bĞ´ÑƒĞ¼Ğ°Ğ»\b/g,'Ğ´ÑƒĞ¼Ğ°Ğ»Ğ°'],
  [/\bÑ…Ğ¾Ñ‚ĞµĞ»\b/g,'Ñ…Ğ¾Ñ‚ĞµĞ»Ğ°'],[/\bĞ¼Ğ¾Ğ³\b/g,'Ğ¼Ğ¾Ğ³Ğ»Ğ°'],[/\bÑƒÑÑ‚Ğ°Ğ»\b/g,'ÑƒÑÑ‚Ğ°Ğ»Ğ°'],
  [/\bÑ€Ğ°Ğ´\b/g,'Ñ€Ğ°Ğ´Ğ°'],[/\bĞ¿Ğ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ğ»\b/g,'Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ğ»Ğ°'],[/\bÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ»\b/g,'ÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ»Ğ°'],
  [/\bĞ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»\b/g,'Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»Ğ°'],[/\bÑ€ĞµÑˆĞ¸Ğ»\b/g,'Ñ€ĞµÑˆĞ¸Ğ»Ğ°'],[/\bĞ½Ğ°Ñ‡Ğ°Ğ»\b/g,'Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°'],
  [/\bĞ¿Ğ¾Ğ½ÑĞ»\b/g,'Ğ¿Ğ¾Ğ½ÑĞ»Ğ°'],[/\bĞ²Ğ·ÑĞ»\b/g,'Ğ²Ğ·ÑĞ»Ğ°'],[/\bĞ´Ğ°Ğ»\b/g,'Ğ´Ğ°Ğ»Ğ°'],
];
const LISTENER_F_MAP = [
  [/\bĞ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹\b/g,'Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ'],[/\bÑƒĞ²Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğ¹\b/g,'ÑƒĞ²Ğ°Ğ¶Ğ°ĞµĞ¼Ğ°Ñ'],[/\bĞ¼Ğ¸Ğ»Ñ‹Ğ¹\b/g,'Ğ¼Ğ¸Ğ»Ğ°Ñ'],
];
function applyMap(text, map) {
  let o = text; map.forEach(([re,rep]) => { o = o.replace(re, rep); }); return o;
}
function makeFormal(t)  { return applyMap(t, TY_TO_VY); }
function makeCasual(t)  { return applyMap(t, VY_TO_TY); }
function applyGender(text, g) { return g==='female' ? applyMap(text, GENDER_MAP_F) : text; }
function applyListenerG(text, g) { return g==='female' ? applyMap(text, LISTENER_F_MAP) : text; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORD BREAKDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EN_STOP = new Set(['the','a','an','in','on','at','to','for','of','and','or','but','is',
  'it','i','my','me','you','your','he','she','we','they','this','that','with','from','not',
  'are','was','were','be','have','has','had','do','does','did','will','would','could',
  'should','may','might','shall','as','by','up','if','so','no','yes','just','also','very']);
const RU_STOP = new Set(['Ğ¸','Ğ²','Ğ½Ğ°','Ñ','Ğ¿Ğ¾','Ğ´Ğ»Ñ','Ğ¾Ñ‚','Ğ¸Ğ·','Ğº','Ğ°','Ğ½Ğ¾','Ñ‡Ñ‚Ğ¾','ÑÑ‚Ğ¾','Ñ',
  'Ñ‚Ñ‹','Ğ¾Ğ½','Ğ¾Ğ½Ğ°','Ğ¼Ñ‹','Ğ²Ñ‹','Ğ¾Ğ½Ğ¸','Ğ½Ğµ','Ğ´Ğ°','Ğ½ĞµÑ‚','Ğ¶Ğµ','ÑƒĞ¶Ğµ','ĞºĞ°Ğº','Ñ‚Ğ°Ğº','Ğ±Ñ‹','Ğ»Ğ¸','Ğ¸Ğ»Ğ¸',
  'Ñ‚Ğ¾','Ğ²ÑÑ‘','Ñ‚Ğ°Ğ¼','Ñ‚ÑƒÑ‚','ĞµÑ‰Ñ‘','Ğ²Ğ¾Ñ‚']);

function detectType(w) {
  const lo = w.toLowerCase();
  const ru = /[Ğ°-ÑÑ‘]/i.test(lo);
  if (!ru) {
    if (['is','are','was','were','be','have','has','had','do','does','did','go','went','come',
         'came','want','like','love','need','know','think','see','look','say','tell','ask',
         'work','live','feel','call','get','put','give','take','make','help','try','use',
         'keep','play','hear','speak','write','read','meet','run','turn'].includes(lo)
        || lo.endsWith('ing') || lo.endsWith('ate') || lo.endsWith('ify')) return 'verb';
    if (lo.endsWith('ly')) return 'adverb';
    if (lo.endsWith('ful')||lo.endsWith('less')||lo.endsWith('ous')||lo.endsWith('ive')||lo.endsWith('al')) return 'adj';
  } else {
    if (lo.endsWith('Ñ‚ÑŒ')||lo.endsWith('Ñ‚ÑÑ')||lo.endsWith('Ğ°Ñ‚ÑŒ')||lo.endsWith('ĞµÑ‚')||lo.endsWith('ÑÑ‚')) return 'verb';
    if (lo.endsWith('Ğ½Ğ¾')||lo.endsWith('ĞºĞ¾')||lo.endsWith('ÑĞºĞ¸')) return 'adverb';
    if (lo.endsWith('Ñ‹Ğ¹')||lo.endsWith('Ğ¸Ğ¹')||lo.endsWith('Ğ¾Ğ¹')||lo.endsWith('Ğ°Ñ')) return 'adj';
  }
  return 'noun';
}

function getTagCfg() {
  return {
    verb:  {emoji:'âš¡',css:'tag-verb',  label:t('tagVerb')},
    noun:  {emoji:'ğŸ“¦',css:'tag-noun',  label:t('tagNoun')},
    adj:   {emoji:'ğŸ¨',css:'tag-adj',   label:t('tagAdj')},
    adverb:{emoji:'ğŸ’¨',css:'tag-adv',   label:t('tagAdv')},
    phrase:{emoji:'ğŸ’¬',css:'tag-phrase',label:t('tagPhrase')},
  };
}

function extractWords(text) {
  const stop = direction === 'ru-en' ? RU_STOP : EN_STOP;
  return [...new Set(
    text.split(/\s+/)
      .map(w => w.replace(/[^a-zA-ZĞ°-ÑÑ‘Ğ-Ğ¯Ğ]/g,'').toLowerCase())
      .filter(w => w.length > 3 && !stop.has(w))
  )].slice(0, 6);
}

function extractPhrases(text) {
  const words = text.trim().split(/\s+/);
  const out = [];
  for (let i = 0; i < Math.min(words.length - 1, 3); i++) {
    const p = words[i]+' '+words[i+1];
    if (p.replace(/[^a-zA-ZĞ°-ÑÑ‘Ğ-Ğ¯Ğ]/g,'').length > 5) out.push(p);
  }
  return out.slice(0,2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN TRANSLATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function doTranslate() {
  const input = document.getElementById('inputText').value.trim();
  if (!input) { showToast(t('noText')); return; }

  const sl = direction === 'en-ru' ? 'en' : 'ru';
  const tl = direction === 'en-ru' ? 'ru' : 'en';

  const btn = document.getElementById('translateBtn');
  btn.disabled = true;
  document.getElementById('translateBtnText').textContent = 'â³ ' + t('translateBtn') + 'â€¦';
  document.getElementById('loading').classList.add('show');
  document.getElementById('results').classList.remove('show');

  try {
    let base = await fetchGoogle(input, sl, tl);
    let formal, casual;

    if (direction === 'en-ru') {
      base   = applyGender(base, speakerGend);
      base   = applyListenerG(base, listenerGend);
      formal = makeFormal(base);
      casual = makeCasual(base);
      document.getElementById('formalNote').textContent = t('formalNote');
      document.getElementById('casualNote').textContent = t('casualNote');
    } else {
      formal = base;
      await delay(300);
      try {
        casual = await fetchGoogle(makeCasual(input), sl, tl);
        if (casual.toLowerCase() === formal.toLowerCase()) casual = base;
      } catch { casual = base; }
      document.getElementById('formalNote').textContent = t('formalNoteRu');
      document.getElementById('casualNote').textContent = t('casualNoteRu');
    }

    document.getElementById('formalText').textContent = formal;
    document.getElementById('casualText').textContent = casual;
    document.getElementById('loading').classList.remove('show');
    document.getElementById('results').classList.add('show');

    await buildBreakdown(input, sl, tl);

  } catch (err) {
    document.getElementById('loading').classList.remove('show');
    document.getElementById('results').classList.add('show');
    document.getElementById('formalText').textContent = t('errText');
    document.getElementById('casualText').textContent = '';
    document.getElementById('breakdownBody').innerHTML =
      `<tr><td colspan="4" style="padding:14px 18px;color:#ef4444;">Error: ${err.message}</td></tr>`;
    console.error(err);
  }

  btn.disabled = false;
  document.getElementById('translateBtnText').textContent = t('translateBtn');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BREAKDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function buildBreakdown(input, sl, tl) {
  const tbody = document.getElementById('breakdownBody');
  tbody.innerHTML = `<tr><td colspan="4" style="padding:14px 18px;color:#b0bcd8;">${t('analysing')}</td></tr>`;

  const words   = extractWords(input);
  const phrases = extractPhrases(input);
  const rows    = [];

  for (const w of words) {
    try {
      await delay(150);
      const tr = await fetchGoogle(w, sl, tl);
      const type = detectType(w);
      let note = '';
      if (direction==='en-ru' && type==='verb' && speakerGend==='female') note = t('noteVerbF');
      else if (direction==='en-ru' && type==='noun') note = t('noteNoun');
      rows.push({ type, orig: w, trans: tr, note });
    } catch { /* skip */ }
  }
  for (const ph of phrases) {
    try {
      await delay(150);
      const tr = await fetchGoogle(ph, sl, tl);
      rows.push({ type:'phrase', orig:ph, trans:tr, note:t('notePhrase') });
    } catch { /* skip */ }
  }

  tbody.innerHTML = '';
  if (!rows.length) {
    tbody.innerHTML = `<tr><td colspan="4" style="padding:14px 18px;color:#b0bcd8;">${t('noBreakdown')}</td></tr>`;
    return;
  }

  const TAG = getTagCfg();
  rows.forEach(({ type, orig, trans, note }) => {
    const cfg = TAG[type] || TAG.noun;
    const tr  = document.createElement('tr');
    tr.innerHTML = `
      <td><span class="tag ${cfg.css}">${cfg.emoji} ${cfg.label}</span></td>
      <td class="orig-word">${orig}</td>
      <td class="trans-word">${trans}</td>
      <td class="note-cell">${note}</td>`;
    tbody.appendChild(tr);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD â€” Enter to translate, Shift+Enter for newline
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('inputText').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    doTranslate();
  }
});
document.addEventListener('keydown', e => {
  if (e.ctrlKey && e.key === 'Enter') doTranslate();
});
</script>

</body>
</html>
