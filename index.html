<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- â•â•â• PRIMARY SEO â•â•â• -->
  <title>Best Free English to Russian Translator 2026 â€” Formal, Casual &amp; Gender-Aware</title>
  <meta name="description" content="Free English to Russian translator with formal and casual modes, gender-aware grammar, pronunciation, transliteration, phrasebook and word-by-word breakdown. The most accurate online Russian translation tool â€” no signup, no limits." />
  <meta name="keywords" content="english to russian translator, russian translation, translate english to russian, russian to english, free translator, formal russian, casual russian, russian grammar, learn russian, how to say in russian, russian pronunciation, russian phrasebook" />
  <meta name="robots" content="index, follow" />
  <meta name="author" content="Mytheon Technologies" />
  <link rel="canonical" href="https://sotirios-bot.github.io/russiantranslation/" />

  <!-- â•â•â• HREFLANG â•â•â• -->
  <link rel="alternate" hreflang="en" href="https://sotirios-bot.github.io/russiantranslation/" />
  <link rel="alternate" hreflang="ru" href="https://sotirios-bot.github.io/russiantranslation/" />
  <link rel="alternate" hreflang="x-default" href="https://sotirios-bot.github.io/russiantranslation/" />

  <!-- â•â•â• OPEN GRAPH â•â•â• -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Best Free English to Russian Translator 2026 â€” Formal, Casual &amp; Gender-Aware" />
  <meta property="og:description" content="Translate English to Russian with formal/casual modes, gender context, TTS pronunciation, transliteration and word breakdown. Free, fast, no signup." />
  <meta property="og:url" content="https://sotirios-bot.github.io/russiantranslation/" />
  <meta property="og:site_name" content="Mytheon Russian Translator" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:locale:alternate" content="ru_RU" />

  <!-- â•â•â• JSON-LD: WebApplication â•â•â• -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Best AI English to Russian Translator",
    "url": "https://sotirios-bot.github.io/russiantranslation/",
    "description": "Free English to Russian translator with formal and casual modes, gender-aware grammar, TTS pronunciation, transliteration and word breakdown.",
    "applicationCategory": "UtilityApplication",
    "operatingSystem": "Any",
    "browserRequirements": "Requires JavaScript",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
    "author": {
      "@type": "Organization",
      "name": "Mytheon Technologies",
      "address": { "@type": "PostalAddress", "streetAddress": "133/1 Gagarin Avenue", "addressLocality": "Almaty", "addressCountry": "KZ" }
    },
    "featureList": ["English to Russian translation","Russian to English translation","Formal and casual modes","Gender-aware grammar","Text-to-speech pronunciation","Transliteration","Word breakdown","Translation history","Virtual Russian keyboard","Phrasebook"]
  }
  </script>

  <!-- â•â•â• JSON-LD: FAQPage â•â•â• -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {"@type":"Question","name":"How accurate is this English to Russian translator?","acceptedAnswer":{"@type":"Answer","text":"This translator uses Google's translation engine for high-quality, context-aware results handling everyday language, business phrases and conversational text well."}},
      {"@type":"Question","name":"What is the difference between formal and casual Russian?","acceptedAnswer":{"@type":"Answer","text":"Formal Russian uses Ğ’Ñ‹ (polite you) for strangers, elders and business. Casual Russian uses Ñ‚Ñ‹ with friends and family. The wrong form can sound rude or stiff."}},
      {"@type":"Question","name":"Why does gender matter in Russian translation?","acceptedAnswer":{"@type":"Answer","text":"Russian past-tense verbs agree with the speaker's gender. 'I went' is Ñ Ğ¿Ğ¾ÑˆÑ‘Ğ» (male) or Ñ Ğ¿Ğ¾ÑˆĞ»Ğ° (female). Selecting gender makes the translation grammatically correct."}},
      {"@type":"Question","name":"Is this translator free to use?","acceptedAnswer":{"@type":"Answer","text":"Yes â€” completely free, no signup, no usage limits. Developed by Mytheon Technologies, Almaty, Kazakhstan."}},
      {"@type":"Question","name":"Can I hear the Russian pronunciation?","acceptedAnswer":{"@type":"Answer","text":"Yes. Click the ğŸ”Š speaker button on any translation card to hear it spoken aloud using your browser's built-in text-to-speech engine."}}
    ]
  }
  </script>

  <style>
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CSS VARIABLES â€” LIGHT / DARK
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  :root {
    --bg:         #f0f4ff;
    --surface:    #ffffff;
    --surface2:   #fafcff;
    --border:     #d0dcf5;
    --border2:    #eaf0ff;
    --text:       #1a1a2e;
    --muted:      #5570a0;
    --faint:      #9aadcc;
    --xfaint:     #b0bcd8;
    --primary:    #2253cb;
    --primary-bg: #eaf0ff;
    --primary-dk: #1a40a8;
    --orange:     #ea7000;
    --orange-bg:  #fff7f0;
    --green:      #1a9e5c;
    --green-bg:   #f0fdf6;
    --shadow:     rgba(34,83,203,0.07);
    --shadow2:    rgba(34,83,203,0.18);
  }
  [data-theme="dark"] {
    --bg:         #080c18;
    --surface:    #0f1520;
    --surface2:   #0a1020;
    --border:     rgba(255,255,255,0.09);
    --border2:    rgba(255,255,255,0.05);
    --text:       #e5e7eb;
    --muted:      #9ca3af;
    --faint:      #6b7280;
    --xfaint:     #4b5563;
    --primary:    #5b85f5;
    --primary-bg: rgba(91,133,245,0.12);
    --primary-dk: #7599ff;
    --orange:     #fb923c;
    --orange-bg:  rgba(251,146,60,0.08);
    --green:      #34d399;
    --green-bg:   rgba(52,211,153,0.08);
    --shadow:     rgba(0,0,0,0.35);
    --shadow2:    rgba(0,0,0,0.55);
  }

  *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Segoe UI',system-ui,-apple-system,sans-serif; background:var(--bg); min-height:100vh; color:var(--text); transition:background .3s,color .3s; }
  a { color:var(--primary); }

  /* â•â•â• TOP LEADERBOARD AD â•â•â• */
  .top-ad { background:var(--surface); border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:center; padding:10px; }
  .ad-block { border:2px dashed var(--border); border-radius:10px; display:flex; align-items:center; justify-content:center; gap:8px; color:var(--xfaint); font-size:0.73rem; font-weight:600; letter-spacing:.5px; background:var(--bg); }
  .top-ad .ad-block { width:728px; max-width:100%; height:90px; }

  /* â•â•â• PAGE LAYOUT â•â•â• */
  .page-wrap { display:grid; grid-template-columns:160px 1fr 160px; gap:20px; max-width:1320px; margin:0 auto; padding:0 12px; align-items:start; }
  @media(max-width:1100px){ .page-wrap{grid-template-columns:1fr;} .ad-side{display:none;} }

  /* â•â•â• SIDE ADS â•â•â• */
  .ad-side { position:sticky; top:20px; width:160px; min-height:600px; margin-top:24px; }
  .ad-side .ad-block { width:160px; min-height:600px; border-radius:16px; flex-direction:column; gap:6px; padding:16px; }
  .ad-side .ad-block span { font-size:.68rem; }

  /* â•â•â• MAIN â•â•â• */
  .app { padding:20px 0 40px; }

  /* â•â•â• HEADER â•â•â• */
  header { text-align:center; padding:16px 0 22px; position:relative; }
  h1 { font-size:2.1rem; font-weight:800; color:var(--primary); letter-spacing:-.5px; line-height:1.25; }
  header p { color:var(--muted); margin-top:9px; font-size:.94rem; max-width:680px; margin-left:auto; margin-right:auto; line-height:1.65; }
  .header-tools { position:absolute; top:16px; right:0; display:flex; gap:8px; }
  .tool-btn { display:flex; align-items:center; gap:5px; padding:6px 13px; background:var(--surface); border:1px solid var(--border); border-radius:20px; font-size:.8rem; color:var(--muted); cursor:pointer; transition:all .2s; font-weight:500; }
  .tool-btn:hover { border-color:var(--primary); color:var(--primary); background:var(--primary-bg); }

  /* â•â•â• CARD â•â•â• */
  .card { background:var(--surface); border:1px solid var(--border); border-radius:20px; padding:26px; margin-bottom:16px; box-shadow:0 4px 20px var(--shadow); }

  /* â•â•â• DIRECTION â•â•â• */
  .direction-row { display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:20px; flex-wrap:wrap; }
  .lang-pill { display:flex; align-items:center; gap:8px; background:var(--bg); border:2px solid var(--border); border-radius:50px; padding:10px 20px; font-size:.96rem; font-weight:600; min-width:145px; justify-content:center; color:var(--muted); transition:all .2s; }
  .lang-pill.active-lang { border-color:var(--primary); color:var(--primary); background:var(--primary-bg); }
  .swap-btn { background:var(--primary); border:none; border-radius:50%; width:46px; height:46px; font-size:1.2rem; cursor:pointer; color:#fff; transition:transform .35s,background .2s; flex-shrink:0; box-shadow:0 4px 14px var(--shadow2); }
  .swap-btn:hover { transform:rotate(180deg); background:var(--primary-dk); }
  .detect-pill { display:none; align-items:center; gap:5px; background:var(--green-bg); border:1px solid var(--green); color:var(--green); border-radius:20px; padding:4px 11px; font-size:.72rem; font-weight:700; }
  .detect-pill.show { display:flex; }

  /* â•â•â• GENDER â•â•â• */
  .gender-row { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:20px; }
  .gender-box label { display:block; font-size:.73rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--faint); margin-bottom:7px; font-weight:600; }
  .gender-btns { display:flex; gap:7px; }
  .g-btn { flex:1; padding:9px 8px; border:2px solid var(--border); border-radius:11px; background:var(--bg); color:var(--faint); cursor:pointer; font-size:.88rem; transition:all .2s; text-align:center; font-weight:500; }
  .g-btn:hover { border-color:var(--primary); color:var(--primary); }
  .g-btn.on { background:var(--primary-bg); border-color:var(--primary); color:var(--primary); font-weight:700; }

  /* â•â•â• TEXTAREA â•â•â• */
  .input-wrap { position:relative; }
  textarea { width:100%; min-height:120px; background:var(--bg); border:2px solid var(--border); border-radius:13px; padding:14px; color:var(--text); font-size:1.05rem; font-family:inherit; resize:vertical; outline:none; transition:border-color .2s,box-shadow .2s; line-height:1.6; }
  textarea:focus { border-color:var(--primary); box-shadow:0 0 0 3px var(--primary-bg); background:var(--surface); }
  textarea::placeholder { color:var(--xfaint); }
  .input-footer { display:flex; justify-content:space-between; align-items:center; margin-top:6px; }
  .char-count { font-size:.77rem; color:var(--xfaint); }
  .kb-toggle { background:none; border:1px solid var(--border); border-radius:8px; padding:4px 10px; font-size:.77rem; color:var(--faint); cursor:pointer; transition:all .2s; }
  .kb-toggle:hover,.kb-toggle.on { border-color:var(--primary); color:var(--primary); background:var(--primary-bg); }
  .kb-buttons { display:flex; gap:6px; }
  .phrase-card-footer { display:flex; justify-content:flex-end; margin-top:7px; }
  .phrase-copy-btn { background:none; border:1px solid var(--border); border-radius:7px; padding:3px 9px; font-size:.75rem; color:var(--faint); cursor:pointer; transition:all .2s; }
  .phrase-copy-btn:hover { border-color:var(--primary); color:var(--primary); background:var(--primary-bg); }
  .howto-copy-btn { background:none; border:1px solid var(--border); border-radius:6px; padding:2px 8px; font-size:.73rem; color:var(--faint); cursor:pointer; transition:all .2s; flex-shrink:0; }
  .howto-copy-btn:hover { border-color:var(--primary); color:var(--primary); background:var(--primary-bg); }

  /* â•â•â• VIRTUAL KEYBOARD â•â•â• */
  .vkeyboard { display:none; background:var(--surface2); border:1px solid var(--border); border-radius:14px; padding:12px; margin-top:10px; }
  .vkeyboard.show { display:block; }
  .vk-row { display:flex; gap:5px; justify-content:center; margin-bottom:5px; flex-wrap:wrap; }
  .vk-key { min-width:33px; height:33px; background:var(--surface); border:1px solid var(--border); border-radius:7px; font-size:.88rem; cursor:pointer; color:var(--text); transition:all .15s; display:flex; align-items:center; justify-content:center; font-family:inherit; }
  .vk-key:hover { background:var(--primary-bg); border-color:var(--primary); color:var(--primary); }
  .vk-key:active { transform:scale(.9); }
  .vk-wide { min-width:60px; font-size:.72rem; }
  .vk-space { min-width:130px; }

  /* â•â•â• TRANSLATE BUTTON â•â•â• */
  .translate-btn { width:100%; padding:15px; background:var(--primary); border:none; border-radius:13px; color:#fff; font-size:1.05rem; font-weight:700; letter-spacing:.5px; cursor:pointer; margin-top:12px; transition:all .2s; box-shadow:0 4px 16px var(--shadow2); }
  .translate-btn:hover:not(:disabled) { background:var(--primary-dk); transform:translateY(-2px); box-shadow:0 8px 24px var(--shadow2); }
  .translate-btn:disabled { opacity:.55; cursor:not-allowed; transform:none; }
  .hint { text-align:center; font-size:.73rem; color:var(--xfaint); margin-top:7px; }
  .hint kbd { background:var(--primary-bg); border:1px solid var(--border); border-radius:4px; padding:1px 5px; color:var(--primary); font-size:.69rem; }

  /* â•â•â• LOADING â•â•â• */
  .loading { display:none; text-align:center; padding:28px; color:var(--faint); }
  .loading.show { display:block; }
  .spinner { display:inline-block; width:34px; height:34px; border:3px solid var(--primary-bg); border-top-color:var(--primary); border-radius:50%; animation:spin .75s linear infinite; }
  @keyframes spin { to{transform:rotate(360deg);} }

  /* â•â•â• RESULTS â•â•â• */
  .results { display:none; }
  .results.show { display:block; }
  .sec-header { display:flex; align-items:center; gap:10px; margin-bottom:13px; font-size:.74rem; color:var(--faint); text-transform:uppercase; letter-spacing:1.2px; font-weight:700; }
  .sec-header::before,.sec-header::after { content:''; flex:1; height:1px; background:var(--border); }
  .results-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:16px; }
  @media(max-width:600px){ .results-grid{grid-template-columns:1fr;} }

  .result-card { border-radius:16px; padding:20px; border:2px solid; box-shadow:0 2px 12px var(--shadow); }
  .result-card.formal { border-color:rgba(34,83,203,.28); background:var(--surface2); }
  .result-card.casual { border-color:rgba(234,112,0,.28); background:var(--orange-bg); }
  .rc-head { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
  .rc-label { font-size:.71rem; text-transform:uppercase; letter-spacing:1.2px; font-weight:700; }
  .formal .rc-label { color:var(--primary); }
  .casual .rc-label { color:var(--orange); }
  .rc-actions { display:flex; gap:3px; }
  .iBtn { background:none; border:none; cursor:pointer; font-size:1rem; opacity:.38; transition:opacity .2s,transform .2s; padding:2px 4px; line-height:1; }
  .iBtn:hover { opacity:1; transform:scale(1.18); }
  .iBtn.starred { opacity:1; }
  .rc-text { font-size:1.05rem; line-height:1.75; color:var(--text); min-height:48px; }
  .rc-translit { font-size:.8rem; color:var(--faint); margin-top:6px; font-style:italic; }
  .rc-note { font-size:.74rem; color:var(--xfaint); margin-top:5px; }

  /* â•â•â• GRAMMAR TIP â•â•â• */
  .grammar-tip { display:none; background:var(--primary-bg); border:1px solid var(--border); border-radius:12px; padding:11px 15px; margin-bottom:14px; font-size:.87rem; color:var(--primary); line-height:1.55; }
  .grammar-tip.show { display:block; }

  /* â•â•â• SHARE ROW â•â•â• */
  .share-row { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:16px; align-items:center; }
  .share-btn { display:flex; align-items:center; gap:5px; padding:7px 14px; border:1px solid var(--border); border-radius:20px; background:var(--surface); color:var(--muted); font-size:.8rem; cursor:pointer; transition:all .2s; font-weight:500; }
  .share-btn:hover { border-color:var(--primary); color:var(--primary); background:var(--primary-bg); }
  .report-btn { margin-left:auto; display:flex; align-items:center; gap:5px; padding:7px 14px; border:1px solid var(--border); border-radius:20px; background:var(--surface); color:var(--faint); font-size:.78rem; cursor:pointer; transition:all .2s; }
  .report-btn:hover { border-color:#ef4444; color:#ef4444; }

  /* â•â•â• BREAKDOWN â•â•â• */
  .breakdown-card { border-radius:18px; overflow:hidden; border:1px solid var(--border); background:var(--surface); box-shadow:0 2px 10px var(--shadow); margin-bottom:16px; }
  .breakdown-title { padding:13px 18px 11px; font-size:.73rem; text-transform:uppercase; letter-spacing:1.2px; color:var(--faint); font-weight:700; border-bottom:1px solid var(--border2); background:var(--surface2); }
  table { width:100%; border-collapse:collapse; }
  thead th { padding:9px 16px; text-align:left; font-size:.7rem; text-transform:uppercase; letter-spacing:1px; color:var(--xfaint); background:var(--surface2); border-bottom:1px solid var(--border2); font-weight:700; }
  tbody tr { transition:background .15s; }
  tbody tr:hover { background:var(--primary-bg); }
  tbody td { padding:10px 16px; border-bottom:1px solid var(--border2); font-size:.91rem; vertical-align:middle; }
  tbody tr:last-child td { border-bottom:none; }
  .tag { display:inline-flex; align-items:center; gap:4px; padding:3px 9px; border-radius:20px; font-size:.69rem; font-weight:700; letter-spacing:.5px; text-transform:uppercase; }
  .tag-verb   { background:rgba(34,83,203,.1);  color:var(--primary); }
  .tag-noun   { background:rgba(234,112,0,.1);  color:var(--orange); }
  .tag-phrase { background:rgba(26,158,92,.1);  color:var(--green); }
  .tag-adj    { background:rgba(160,50,220,.1); color:#a032dc; }
  .tag-adv    { background:rgba(200,130,0,.1);  color:#c68800; }
  .orig-word  { color:var(--muted); font-weight:500; }
  .trans-word { color:var(--primary); font-weight:700; }
  .note-cell  { color:var(--faint); font-size:.79rem; }

  /* â•â•â• HISTORY â•â•â• */
  .history-section { margin-bottom:16px; }
  .history-list { display:flex; flex-direction:column; gap:7px; }
  .history-item { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:11px 15px; cursor:pointer; transition:all .2s; display:flex; align-items:center; gap:10px; }
  .history-item:hover { border-color:var(--primary); background:var(--primary-bg); }
  .history-text { font-size:.87rem; color:var(--text); font-weight:600; flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .history-sub { font-size:.74rem; color:var(--faint); margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .history-dir { font-size:.7rem; color:var(--primary); font-weight:700; flex-shrink:0; background:var(--primary-bg); padding:2px 8px; border-radius:10px; }
  .history-del { background:none; border:none; color:var(--xfaint); cursor:pointer; font-size:.9rem; flex-shrink:0; padding:2px; }
  .history-del:hover { color:#ef4444; }

  /* â•â•â• PHRASEBOOK â•â•â• */
  .phrasebook-section { margin-bottom:16px; }
  .tabs { display:flex; gap:6px; margin-bottom:13px; flex-wrap:wrap; }
  .tab-btn { padding:7px 14px; border:1px solid var(--border); border-radius:20px; background:var(--surface); color:var(--muted); font-size:.81rem; cursor:pointer; transition:all .2s; font-weight:500; }
  .tab-btn:hover,.tab-btn.active { background:var(--primary-bg); border-color:var(--primary); color:var(--primary); font-weight:700; }
  .tab-panel { display:none; }
  .tab-panel.active { display:block; }
  .phrase-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  @media(max-width:600px){ .phrase-grid{grid-template-columns:1fr;} }
  .phrase-card { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:11px 14px; cursor:pointer; transition:all .2s; }
  .phrase-card:hover { border-color:var(--primary); background:var(--primary-bg); }
  .phrase-en { font-size:.87rem; color:var(--text); font-weight:600; }
  .phrase-ru { font-size:.87rem; color:var(--primary); margin-top:3px; }
  .phrase-tr { font-size:.73rem; color:var(--faint); font-style:italic; margin-top:2px; }

  /* â•â•â• HOW TO SAY â•â•â• */
  .howto-section { margin-bottom:16px; }
  .search-input { width:100%; padding:10px 15px; background:var(--bg); border:2px solid var(--border); border-radius:12px; color:var(--text); font-size:.94rem; font-family:inherit; outline:none; margin-bottom:12px; transition:border-color .2s; }
  .search-input:focus { border-color:var(--primary); }
  .search-input::placeholder { color:var(--xfaint); }
  .howto-grid { display:grid; grid-template-columns:1fr 1fr; gap:6px; }
  @media(max-width:600px){ .howto-grid{grid-template-columns:1fr;} }
  .howto-row { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:9px 13px; display:flex; align-items:center; gap:10px; cursor:pointer; transition:all .15s; font-size:.84rem; }
  .howto-row:hover { border-color:var(--primary); background:var(--primary-bg); }
  .howto-en { color:var(--text); font-weight:600; flex:1; }
  .howto-ru { color:var(--primary); font-weight:700; flex:1; text-align:right; }
  .howto-hidden { display:none; }

  /* â•â•â• FAQ â•â•â• */
  .faq-section { margin:26px 0 20px; }
  .faq-main-title { font-size:1.3rem; font-weight:800; color:var(--primary); margin-bottom:14px; text-align:center; }
  .faq-item { background:var(--surface); border:1px solid var(--border); border-radius:13px; margin-bottom:7px; overflow:hidden; box-shadow:0 1px 6px var(--shadow); }
  .faq-q { width:100%; background:none; border:none; padding:14px 18px; text-align:left; font-size:.93rem; font-weight:600; color:var(--text); cursor:pointer; display:flex; justify-content:space-between; align-items:center; gap:12px; transition:background .2s; }
  .faq-q:hover { background:var(--bg); }
  .faq-q.open { color:var(--primary); background:var(--primary-bg); }
  .faq-icon { font-size:.95rem; flex-shrink:0; transition:transform .25s; color:var(--primary); }
  .faq-q.open .faq-icon { transform:rotate(45deg); }
  .faq-a { display:none; padding:0 18px 14px; font-size:.89rem; color:var(--muted); line-height:1.7; border-top:1px solid var(--border2); padding-top:12px; }
  .faq-a.open { display:block; }

  /* â•â•â• BOTTOM AD â•â•â• */
  .bottom-ad { display:flex; align-items:center; justify-content:center; padding:14px 0; }
  .bottom-ad .ad-block { width:728px; max-width:100%; height:90px; }

  /* â•â•â• TOAST â•â•â• */
  #toast { position:fixed; bottom:24px; right:24px; background:var(--primary); border-radius:10px; padding:10px 18px; font-size:.87rem; color:#fff; opacity:0; transform:translateY(10px); transition:opacity .25s,transform .25s; pointer-events:none; z-index:9999; box-shadow:0 4px 16px var(--shadow2); }
  #toast.show { opacity:1; transform:translateY(0); }

  /* â•â•â• FOOTER â•â•â• */
  footer { text-align:center; padding:22px 0 14px; border-top:1px solid var(--border); margin-top:8px; }
  .footer-brand { font-size:.87rem; font-weight:700; color:var(--primary); letter-spacing:1px; text-transform:uppercase; }
  .footer-address { font-size:.76rem; color:var(--faint); margin-top:4px; }
  </style>
</head>
<body data-theme="light">

<!-- â•â•â• TOP AD 728Ã—90 â•â•â• -->
<div class="top-ad">
  <div class="ad-block">ğŸ“¢ &nbsp; AdSense / Yandex â€” 728 Ã— 90 Leaderboard Banner</div>
</div>

<div class="page-wrap">

  <!-- LEFT AD -->
  <div class="ad-side">
    <div class="ad-block">
      <span style="font-size:1.8rem;opacity:.4">ğŸ“¢</span>
      <span style="text-transform:uppercase;letter-spacing:1px">Ad</span>
      <span>160 Ã— 600</span>
      <span>AdSense / Yandex</span>
    </div>
  </div>

  <!-- MAIN APP -->
  <div class="app">

    <header>
      <h1>ğŸ‡¬ğŸ‡§ â†” ğŸ‡·ğŸ‡º Best AI English to Russian Translator</h1>
      <p id="subheading">âœ¨ Smart English to Russian and Russian to English translations with gender context, formality levels &amp; learning breakdowns âœ¨</p>
      <div class="header-tools">
        <button class="tool-btn" onclick="toggleTheme()" id="themeBtn">ğŸŒ™ Dark</button>
      </div>
    </header>

    <!-- â•â•â• INPUT CARD â•â•â• -->
    <div class="card">

      <div class="direction-row">
        <div class="lang-pill active-lang" id="srcPill">ğŸ‡¬ğŸ‡§ English</div>
        <button class="swap-btn" onclick="swapDirection()" title="Swap">â‡„</button>
        <div class="lang-pill" id="tgtPill">ğŸ‡·ğŸ‡º Russian</div>
        <div class="detect-pill" id="detectPill">ğŸ” <span id="detectText">Auto-detected</span></div>
      </div>

      <div class="gender-row">
        <div class="gender-box">
          <label id="speakerLabel">ğŸ‘¤ I am speaking as...</label>
          <div class="gender-btns">
            <button class="g-btn on" id="sp-m" onclick="setGender('speaker','male')"><span id="mL1">ğŸ‘¨ Male</span></button>
            <button class="g-btn"    id="sp-f" onclick="setGender('speaker','female')"><span id="fL1">ğŸ‘© Female</span></button>
          </div>
        </div>
        <div class="gender-box">
          <label id="listenerLabel">ğŸ—£ï¸ I am talking to...</label>
          <div class="gender-btns">
            <button class="g-btn on" id="ls-m" onclick="setGender('listener','male')"><span id="mL2">ğŸ‘¨ Male</span></button>
            <button class="g-btn"    id="ls-f" onclick="setGender('listener','female')"><span id="fL2">ğŸ‘© Female</span></button>
          </div>
        </div>
      </div>

      <div class="input-wrap">
        <textarea id="inputText" placeholder="âœï¸  Type or paste your text here..." oninput="onInput()"></textarea>
        <div class="input-footer">
          <div class="char-count"><span id="charNum">0</span> <span id="charsLabel">characters</span></div>
          <div class="kb-buttons">
            <button class="kb-toggle" id="kbToggle" onclick="toggleKB()">âŒ¨ï¸ RU keyboard</button>
            <button class="kb-toggle" id="enKbToggle" onclick="toggleENKB()">âŒ¨ï¸ EN keyboard</button>
          </div>
        </div>
      </div>

      <!-- Virtual Russian Keyboard -->
      <div class="vkeyboard" id="vkeyboard">
        <div class="vk-row">
          <button class="vk-key" onclick="vk('Ğ¹')">Ğ¹</button><button class="vk-key" onclick="vk('Ñ†')">Ñ†</button><button class="vk-key" onclick="vk('Ñƒ')">Ñƒ</button><button class="vk-key" onclick="vk('Ğº')">Ğº</button><button class="vk-key" onclick="vk('Ğµ')">Ğµ</button><button class="vk-key" onclick="vk('Ğ½')">Ğ½</button><button class="vk-key" onclick="vk('Ğ³')">Ğ³</button><button class="vk-key" onclick="vk('Ñˆ')">Ñˆ</button><button class="vk-key" onclick="vk('Ñ‰')">Ñ‰</button><button class="vk-key" onclick="vk('Ğ·')">Ğ·</button><button class="vk-key" onclick="vk('Ñ…')">Ñ…</button><button class="vk-key" onclick="vk('ÑŠ')">ÑŠ</button>
        </div>
        <div class="vk-row">
          <button class="vk-key" onclick="vk('Ñ„')">Ñ„</button><button class="vk-key" onclick="vk('Ñ‹')">Ñ‹</button><button class="vk-key" onclick="vk('Ğ²')">Ğ²</button><button class="vk-key" onclick="vk('Ğ°')">Ğ°</button><button class="vk-key" onclick="vk('Ğ¿')">Ğ¿</button><button class="vk-key" onclick="vk('Ñ€')">Ñ€</button><button class="vk-key" onclick="vk('Ğ¾')">Ğ¾</button><button class="vk-key" onclick="vk('Ğ»')">Ğ»</button><button class="vk-key" onclick="vk('Ğ´')">Ğ´</button><button class="vk-key" onclick="vk('Ğ¶')">Ğ¶</button><button class="vk-key" onclick="vk('Ñ')">Ñ</button>
        </div>
        <div class="vk-row">
          <button class="vk-key" onclick="vk('Ñ')">Ñ</button><button class="vk-key" onclick="vk('Ñ‡')">Ñ‡</button><button class="vk-key" onclick="vk('Ñ')">Ñ</button><button class="vk-key" onclick="vk('Ğ¼')">Ğ¼</button><button class="vk-key" onclick="vk('Ğ¸')">Ğ¸</button><button class="vk-key" onclick="vk('Ñ‚')">Ñ‚</button><button class="vk-key" onclick="vk('ÑŒ')">ÑŒ</button><button class="vk-key" onclick="vk('Ğ±')">Ğ±</button><button class="vk-key" onclick="vk('Ñ')">Ñ</button><button class="vk-key" onclick="vk('Ñ‘')">Ñ‘</button>
        </div>
        <div class="vk-row">
          <button class="vk-key vk-wide" onclick="vk(' ')">Space</button>
          <button class="vk-key vk-space" onclick="vkBs()">âŒ« Del</button>
          <button class="vk-key vk-wide" onclick="doTranslate()" style="background:var(--primary);color:#fff;border-color:var(--primary);">â†µ Go</button>
        </div>
      </div>

      <!-- Virtual English Keyboard -->
      <div class="vkeyboard" id="enkeyboard">
        <div class="vk-row">
          <button class="vk-key" onclick="vk('q')">q</button><button class="vk-key" onclick="vk('w')">w</button><button class="vk-key" onclick="vk('e')">e</button><button class="vk-key" onclick="vk('r')">r</button><button class="vk-key" onclick="vk('t')">t</button><button class="vk-key" onclick="vk('y')">y</button><button class="vk-key" onclick="vk('u')">u</button><button class="vk-key" onclick="vk('i')">i</button><button class="vk-key" onclick="vk('o')">o</button><button class="vk-key" onclick="vk('p')">p</button>
        </div>
        <div class="vk-row">
          <button class="vk-key" onclick="vk('a')">a</button><button class="vk-key" onclick="vk('s')">s</button><button class="vk-key" onclick="vk('d')">d</button><button class="vk-key" onclick="vk('f')">f</button><button class="vk-key" onclick="vk('g')">g</button><button class="vk-key" onclick="vk('h')">h</button><button class="vk-key" onclick="vk('j')">j</button><button class="vk-key" onclick="vk('k')">k</button><button class="vk-key" onclick="vk('l')">l</button>
        </div>
        <div class="vk-row">
          <button class="vk-key" onclick="vk('z')">z</button><button class="vk-key" onclick="vk('x')">x</button><button class="vk-key" onclick="vk('c')">c</button><button class="vk-key" onclick="vk('v')">v</button><button class="vk-key" onclick="vk('b')">b</button><button class="vk-key" onclick="vk('n')">n</button><button class="vk-key" onclick="vk('m')">m</button><button class="vk-key" onclick="vk('\'')">\'</button><button class="vk-key" onclick="vk('.')">.</button><button class="vk-key" onclick="vk(',')">ï¼Œ</button>
        </div>
        <div class="vk-row">
          <button class="vk-key" onclick="vk('1')">1</button><button class="vk-key" onclick="vk('2')">2</button><button class="vk-key" onclick="vk('3')">3</button><button class="vk-key" onclick="vk('4')">4</button><button class="vk-key" onclick="vk('5')">5</button><button class="vk-key" onclick="vk('6')">6</button><button class="vk-key" onclick="vk('7')">7</button><button class="vk-key" onclick="vk('8')">8</button><button class="vk-key" onclick="vk('9')">9</button><button class="vk-key" onclick="vk('0')">0</button>
        </div>
        <div class="vk-row">
          <button class="vk-key vk-wide" onclick="vk(' ')">Space</button>
          <button class="vk-key vk-space" onclick="vkBs()">âŒ« Del</button>
          <button class="vk-key vk-wide" onclick="doTranslate()" style="background:var(--primary);color:#fff;border-color:var(--primary);">â†µ Go</button>
        </div>
      </div>

      <button class="translate-btn" id="translateBtn" onclick="doTranslate()">
        ğŸ”„ &nbsp;<span id="translateBtnText">Translate</span>
      </button>
      <p class="hint">Press <kbd>Enter</kbd> to translate &nbsp;|&nbsp; <kbd>Shift+Enter</kbd> for new line</p>

    </div>

    <!-- LOADING -->
    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="margin-top:11px" id="loadingText">Translatingâ€¦ ğŸŒ</p>
    </div>

    <!-- â•â•â• RESULTS â•â•â• -->
    <div class="results" id="results">

      <div class="sec-header" id="resultsHeader">âœ¨ Translations</div>

      <div class="results-grid">
        <!-- FORMAL -->
        <div class="result-card formal">
          <div class="rc-head">
            <span class="rc-label" id="formalLabel">ğŸ© Formal</span>
            <div class="rc-actions">
              <button class="iBtn" onclick="speakCard('formalText','formal')" title="Listen">ğŸ”Š</button>
              <button class="iBtn" id="favFormal" onclick="toggleFav('formal')" title="Favourite">â­</button>
              <button class="iBtn" onclick="copyCard('formalText')" title="Copy">ğŸ“‹</button>
            </div>
          </div>
          <div class="rc-text" id="formalText"></div>
          <div class="rc-translit" id="formalTranslit"></div>
          <div class="rc-note" id="formalNote"></div>
        </div>
        <!-- CASUAL -->
        <div class="result-card casual">
          <div class="rc-head">
            <span class="rc-label" id="casualLabel">ğŸ˜Š Casual</span>
            <div class="rc-actions">
              <button class="iBtn" onclick="speakCard('casualText','casual')" title="Listen">ğŸ”Š</button>
              <button class="iBtn" id="favCasual" onclick="toggleFav('casual')" title="Favourite">â­</button>
              <button class="iBtn" onclick="copyCard('casualText')" title="Copy">ğŸ“‹</button>
            </div>
          </div>
          <div class="rc-text" id="casualText"></div>
          <div class="rc-translit" id="casualTranslit"></div>
          <div class="rc-note" id="casualNote"></div>
        </div>
      </div>

      <!-- GRAMMAR TIP -->
      <div class="grammar-tip" id="grammarTip"></div>

      <!-- SHARE ROW -->
      <div class="share-row">
        <button class="share-btn" onclick="shareLink()">ğŸ”— Copy link</button>
        <button class="share-btn" onclick="shareFB()">ğŸ“˜ Facebook</button>
        <button class="share-btn" onclick="shareWA()">ğŸ’¬ WhatsApp</button>
        <button class="share-btn" onclick="shareLinkedIn()">ğŸ’¼ LinkedIn</button>
        <button class="report-btn" onclick="reportBad()">ğŸš© Report bad translation</button>
      </div>

      <!-- WORD BREAKDOWN -->
      <div class="breakdown-card">
        <div class="breakdown-title" id="breakdownTitle">ğŸ“š Word &amp; Phrase Breakdown â€” for learning</div>
        <table>
          <thead>
            <tr>
              <th id="thType">Type</th>
              <th id="thOrig">Original</th>
              <th id="thTrans">Translation</th>
              <th id="thNotes">Notes</th>
            </tr>
          </thead>
          <tbody id="breakdownBody">
            <tr><td colspan="4" style="padding:13px 16px;color:var(--xfaint)">Readyâ€¦</td></tr>
          </tbody>
        </table>
      </div>

    </div><!-- /results -->

    <!-- â•â•â• TRANSLATION HISTORY â•â•â• -->
    <div class="history-section" id="historySection" style="display:none">
      <div class="sec-header" id="historyHeader">ğŸ• Recent Translations &nbsp;<button onclick="clearHistory()" style="background:none;border:none;color:var(--faint);font-size:.75rem;cursor:pointer;font-weight:600;">Clear all</button></div>
      <div class="history-list" id="historyList"></div>
    </div>

    <!-- â•â•â• PHRASEBOOK â•â•â• -->
    <div class="phrasebook-section">
      <div class="sec-header" id="phraseHeader">ğŸ“– Phrasebook</div>
      <div class="tabs" id="phraseTabs">
        <button class="tab-btn active" onclick="switchTab('business',this)">ğŸ’¼ Business</button>
        <button class="tab-btn" onclick="switchTab('travel',this)">âœˆï¸ Travel</button>
        <button class="tab-btn" onclick="switchTab('romance',this)">â¤ï¸ Romance</button>
        <button class="tab-btn" onclick="switchTab('medical',this)">ğŸ¥ Medical</button>
        <button class="tab-btn" onclick="switchTab('emergency',this)">ğŸš¨ Emergency</button>
      </div>
      <div id="phraseContent"></div>
    </div>

    <!-- â•â•â• HOW TO SAY â•â•â• -->
    <div class="howto-section">
      <div class="sec-header" id="howtoHeader">ğŸ—£ï¸ How to Say it in Russian â€” 50 Essential Phrases</div>
      <input type="text" class="search-input" placeholder="ğŸ”  Search phrases..." oninput="filterHowTo(this.value)" id="howtoSearch" />
      <div class="howto-grid" id="howtoGrid"></div>
    </div>

    <!-- â•â•â• FAQ â•â•â• -->
    <div class="faq-section">
      <div class="faq-main-title" id="faqTitle">â“ Frequently Asked Questions</div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸŒ How accurate is this English to Russian translator?</span><span class="faq-icon">+</span></button><div class="faq-a">This translator uses Google's translation engine to deliver high-quality, context-aware results. It handles everyday language, business phrases and conversational text very well. For specialised legal or medical content, professional review is recommended.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ© What is the difference between formal and casual Russian?</span><span class="faq-icon">+</span></button><div class="faq-a">Formal Russian uses <strong>Ğ’Ñ‹</strong> (capitalised "you") when addressing someone with respect â€” in business, with strangers or elders. Casual Russian uses <strong>Ñ‚Ñ‹</strong> with friends and family. Choosing the wrong form can sound rude or overly stiff.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ‘© Why does gender matter in Russian translation?</span><span class="faq-icon">+</span></button><div class="faq-a">Russian past-tense verbs must agree with the speaker's gender. "I went" is <strong>Ñ Ğ¿Ğ¾ÑˆÑ‘Ğ»</strong> (male) or <strong>Ñ Ğ¿Ğ¾ÑˆĞ»Ğ°</strong> (female). Selecting your gender ensures the translation is grammatically correct for you personally.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ”Š Can I hear the Russian pronunciation?</span><span class="faq-icon">+</span></button><div class="faq-a">Yes â€” click the ğŸ”Š speaker button on any translation card to hear it spoken aloud using your browser's built-in text-to-speech engine. Works in Chrome, Edge, Firefox and Safari.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ”¤ What is transliteration and why is it useful?</span><span class="faq-icon">+</span></button><div class="faq-a">Transliteration converts Russian Cyrillic letters into Latin characters so you can sound out words without knowing the Russian alphabet. For example, "ĞŸÑ€Ğ¸Ğ²ĞµÑ‚" becomes "Privet". It is shown in italics below each translation.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ’¼ Can I use this for business communications?</span><span class="faq-icon">+</span></button><div class="faq-a">Yes. The <strong>Formal</strong> mode uses the polite Ğ’Ñ‹ form, appropriate vocabulary and respectful phrasing for emails, letters and meetings. Always select Formal when writing to clients, managers or official contacts.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ“š What does the Word Breakdown section do?</span><span class="faq-icon">+</span></button><div class="faq-a">The Word &amp; Phrase Breakdown translates individual key words and common phrases separately, labelling each as a verb, noun, adjective or phrase. It is a powerful learning tool for anyone studying Russian or English.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ”„ Can I translate Russian back to English?</span><span class="faq-icon">+</span></button><div class="faq-a">Absolutely. Click the â‡„ swap button to switch from Englishâ†’Russian to Russianâ†’English. The entire interface â€” labels, buttons, breakdown tags â€” switches to Russian so you always work in your source language.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>âŒ¨ï¸ What is the virtual Russian keyboard for?</span><span class="faq-icon">+</span></button><div class="faq-a">If you don't have a Cyrillic keyboard layout installed, the built-in virtual keyboard lets you type Russian characters directly by clicking. This is especially useful when translating Russian text back to English.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>âš¡ How do I translate without clicking the button?</span><span class="faq-icon">+</span></button><div class="faq-a">Press <strong>Enter</strong> after typing to translate instantly. Use <strong>Shift+Enter</strong> to add a new line. You can also use <strong>Ctrl+Enter</strong> from anywhere on the page.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ• Does this save my translation history?</span><span class="faq-icon">+</span></button><div class="faq-a">Yes â€” your last 15 translations are saved automatically in your browser's local storage. Click any history item to restore it. Your data never leaves your device. Click "Clear all" to remove history anytime.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>â­ How do favourites work?</span><span class="faq-icon">+</span></button><div class="faq-a">Click the â­ star button on any translation card to save it as a favourite. Favourites are stored in your browser and persist between sessions. Perfect for saving phrases you use regularly.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ”— Can I share a translation with someone?</span><span class="faq-icon">+</span></button><div class="faq-a">Yes â€” click "Copy link" to generate a shareable URL with your translation pre-loaded. Send it via WhatsApp, email or any messenger. You can also use the Facebook, WhatsApp or LinkedIn share buttons.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ“ Is Russian grammar very different from English?</span><span class="faq-icon">+</span></button><div class="faq-a">Yes, significantly. Russian has 6 grammatical cases, 3 genders, verb aspect (perfective/imperfective) and gender agreement in past tense. This is why context-aware, gender-specific translation matters so much.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ—£ï¸ Why select who I am talking to?</span><span class="faq-icon">+</span></button><div class="faq-a">Some Russian adjectives and terms of address change depending on the listener's gender. "Dear" is <strong>Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹</strong> for a male and <strong>Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ</strong> for a female. Selecting the listener's gender ensures these forms are correct.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸŒ™ Is there a dark mode?</span><span class="faq-icon">+</span></button><div class="faq-a">Yes â€” click the ğŸŒ™ Dark button in the top right corner to switch to dark mode. Your preference is saved and remembered between visits.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ“– What phrases are in the phrasebook?</span><span class="faq-icon">+</span></button><div class="faq-a">The phrasebook contains 50 expert-curated phrases across 5 categories: Business, Travel, Romance, Medical and Emergency. Click any phrase to instantly load it into the translator.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ†“ Is this translator free to use?</span><span class="faq-icon">+</span></button><div class="faq-a">Yes â€” completely free, no signup, no usage limits. Developed by <strong>Mytheon Technologies</strong>, based in Almaty, Kazakhstan.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸš© What happens when I report a bad translation?</span><span class="faq-icon">+</span></button><div class="faq-a">Clicking "Report bad translation" logs the issue for our team to review. We continuously improve translation quality based on user feedback. Thank you for helping us build a better product.</div></div>

      <div class="faq-item"><button class="faq-q" onclick="toggleFaq(this)"><span>ğŸ” Does it auto-detect the language?</span><span class="faq-icon">+</span></button><div class="faq-a">Yes â€” when you paste or type text, the translator automatically detects whether it is Russian or English and adjusts the direction accordingly. A green "Auto-detected" badge appears to confirm the switch.</div></div>

    </div><!-- /faq -->

    <!-- BOTTOM AD -->
    <div class="bottom-ad">
      <div class="ad-block">ğŸ“¢ &nbsp; AdSense / Yandex â€” 728 Ã— 90 Leaderboard Banner</div>
    </div>

    <footer>
      <div class="footer-brand">âš¡ Powered by MYTHEON TECHNOLOGIES</div>
      <div class="footer-address">133/1 Gagarin Avenue, Almaty, Kazakhstan</div>
    </footer>

  </div><!-- /app -->

  <!-- RIGHT AD -->
  <div class="ad-side">
    <div class="ad-block">
      <span style="font-size:1.8rem;opacity:.4">ğŸ“¢</span>
      <span style="text-transform:uppercase;letter-spacing:1px">Ad</span>
      <span>160 Ã— 600</span>
      <span>AdSense / Yandex</span>
    </div>
  </div>

</div><!-- /page-wrap -->

<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let direction    = 'en-ru';
let speakerGend  = 'male';
let listenerGend = 'male';
let favFormal    = false;
let favCasual    = false;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI STRINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LANG = {
  'en-ru': {
    speakerLabel:'ğŸ‘¤ I am speaking as...',listenerLabel:'ğŸ—£ï¸ I am talking to...',
    male:'ğŸ‘¨ Male',female:'ğŸ‘© Female',
    placeholder:'âœï¸  Type or paste your text here...',charsLabel:'characters',
    translateBtn:'Translate',loading:'Translatingâ€¦ ğŸŒ',kbToggle:'âŒ¨ï¸ Russian keyboard',
    resultsHeader:'âœ¨ Translations',formalLabel:'ğŸ© Formal',casualLabel:'ğŸ˜Š Casual',
    breakdownTitle:'ğŸ“š Word & Phrase Breakdown â€” for learning',
    thType:'Type',thOrig:'Original',thTrans:'Translation',thNotes:'Notes',
    analysing:'ğŸ” Analysingâ€¦',noBreakdown:'No breakdown available.',
    noText:'âœï¸ Please type some text first!',copied:'ğŸ“‹ Copied!',
    tagVerb:'Verb',tagNoun:'Noun',tagAdj:'Adj',tagAdv:'Adverb',tagPhrase:'Phrase',
    noteVerbF:'ğŸ‘© fem. form',noteNoun:'ğŸ“Œ learn gender',notePhrase:'ğŸ’¬ Phrase',
    formalNote:'ğŸ© Polite "Ğ’Ñ‹" â€” business & strangers',
    casualNote:'ğŸ˜Š Friendly "Ñ‚Ñ‹" â€” friends & family',
    formalNoteRu:'ğŸ© Direct translation',casualNoteRu:'ğŸ˜Š Casual Russian form',
    historyHeader:'ğŸ• Recent Translations',phraseHeader:'ğŸ“– Phrasebook',
    howtoHeader:'ğŸ—£ï¸ How to Say it in Russian â€” 50 Essential Phrases',
    faqTitle:'â“ Frequently Asked Questions',
    errText:'âŒ Translation failed â€” check your connection.',
    detectText:'Auto-detected',autoDetectMsg:'Language auto-detected ğŸ”',
    themeLight:'â˜€ï¸ Light',themeDark:'ğŸŒ™ Dark',
    searchPlaceholder:'ğŸ”  Search phrases...',
  },
  'ru-en': {
    speakerLabel:'ğŸ‘¤ Ğ¯ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ ĞºĞ°Ğº...',listenerLabel:'ğŸ—£ï¸ Ğ¯ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ°Ñ€Ğ¸Ğ²Ğ°Ñ Ñ...',
    male:'ğŸ‘¨ ĞœÑƒĞ¶Ñ‡Ğ¸Ğ½Ğ°',female:'ğŸ‘© Ğ–ĞµĞ½Ñ‰Ğ¸Ğ½Ğ°',
    placeholder:'âœï¸  Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ·Ğ´ĞµÑÑŒ...',charsLabel:'ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²',
    translateBtn:'ĞŸĞµÑ€ĞµĞ²ĞµÑÑ‚Ğ¸',loading:'ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ğ¼â€¦ ğŸŒ',kbToggle:'âŒ¨ï¸ Ğ ÑƒÑ. ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ°',
    resultsHeader:'âœ¨ ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹',formalLabel:'ğŸ© ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹',casualLabel:'ğŸ˜Š ĞĞµÑ„Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹',
    breakdownTitle:'ğŸ“š Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ ÑĞ»Ğ¾Ğ² Ğ¸ Ñ„Ñ€Ğ°Ğ· â€” Ğ´Ğ»Ñ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ',
    thType:'Ğ¢Ğ¸Ğ¿',thOrig:'ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»',thTrans:'ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´',thNotes:'Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸',
    analysing:'ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼â€¦',noBreakdown:'Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.',
    noText:'âœï¸ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚!',copied:'ğŸ“‹ Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!',
    tagVerb:'Ğ“Ğ»Ğ°Ğ³Ğ¾Ğ»',tagNoun:'Ğ¡ÑƒÑ‰ĞµÑÑ‚.',tagAdj:'ĞŸÑ€Ğ¸Ğ»Ğ°Ğ³.',tagAdv:'ĞĞ°Ñ€ĞµÑ‡Ğ¸Ğµ',tagPhrase:'Ğ¤Ñ€Ğ°Ğ·Ğ°',
    noteVerbF:'ğŸ‘© Ğ¶ĞµĞ½ÑĞºĞ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°',noteNoun:'ğŸ“Œ Ğ·Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ Ñ€Ğ¾Ğ´',notePhrase:'ğŸ’¬ Ğ¤Ñ€Ğ°Ğ·Ğ°',
    formalNote:'ğŸ© ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´',casualNote:'ğŸ˜Š Ğ˜Ğ· Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ñ‹',
    formalNoteRu:'ğŸ© ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´',casualNoteRu:'ğŸ˜Š Ğ˜Ğ· Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ñ‹',
    historyHeader:'ğŸ• ĞĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹',phraseHeader:'ğŸ“– Ğ Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ğ¸Ğº',
    howtoHeader:'ğŸ—£ï¸ ĞšĞ°Ğº ÑÑ‚Ğ¾ ÑĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ¾-Ñ€ÑƒÑÑĞºĞ¸ â€” 50 Ñ„Ñ€Ğ°Ğ·',
    faqTitle:'â“ Ğ§Ğ°ÑÑ‚Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹',
    errText:'âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ.',
    detectText:'ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸',autoDetectMsg:'Ğ¯Ğ·Ñ‹Ğº Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ğŸ”',
    themeLight:'â˜€ï¸ Ğ¡Ğ²ĞµÑ‚Ğ»Ğ°Ñ',themeDark:'ğŸŒ™ Ğ¢Ñ‘Ğ¼Ğ½Ğ°Ñ',
    searchPlaceholder:'ğŸ”  ĞŸĞ¾Ğ¸ÑĞº Ñ„Ñ€Ğ°Ğ·...',
  }
};
const t = k => (LANG[direction][k] || LANG['en-ru'][k] || '');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPDATE UI TEXT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateUI() {
  const ids = {
    speakerLabel:['speakerLabel','textContent'],listenerLabel:['listenerLabel','textContent'],
    male:['mL1','textContent'],female:['fL1','textContent'],
    male:['mL2','textContent'],female:['fL2','textContent'],
    charsLabel:['charsLabel','textContent'],translateBtn:['translateBtnText','textContent'],
    loading:['loadingText','textContent'],resultsHeader:['resultsHeader','textContent'],
    formalLabel:['formalLabel','textContent'],casualLabel:['casualLabel','textContent'],
    breakdownTitle:['breakdownTitle','textContent'],
    thType:['thType','textContent'],thOrig:['thOrig','textContent'],
    thTrans:['thTrans','textContent'],thNotes:['thNotes','textContent'],
    historyHeader:['historyHeader','textContent'],phraseHeader:['phraseHeader','textContent'],
    howtoHeader:['howtoHeader','textContent'],faqTitle:['faqTitle','textContent'],
    detectText:['detectText','textContent'],
  };
  document.getElementById('speakerLabel').textContent  = t('speakerLabel');
  document.getElementById('listenerLabel').textContent = t('listenerLabel');
  document.getElementById('mL1').textContent = t('male');
  document.getElementById('fL1').textContent = t('female');
  document.getElementById('mL2').textContent = t('male');
  document.getElementById('fL2').textContent = t('female');
  document.getElementById('inputText').placeholder     = t('placeholder');
  document.getElementById('charsLabel').textContent    = t('charsLabel');
  document.getElementById('translateBtnText').textContent = t('translateBtn');
  document.getElementById('loadingText').textContent   = t('loading');
  document.getElementById('resultsHeader').textContent = t('resultsHeader');
  document.getElementById('formalLabel').textContent   = t('formalLabel');
  document.getElementById('casualLabel').textContent   = t('casualLabel');
  document.getElementById('breakdownTitle').textContent= t('breakdownTitle');
  document.getElementById('thType').textContent  = t('thType');
  document.getElementById('thOrig').textContent  = t('thOrig');
  document.getElementById('thTrans').textContent = t('thTrans');
  document.getElementById('thNotes').textContent = t('thNotes');
  document.getElementById('howtoHeader').textContent   = t('howtoHeader');
  document.getElementById('phraseHeader').textContent  = t('phraseHeader');
  document.getElementById('faqTitle').textContent      = t('faqTitle');
  document.getElementById('detectText').textContent    = t('detectText');
  document.getElementById('kbToggle').textContent      = t('kbToggle');
  document.getElementById('howtoSearch').placeholder   = t('searchPlaceholder');
  const isDark = document.body.dataset.theme === 'dark';
  document.getElementById('themeBtn').textContent = isDark ? t('themeLight') : t('themeDark');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleTheme() {
  const isDark = document.body.dataset.theme === 'dark';
  document.body.dataset.theme = isDark ? 'light' : 'dark';
  localStorage.setItem('theme', document.body.dataset.theme);
  updateUI();
}
function loadTheme() {
  const saved = localStorage.getItem('theme');
  if (saved) document.body.dataset.theme = saved;
  updateUI();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANGUAGE SWAP + AUTO-DETECT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function swapDirection() {
  direction = direction === 'en-ru' ? 'ru-en' : 'en-ru';
  syncPills();
  document.getElementById('results').classList.remove('show');
  document.getElementById('inputText').value = '';
  document.getElementById('charNum').textContent = '0';
  document.getElementById('detectPill').classList.remove('show');
  updateUI();
  renderPhrasebook('business');
  renderHowTo();
}
function syncPills() {
  document.getElementById('srcPill').textContent = direction === 'en-ru' ? 'ğŸ‡¬ğŸ‡§ English' : 'ğŸ‡·ğŸ‡º Russian';
  document.getElementById('tgtPill').textContent = direction === 'en-ru' ? 'ğŸ‡·ğŸ‡º Russian' : 'ğŸ‡¬ğŸ‡§ English';
  document.getElementById('srcPill').classList.add('active-lang');
  document.getElementById('tgtPill').classList.remove('active-lang');
}
function setGender(role, val) {
  if (role === 'speaker') {
    speakerGend = val;
    document.getElementById('sp-m').classList.toggle('on', val === 'male');
    document.getElementById('sp-f').classList.toggle('on', val === 'female');
  } else {
    listenerGend = val;
    document.getElementById('ls-m').classList.toggle('on', val === 'male');
    document.getElementById('ls-f').classList.toggle('on', val === 'female');
  }
}
function autoDetect(text) {
  const hasCyrillic = /[Ğ°-ÑÑ‘Ğ-Ğ¯Ğ]/.test(text);
  const wanted = hasCyrillic ? 'ru-en' : 'en-ru';
  if (wanted !== direction) {
    direction = wanted;
    syncPills();
    updateUI();
    document.getElementById('detectPill').classList.add('show');
    renderPhrasebook('business');
    renderHowTo();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INPUT HANDLERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function onInput() {
  const v = document.getElementById('inputText').value;
  document.getElementById('charNum').textContent = v.length;
  if (v.length > 4) autoDetect(v);
  if (!v) document.getElementById('detectPill').classList.remove('show');
}
function countChars() { onInput(); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIRTUAL KEYBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleKB() {
  const kb = document.getElementById('vkeyboard');
  const btn = document.getElementById('kbToggle');
  const enKb = document.getElementById('enkeyboard');
  const enBtn = document.getElementById('enKbToggle');
  // close english if open
  enKb.classList.remove('show'); enBtn.classList.remove('on');
  kb.classList.toggle('show');
  btn.classList.toggle('on');
}
function toggleENKB() {
  const enKb = document.getElementById('enkeyboard');
  const enBtn = document.getElementById('enKbToggle');
  const ruKb = document.getElementById('vkeyboard');
  const ruBtn = document.getElementById('kbToggle');
  // close russian if open
  ruKb.classList.remove('show'); ruBtn.classList.remove('on');
  enKb.classList.toggle('show');
  enBtn.classList.toggle('on');
}
function vk(char) {
  const ta = document.getElementById('inputText');
  const s = ta.selectionStart, e = ta.selectionEnd;
  ta.value = ta.value.slice(0,s) + char + ta.value.slice(e);
  ta.selectionStart = ta.selectionEnd = s + char.length;
  ta.focus();
  onInput();
}
function vkBs() {
  const ta = document.getElementById('inputText');
  const s = ta.selectionStart;
  if (s > 0) {
    ta.value = ta.value.slice(0,s-1) + ta.value.slice(s);
    ta.selectionStart = ta.selectionEnd = s - 1;
  }
  ta.focus();
  onInput();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(el._t);
  el._t = setTimeout(() => el.classList.remove('show'), 2000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COPY / SPEAK / FAV / SHARE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function copyCard(id) {
  const txt = document.getElementById(id).textContent;
  try { await navigator.clipboard.writeText(txt); }
  catch { const ta = Object.assign(document.createElement('textarea'),{value:txt}); document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); }
  showToast(t('copied'));
}
function speakCard(id, type) {
  const txt = document.getElementById(id).textContent;
  if (!txt || !window.speechSynthesis) { showToast('ğŸ”‡ TTS not supported in this browser'); return; }
  window.speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(txt);
  u.lang = direction === 'en-ru' ? 'ru-RU' : 'en-US';
  u.rate = 0.9;
  window.speechSynthesis.speak(u);
  showToast('ğŸ”Š Speakingâ€¦');
}
function toggleFav(type) {
  const key = 'fav_' + type;
  const btn = document.getElementById('fav' + (type === 'formal' ? 'Formal' : 'Casual'));
  const txt = document.getElementById(type + 'Text').textContent;
  const stored = JSON.parse(localStorage.getItem('favourites') || '[]');
  const idx = stored.findIndex(f => f.text === txt);
  if (idx > -1) {
    stored.splice(idx, 1);
    btn.classList.remove('starred');
    showToast('ğŸ’” Removed from favourites');
  } else {
    stored.unshift({ text: txt, type, direction, ts: Date.now() });
    btn.classList.add('starred');
    showToast('â­ Saved to favourites!');
  }
  localStorage.setItem('favourites', JSON.stringify(stored.slice(0,30)));
}
function shareLink() {
  const input = document.getElementById('inputText').value.trim();
  if (!input) { showToast(t('noText')); return; }
  try {
    const data = btoa(encodeURIComponent(JSON.stringify({ input, direction })));
    const url = location.href.split('#')[0] + '#' + data;
    navigator.clipboard.writeText(url);
    showToast('ğŸ”— Link copied to clipboard!');
  } catch { showToast('âŒ Could not copy link'); }
}
function shareFB() {
  const url = encodeURIComponent(location.href.split('#')[0]);
  window.open('https://www.facebook.com/sharer/sharer.php?u=' + url, '_blank');
}
function shareWA() {
  const formal = document.getElementById('formalText').textContent;
  const input  = document.getElementById('inputText').value.trim();
  const msg = encodeURIComponent(`"${input}" â†’ "${formal}" via Mytheon Russian Translator`);
  window.open('https://wa.me/?text=' + msg, '_blank');
}
function shareLinkedIn() {
  const url = encodeURIComponent(location.href.split('#')[0]);
  window.open('https://www.linkedin.com/sharing/share-offsite/?url=' + url, '_blank');
}
function reportBad() {
  showToast('ğŸ™ Thank you! Reported for review.');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRANSLATION API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function fetchGoogle(text, sl, tl) {
  const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sl}&tl=${tl}&dt=t&q=${encodeURIComponent(text)}`;
  const r = await fetch(url);
  if (!r.ok) throw new Error('HTTP ' + r.status);
  const d = await r.json();
  return d[0].map(s => s[0]).join('');
}
const delay = ms => new Promise(res => setTimeout(res, ms));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRANSLITERATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TRANSLIT = {'Ğ°':'a','Ğ±':'b','Ğ²':'v','Ğ³':'g','Ğ´':'d','Ğµ':'ye','Ñ‘':'yo','Ğ¶':'zh','Ğ·':'z','Ğ¸':'i','Ğ¹':'y','Ğº':'k','Ğ»':'l','Ğ¼':'m','Ğ½':'n','Ğ¾':'o','Ğ¿':'p','Ñ€':'r','Ñ':'s','Ñ‚':'t','Ñƒ':'u','Ñ„':'f','Ñ…':'kh','Ñ†':'ts','Ñ‡':'ch','Ñˆ':'sh','Ñ‰':'shch','ÑŠ':'','Ñ‹':'y','ÑŒ':'','Ñ':'e','Ñ':'yu','Ñ':'ya','Ğ':'A','Ğ‘':'B','Ğ’':'V','Ğ“':'G','Ğ”':'D','Ğ•':'Ye','Ğ':'Yo','Ğ–':'Zh','Ğ—':'Z','Ğ˜':'I','Ğ™':'Y','Ğš':'K','Ğ›':'L','Ğœ':'M','Ğ':'N','Ğ':'O','ĞŸ':'P','Ğ ':'R','Ğ¡':'S','Ğ¢':'T','Ğ£':'U','Ğ¤':'F','Ğ¥':'Kh','Ğ¦':'Ts','Ğ§':'Ch','Ğ¨':'Sh','Ğ©':'Shch','Ğª':'','Ğ«':'Y','Ğ¬':'','Ğ­':'E','Ğ®':'Yu','Ğ¯':'Ya'};
function transliterate(text) { return text.split('').map(c => TRANSLIT[c] !== undefined ? TRANSLIT[c] : c).join(''); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RUSSIAN GRAMMAR HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TY2VY = [[/\bÑ‚Ñ‹\b/g,'Ğ’Ñ‹'],[/\bÑ‚ĞµĞ±Ñ\b/g,'Ğ’Ğ°Ñ'],[/\bÑ‚ĞµĞ±Ğµ\b/g,'Ğ’Ğ°Ğ¼'],[/\bÑ‚Ğ¾Ğ±Ğ¾Ğ¹\b/g,'Ğ’Ğ°Ğ¼Ğ¸'],[/\bÑ‚Ğ²Ğ¾Ğ¹\b/g,'Ğ’Ğ°Ñˆ'],[/\bÑ‚Ğ²Ğ¾Ñ\b/g,'Ğ’Ğ°ÑˆĞ°'],[/\bÑ‚Ğ²Ğ¾Ñ‘\b/g,'Ğ’Ğ°ÑˆĞµ'],[/\bÑ‚Ğ²Ğ¾Ğ¸\b/g,'Ğ’Ğ°ÑˆĞ¸'],[/\bÑ‚Ğ²Ğ¾ĞµĞ³Ğ¾\b/g,'Ğ’Ğ°ÑˆĞµĞ³Ğ¾'],[/\bÑ‚Ğ²Ğ¾ĞµĞ¹\b/g,'Ğ’Ğ°ÑˆĞµĞ¹'],[/\bÑ‚Ğ²Ğ¾ĞµĞ¼Ñƒ\b/g,'Ğ’Ğ°ÑˆĞµĞ¼Ñƒ']];
const VY2TY = [[/\bĞ’Ñ‹\b/g,'Ñ‚Ñ‹'],[/\bĞ’Ğ°Ñ\b/g,'Ñ‚ĞµĞ±Ñ'],[/\bĞ’Ğ°Ğ¼\b/g,'Ñ‚ĞµĞ±Ğµ'],[/\bĞ’Ğ°Ğ¼Ğ¸\b/g,'Ñ‚Ğ¾Ğ±Ğ¾Ğ¹'],[/\bĞ’Ğ°Ñˆ\b/g,'Ñ‚Ğ²Ğ¾Ğ¹'],[/\bĞ’Ğ°ÑˆĞ°\b/g,'Ñ‚Ğ²Ğ¾Ñ'],[/\bĞ’Ğ°ÑˆĞµ\b/g,'Ñ‚Ğ²Ğ¾Ñ‘'],[/\bĞ’Ğ°ÑˆĞ¸\b/g,'Ñ‚Ğ²Ğ¾Ğ¸'],[/\bĞ’Ğ°ÑˆĞµĞ³Ğ¾\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ³Ğ¾'],[/\bĞ’Ğ°ÑˆĞµĞ¹\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ¹'],[/\bĞ’Ğ°ÑˆĞµĞ¼Ñƒ\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ¼Ñƒ']];
const GEND_F = [[/\bĞ¿Ñ€Ğ¸ÑˆÑ‘Ğ»\b/g,'Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ°'],[/\bÑƒÑˆÑ‘Ğ»\b/g,'ÑƒÑˆĞ»Ğ°'],[/\bĞ½Ğ°ÑˆÑ‘Ğ»\b/g,'Ğ½Ğ°ÑˆĞ»Ğ°'],[/\bĞ±Ñ‹Ğ»\b/g,'Ğ±Ñ‹Ğ»Ğ°'],[/\bÑĞºĞ°Ğ·Ğ°Ğ»\b/g,'ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°'],[/\bĞ¿Ğ¾ĞµÑ…Ğ°Ğ»\b/g,'Ğ¿Ğ¾ĞµÑ…Ğ°Ğ»Ğ°'],[/\bĞ¿Ñ€Ğ¸ĞµÑ…Ğ°Ğ»\b/g,'Ğ¿Ñ€Ğ¸ĞµÑ…Ğ°Ğ»Ğ°'],[/\bÑĞ´ĞµĞ»Ğ°Ğ»\b/g,'ÑĞ´ĞµĞ»Ğ°Ğ»Ğ°'],[/\bĞ¿Ğ¾ÑˆÑ‘Ğ»\b/g,'Ğ¿Ğ¾ÑˆĞ»Ğ°'],[/\bÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»\b/g,'Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ°'],[/\bĞ·Ğ½Ğ°Ğ»\b/g,'Ğ·Ğ½Ğ°Ğ»Ğ°'],[/\bĞ´ÑƒĞ¼Ğ°Ğ»\b/g,'Ğ´ÑƒĞ¼Ğ°Ğ»Ğ°'],[/\bÑ…Ğ¾Ñ‚ĞµĞ»\b/g,'Ñ…Ğ¾Ñ‚ĞµĞ»Ğ°'],[/\bĞ¼Ğ¾Ğ³\b/g,'Ğ¼Ğ¾Ğ³Ğ»Ğ°'],[/\bÑƒÑÑ‚Ğ°Ğ»\b/g,'ÑƒÑÑ‚Ğ°Ğ»Ğ°'],[/\bÑ€Ğ°Ğ´\b/g,'Ñ€Ğ°Ğ´Ğ°'],[/\bĞ¿Ğ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ğ»\b/g,'Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ğ»Ğ°'],[/\bÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ»\b/g,'ÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ»Ğ°'],[/\bĞ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»\b/g,'Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»Ğ°'],[/\bÑ€ĞµÑˆĞ¸Ğ»\b/g,'Ñ€ĞµÑˆĞ¸Ğ»Ğ°'],[/\bĞ½Ğ°Ñ‡Ğ°Ğ»\b/g,'Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°'],[/\bĞ¿Ğ¾Ğ½ÑĞ»\b/g,'Ğ¿Ğ¾Ğ½ÑĞ»Ğ°'],[/\bĞ²Ğ·ÑĞ»\b/g,'Ğ²Ğ·ÑĞ»Ğ°'],[/\bĞ´Ğ°Ğ»\b/g,'Ğ´Ğ°Ğ»Ğ°']];
const LSTN_F = [[/\bĞ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹\b/g,'Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ'],[/\bÑƒĞ²Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğ¹\b/g,'ÑƒĞ²Ğ°Ğ¶Ğ°ĞµĞ¼Ğ°Ñ'],[/\bĞ¼Ğ¸Ğ»Ñ‹Ğ¹\b/g,'Ğ¼Ğ¸Ğ»Ğ°Ñ']];
function applyMap(txt, map) { let o=txt; map.forEach(([re,rep])=>{o=o.replace(re,rep);}); return o; }
function makeFormal(t)  { return applyMap(t, TY2VY); }
function makeCasual(t)  { return applyMap(t, VY2TY); }
function applyGender(t,g) { return g==='female' ? applyMap(t,GEND_F) : t; }
function applyLstn(t,g)   { return g==='female' ? applyMap(t,LSTN_F) : t; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GRAMMAR TIP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TIPS = {
  'en-ru': [
    [/\bĞ±Ñ‹Ğ»Ğ°?\b/,  'ğŸ’¡ <strong>Gender tip:</strong> "Ğ±Ñ‹Ğ»" = he was (male), "Ğ±Ñ‹Ğ»Ğ°" = she was (female). Russian past tense changes with speaker gender.'],
    [/\bĞ’Ñ‹\b/,     'ğŸ’¡ <strong>Formal tip:</strong> "Ğ’Ñ‹" (capital V) is the polite/formal "you". Always use it with strangers, managers and official contacts.'],
    [/\bÑ‚Ñ‹\b/,     'ğŸ’¡ <strong>Casual tip:</strong> "Ñ‚Ñ‹" is the informal "you". Use with friends, family and peers.'],
    [/\bĞ½Ğµ\b/,     'ğŸ’¡ <strong>Negation tip:</strong> "Ğ½Ğµ" means "not" in Russian and always comes directly before the verb it negates.'],
  ],
  'ru-en': [
    [/.+/, 'ğŸ’¡ <strong>Learning tip:</strong> Russian verbs have two aspects â€” perfective (completed action) and imperfective (ongoing). This affects the meaning significantly.'],
  ]
};
function showGrammarTip(text) {
  const tips = TIPS[direction] || [];
  const tip = document.getElementById('grammarTip');
  for (const [re, msg] of tips) {
    if (re.test(text)) {
      tip.innerHTML = msg;
      tip.classList.add('show');
      return;
    }
  }
  tip.classList.remove('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN TRANSLATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function doTranslate() {
  const input = document.getElementById('inputText').value.trim();
  if (!input) { showToast(t('noText')); return; }

  const sl = direction === 'en-ru' ? 'en' : 'ru';
  const tl = direction === 'en-ru' ? 'ru' : 'en';

  const btn = document.getElementById('translateBtn');
  btn.disabled = true;
  document.getElementById('translateBtnText').textContent = 'â³ ' + t('translateBtn') + 'â€¦';
  document.getElementById('loading').classList.add('show');
  document.getElementById('results').classList.remove('show');

  try {
    let base = await fetchGoogle(input, sl, tl);
    let formal, casual;

    if (direction === 'en-ru') {
      base   = applyGender(base, speakerGend);
      base   = applyLstn(base, listenerGend);
      formal = makeFormal(base);
      casual = makeCasual(base);
      document.getElementById('formalNote').textContent = t('formalNote');
      document.getElementById('casualNote').textContent = t('casualNote');
      document.getElementById('formalTranslit').textContent = transliterate(formal);
      document.getElementById('casualTranslit').textContent = transliterate(casual);
    } else {
      formal = base;
      await delay(300);
      try {
        casual = await fetchGoogle(makeCasual(input), sl, tl);
        if (casual.toLowerCase() === formal.toLowerCase()) casual = base;
      } catch { casual = base; }
      document.getElementById('formalNote').textContent = t('formalNoteRu');
      document.getElementById('casualNote').textContent = t('casualNoteRu');
      document.getElementById('formalTranslit').textContent = '';
      document.getElementById('casualTranslit').textContent = '';
    }

    document.getElementById('formalText').textContent = formal;
    document.getElementById('casualText').textContent = casual;

    // Reset fav buttons
    document.getElementById('favFormal').classList.remove('starred');
    document.getElementById('favCasual').classList.remove('starred');

    showGrammarTip(formal);

    document.getElementById('loading').classList.remove('show');
    document.getElementById('results').classList.add('show');

    saveHistory(input, formal, casual);
    await buildBreakdown(input, sl, tl);

  } catch (err) {
    document.getElementById('loading').classList.remove('show');
    document.getElementById('results').classList.add('show');
    document.getElementById('formalText').textContent = t('errText');
    document.getElementById('casualText').textContent = '';
    document.getElementById('formalTranslit').textContent = '';
    document.getElementById('casualTranslit').textContent = '';
    document.getElementById('breakdownBody').innerHTML =
      `<tr><td colspan="4" style="padding:13px 16px;color:#ef4444">Error: ${err.message}</td></tr>`;
  }

  btn.disabled = false;
  document.getElementById('translateBtnText').textContent = t('translateBtn');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORD BREAKDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EN_STOP = new Set(['the','a','an','in','on','at','to','for','of','and','or','but','is','it','i','my','me','you','your','he','she','we','they','this','that','with','from','not','are','was','were','be','have','has','had','do','does','did','will','would','could','should','may','might','as','by','up','if','so','no','yes','just','also','very','more']);
const RU_STOP = new Set(['Ğ¸','Ğ²','Ğ½Ğ°','Ñ','Ğ¿Ğ¾','Ğ´Ğ»Ñ','Ğ¾Ñ‚','Ğ¸Ğ·','Ğº','Ğ°','Ğ½Ğ¾','Ñ‡Ñ‚Ğ¾','ÑÑ‚Ğ¾','Ñ','Ñ‚Ñ‹','Ğ¾Ğ½','Ğ¾Ğ½Ğ°','Ğ¼Ñ‹','Ğ²Ñ‹','Ğ¾Ğ½Ğ¸','Ğ½Ğµ','Ğ´Ğ°','Ğ½ĞµÑ‚','Ğ¶Ğµ','ÑƒĞ¶Ğµ','ĞºĞ°Ğº','Ñ‚Ğ°Ğº','Ğ±Ñ‹','Ğ»Ğ¸','Ğ¸Ğ»Ğ¸','Ñ‚Ğ¾','Ğ²ÑÑ‘','Ñ‚Ğ°Ğ¼','Ñ‚ÑƒÑ‚','ĞµÑ‰Ñ‘','Ğ²Ğ¾Ñ‚']);
function detectType(w) {
  const lo = w.toLowerCase(), ru = /[Ğ°-ÑÑ‘]/i.test(lo);
  if (!ru) {
    if (['is','are','was','were','be','have','has','had','do','does','did','go','went','come','came','want','like','love','need','know','think','see','look','say','tell','ask','work','live','feel','call','get','put','give','take','make','help','try','use','keep','play','hear','speak','write','read','meet','run','turn'].includes(lo) || lo.endsWith('ing')||lo.endsWith('ate')||lo.endsWith('ify')) return 'verb';
    if (lo.endsWith('ly')) return 'adverb';
    if (lo.endsWith('ful')||lo.endsWith('less')||lo.endsWith('ous')||lo.endsWith('ive')||lo.endsWith('al')) return 'adj';
  } else {
    if (lo.endsWith('Ñ‚ÑŒ')||lo.endsWith('Ñ‚ÑÑ')||lo.endsWith('Ğ°Ñ‚ÑŒ')||lo.endsWith('ĞµÑ‚')||lo.endsWith('ÑÑ‚')) return 'verb';
    if (lo.endsWith('Ğ½Ğ¾')||lo.endsWith('ÑĞºĞ¸')) return 'adverb';
    if (lo.endsWith('Ñ‹Ğ¹')||lo.endsWith('Ğ¸Ğ¹')||lo.endsWith('Ğ¾Ğ¹')||lo.endsWith('Ğ°Ñ')) return 'adj';
  }
  return 'noun';
}
function getTagCfg() {
  return { verb:{emoji:'âš¡',css:'tag-verb',label:t('tagVerb')}, noun:{emoji:'ğŸ“¦',css:'tag-noun',label:t('tagNoun')}, adj:{emoji:'ğŸ¨',css:'tag-adj',label:t('tagAdj')}, adverb:{emoji:'ğŸ’¨',css:'tag-adv',label:t('tagAdv')}, phrase:{emoji:'ğŸ’¬',css:'tag-phrase',label:t('tagPhrase')} };
}
function extractWords(text) {
  const stop = direction==='ru-en' ? RU_STOP : EN_STOP;
  return [...new Set(text.split(/\s+/).map(w=>w.replace(/[^a-zA-ZĞ°-ÑÑ‘Ğ-Ğ¯Ğ]/g,'').toLowerCase()).filter(w=>w.length>3&&!stop.has(w)))].slice(0,6);
}
function extractPhrases(text) {
  const ws = text.trim().split(/\s+/); const out=[];
  for (let i=0;i<Math.min(ws.length-1,3);i++){const p=ws[i]+' '+ws[i+1]; if(p.replace(/[^a-zA-ZĞ°-ÑÑ‘Ğ-Ğ¯Ğ]/g,'').length>5) out.push(p);}
  return out.slice(0,2);
}
async function buildBreakdown(input, sl, tl) {
  const tbody = document.getElementById('breakdownBody');
  tbody.innerHTML = `<tr><td colspan="4" style="padding:13px 16px;color:var(--xfaint)">${t('analysing')}</td></tr>`;
  const words=extractWords(input), phrases=extractPhrases(input), rows=[];
  for (const w of words) {
    try { await delay(140); const tr=await fetchGoogle(w,sl,tl); const type=detectType(w); let note='';
      if(direction==='en-ru'&&type==='verb'&&speakerGend==='female') note=t('noteVerbF');
      else if(direction==='en-ru'&&type==='noun') note=t('noteNoun');
      rows.push({type,orig:w,trans:tr,note}); } catch {}
  }
  for (const ph of phrases) {
    try { await delay(140); const tr=await fetchGoogle(ph,sl,tl); rows.push({type:'phrase',orig:ph,trans:tr,note:t('notePhrase')}); } catch {}
  }
  tbody.innerHTML = '';
  if (!rows.length) { tbody.innerHTML=`<tr><td colspan="4" style="padding:13px 16px;color:var(--xfaint)">${t('noBreakdown')}</td></tr>`; return; }
  const TAG = getTagCfg();
  rows.forEach(({type,orig,trans,note})=>{
    const cfg=TAG[type]||TAG.noun, tr=document.createElement('tr');
    tr.innerHTML=`<td><span class="tag ${cfg.css}">${cfg.emoji} ${cfg.label}</span></td><td class="orig-word">${orig}</td><td class="trans-word">${trans}</td><td class="note-cell">${note}</td>`;
    tbody.appendChild(tr);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HISTORY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveHistory(input, formal, casual) {
  const stored = JSON.parse(localStorage.getItem('history') || '[]');
  stored.unshift({ input, formal, casual, direction, ts: Date.now() });
  localStorage.setItem('history', JSON.stringify(stored.slice(0,15)));
  renderHistory();
}
function loadHistory() { renderHistory(); }
function renderHistory() {
  const stored = JSON.parse(localStorage.getItem('history') || '[]');
  const sec = document.getElementById('historySection');
  const list = document.getElementById('historyList');
  if (!stored.length) { sec.style.display = 'none'; return; }
  sec.style.display = 'block';
  list.innerHTML = '';
  stored.forEach((item, i) => {
    const el = document.createElement('div');
    el.className = 'history-item';
    el.innerHTML = `
      <div style="flex:1;min-width:0">
        <div class="history-text">${item.input}</div>
        <div class="history-sub">${item.formal}</div>
      </div>
      <div class="history-dir">${item.direction === 'en-ru' ? 'ğŸ‡¬ğŸ‡§â†’ğŸ‡·ğŸ‡º' : 'ğŸ‡·ğŸ‡ºâ†’ğŸ‡¬ğŸ‡§'}</div>
      <button class="history-del" onclick="deleteHistory(${i},event)">âœ•</button>`;
    el.addEventListener('click', () => restoreHistory(item));
    list.appendChild(el);
  });
}
function restoreHistory(item) {
  if (item.direction !== direction) swapDirection();
  document.getElementById('inputText').value = item.input;
  onInput();
  document.getElementById('formalText').textContent = item.formal;
  document.getElementById('casualText').textContent = item.casual;
  if (direction === 'en-ru') {
    document.getElementById('formalTranslit').textContent = transliterate(item.formal);
    document.getElementById('casualTranslit').textContent = transliterate(item.casual);
  }
  document.getElementById('results').classList.add('show');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}
function deleteHistory(i, e) {
  e.stopPropagation();
  const stored = JSON.parse(localStorage.getItem('history') || '[]');
  stored.splice(i, 1);
  localStorage.setItem('history', JSON.stringify(stored));
  renderHistory();
}
function clearHistory() {
  localStorage.removeItem('history');
  renderHistory();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PHRASEBOOK DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PHRASES = {
  business:[
    {en:'Good morning',ru:'Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾'},{en:'Please send me the contract',ru:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¼Ğ½Ğµ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€'},
    {en:'I would like to schedule a meeting',ru:'Ğ¯ Ñ…Ğ¾Ñ‚ĞµĞ»(Ğ°) Ğ±Ñ‹ Ğ½Ğ°Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ñƒ'},{en:'Thank you for your time',ru:'Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° ÑƒĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ'},
    {en:'Can we discuss the terms?',ru:'ĞœĞ¾Ğ¶ĞµĞ¼ Ğ»Ğ¸ Ğ¼Ñ‹ Ğ¾Ğ±ÑÑƒĞ´Ğ¸Ñ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ?'},{en:'I look forward to working with you',ru:'Ğ¯ Ñ Ğ½ĞµÑ‚ĞµÑ€Ğ¿ĞµĞ½Ğ¸ĞµĞ¼ Ğ¶Ğ´Ñƒ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° Ñ Ğ²Ğ°Ğ¼Ğ¸'},
    {en:'Please confirm receipt',ru:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ'},{en:'The invoice is attached',ru:'Ğ¡Ñ‡Ñ‘Ñ‚-Ñ„Ğ°ĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¸Ğ»Ğ°Ğ³Ğ°ĞµÑ‚ÑÑ'},
    {en:'I will get back to you shortly',ru:'Ğ¯ ÑĞ²ÑĞ¶ÑƒÑÑŒ Ñ Ğ²Ğ°Ğ¼Ğ¸ Ğ² Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ'},{en:'Best regards',ru:'Ğ¡ ÑƒĞ²Ğ°Ğ¶ĞµĞ½Ğ¸ĞµĞ¼'},
  ],
  travel:[
    {en:'Where is the nearest metro?',ru:'Ğ“Ğ´Ğµ Ğ±Ğ»Ğ¸Ğ¶Ğ°Ğ¹ÑˆĞµĞµ Ğ¼ĞµÑ‚Ñ€Ğ¾?'},{en:'How much does this cost?',ru:'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ¾ ÑÑ‚Ğ¾Ğ¸Ñ‚?'},
    {en:'I need a taxi please',ru:'ĞœĞ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ñ‚Ğ°ĞºÑĞ¸, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°'},{en:'Is breakfast included?',ru:'Ğ—Ğ°Ğ²Ñ‚Ñ€Ğ°Ğº Ğ²ĞºĞ»ÑÑ‡Ñ‘Ğ½?'},
    {en:'Where is the bathroom?',ru:'Ğ“Ğ´Ğµ Ñ‚ÑƒĞ°Ğ»ĞµÑ‚?'},{en:'I have a reservation',ru:'Ğ£ Ğ¼ĞµĞ½Ñ ĞµÑÑ‚ÑŒ Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ'},
    {en:'Can you speak slowly please?',ru:'Ğ“Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°'},{en:'I am lost',ru:'Ğ¯ Ğ·Ğ°Ğ±Ğ»ÑƒĞ´Ğ¸Ğ»ÑÑ / Ğ·Ğ°Ğ±Ğ»ÑƒĞ´Ğ¸Ğ»Ğ°ÑÑŒ'},
    {en:'Two tickets please',ru:'Ğ”Ğ²Ğ° Ğ±Ğ¸Ğ»ĞµÑ‚Ğ°, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°'},{en:'What time does it open?',ru:'Ğ’Ğ¾ ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ?'},
  ],
  romance:[
    {en:'I love you',ru:'Ğ¯ Ñ‚ĞµĞ±Ñ Ğ»ÑĞ±Ğ»Ñ'},{en:'You are beautiful',ru:'Ğ¢Ñ‹ ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ°Ñ / ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¹'},
    {en:'I miss you',ru:'Ğ¯ ÑĞºÑƒÑ‡Ğ°Ñ Ğ¿Ğ¾ Ñ‚ĞµĞ±Ğµ'},{en:'Will you marry me?',ru:'Ğ¢Ñ‹ Ğ²Ñ‹Ğ¹Ğ´ĞµÑˆÑŒ Ğ·Ğ° Ğ¼ĞµĞ½Ñ Ğ·Ğ°Ğ¼ÑƒĞ¶?'},
    {en:'You mean everything to me',ru:'Ğ¢Ñ‹ Ğ·Ğ½Ğ°Ñ‡Ğ¸ÑˆÑŒ Ğ´Ğ»Ñ Ğ¼ĞµĞ½Ñ Ğ²ÑÑ‘'},{en:'I am thinking about you',ru:'Ğ¯ Ğ´ÑƒĞ¼Ğ°Ñ Ğ¾ Ñ‚ĞµĞ±Ğµ'},
    {en:'Let\'s go on a date',ru:'Ğ”Ğ°Ğ²Ğ°Ğ¹ ÑÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ½Ğ° ÑĞ²Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ'},{en:'You make me happy',ru:'Ğ¢Ñ‹ Ğ´ĞµĞ»Ğ°ĞµÑˆÑŒ Ğ¼ĞµĞ½Ñ ÑÑ‡Ğ°ÑÑ‚Ğ»Ğ¸Ğ²Ñ‹Ğ¼'},
    {en:'I have feelings for you',ru:'Ğ¢Ñ‹ Ğ¼Ğ½Ğµ Ğ½Ñ€Ğ°Ğ²Ğ¸ÑˆÑŒÑÑ'},{en:'Kiss me',ru:'ĞŸĞ¾Ñ†ĞµĞ»ÑƒĞ¹ Ğ¼ĞµĞ½Ñ'},
  ],
  medical:[
    {en:'I need a doctor',ru:'ĞœĞ½Ğµ Ğ½ÑƒĞ¶ĞµĞ½ Ğ²Ñ€Ğ°Ñ‡'},{en:'Call an ambulance',ru:'Ğ’Ñ‹Ğ·Ğ¾Ğ²Ğ¸Ñ‚Ğµ ÑĞºĞ¾Ñ€ÑƒÑ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ'},
    {en:'I am allergic to penicillin',ru:'Ğ£ Ğ¼ĞµĞ½Ñ Ğ°Ğ»Ğ»ĞµÑ€Ğ³Ğ¸Ñ Ğ½Ğ° Ğ¿ĞµĞ½Ğ¸Ñ†Ğ¸Ğ»Ğ»Ğ¸Ğ½'},{en:'Where is the pharmacy?',ru:'Ğ“Ğ´Ğµ Ğ°Ğ¿Ñ‚ĞµĞºĞ°?'},
    {en:'I have a headache',ru:'Ğ£ Ğ¼ĞµĞ½Ñ Ğ±Ğ¾Ğ»Ğ¸Ñ‚ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ°'},{en:'I feel sick',ru:'ĞœĞ½Ğµ Ğ¿Ğ»Ğ¾Ñ…Ğ¾'},
    {en:'I need my medication',ru:'ĞœĞ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¼Ğ¾Ñ‘ Ğ»ĞµĞºĞ°Ñ€ÑÑ‚Ğ²Ğ¾'},{en:'I am diabetic',ru:'Ğ£ Ğ¼ĞµĞ½Ñ Ğ´Ğ¸Ğ°Ğ±ĞµÑ‚'},
    {en:'I have chest pain',ru:'Ğ£ Ğ¼ĞµĞ½Ñ Ğ±Ğ¾Ğ»ÑŒ Ğ² Ğ³Ñ€ÑƒĞ´Ğ¸'},{en:'I cannot breathe well',ru:'ĞœĞ½Ğµ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ Ğ´Ñ‹ÑˆĞ°Ñ‚ÑŒ'},
  ],
  emergency:[
    {en:'Help!',ru:'ĞŸĞ¾Ğ¼Ğ¾Ğ³Ğ¸Ñ‚Ğµ!'},{en:'Call the police!',ru:'Ğ’Ñ‹Ğ·Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»Ğ¸Ñ†Ğ¸Ñ!'},
    {en:'Fire!',ru:'ĞŸĞ¾Ğ¶Ğ°Ñ€!'},{en:'I have been robbed',ru:'ĞœĞµĞ½Ñ Ğ¾Ğ³Ñ€Ğ°Ğ±Ğ¸Ğ»Ğ¸'},
    {en:'I am in danger',ru:'Ğ¯ Ğ² Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸'},{en:'Please call the embassy',ru:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ñ‚Ğµ Ğ² Ğ¿Ğ¾ÑĞ¾Ğ»ÑŒÑÑ‚Ğ²Ğ¾'},
    {en:'I need urgent help',ru:'ĞœĞ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ° ÑÑ€Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ'},{en:'There has been an accident',ru:'ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ°Ğ²Ğ°Ñ€Ğ¸Ñ'},
    {en:'Someone is unconscious',ru:'ĞšÑ‚Ğ¾-Ñ‚Ğ¾ Ğ±ĞµĞ· ÑĞ¾Ğ·Ğ½Ğ°Ğ½Ğ¸Ñ'},{en:'I am lost and scared',ru:'Ğ¯ Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ»ÑÑ Ğ¸ Ğ¼Ğ½Ğµ ÑÑ‚Ñ€Ğ°ÑˆĞ½Ğ¾'},
  ],
};
function copyPhrase(text, e) {
  e.stopPropagation();
  navigator.clipboard.writeText(text).catch(() => {
    const ta = Object.assign(document.createElement('textarea'),{value:text});
    document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
  });
  showToast('ğŸ“‹ Copied: ' + text);
}
function renderPhrasebook(tab) {
  const data = PHRASES[tab] || [];
  const html = `<div class="phrase-grid">${data.map(p=>`
    <div class="phrase-card" onclick="loadPhrase('${p.en.replace(/'/g,"\\'")}')">
      <div class="phrase-en">${p.en}</div>
      <div class="phrase-ru">${p.ru}</div>
      <div class="phrase-tr">${transliterate(p.ru)}</div>
      <div class="phrase-card-footer">
        <button class="phrase-copy-btn" onclick="copyPhrase('${p.ru.replace(/'/g,"\\'")}',event)" title="Copy Russian">ğŸ“‹ Copy RU</button>
        <button class="phrase-copy-btn" onclick="copyPhrase('${p.en.replace(/'/g,"\\'")}',event)" title="Copy English" style="margin-left:4px">ğŸ“‹ Copy EN</button>
      </div>
    </div>`).join('')}</div>`;
  document.getElementById('phraseContent').innerHTML = html;
}
function switchTab(tab, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderPhrasebook(tab);
}
function loadPhrase(en) {
  if (direction !== 'en-ru') { direction = 'en-ru'; syncPills(); updateUI(); }
  document.getElementById('inputText').value = en;
  onInput();
  doTranslate();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOW TO SAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const HOW_TO = [
  {en:'Hello',ru:'ĞŸÑ€Ğ¸Ğ²ĞµÑ‚ / Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ'},{en:'Thank you',ru:'Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾'},{en:'Please',ru:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°'},
  {en:'Yes',ru:'Ğ”Ğ°'},{en:'No',ru:'ĞĞµÑ‚'},{en:'Sorry / Excuse me',ru:'Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸Ñ‚Ğµ / ĞŸÑ€Ğ¾ÑÑ‚Ğ¸Ñ‚Ğµ'},
  {en:'Goodbye',ru:'Ğ”Ğ¾ ÑĞ²Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ / ĞŸĞ¾ĞºĞ°'},{en:'I love you',ru:'Ğ¯ Ñ‚ĞµĞ±Ñ Ğ»ÑĞ±Ğ»Ñ'},
  {en:'I don\'t understand',ru:'Ğ¯ Ğ½Ğµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ'},{en:'How much?',ru:'Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ¾Ğ¸Ñ‚?'},
  {en:'Where is...?',ru:'Ğ“Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑÑ...?'},{en:'My name is...',ru:'ĞœĞµĞ½Ñ Ğ·Ğ¾Ğ²ÑƒÑ‚...'},
  {en:'Nice to meet you',ru:'ĞŸÑ€Ğ¸ÑÑ‚Ğ½Ğ¾ Ğ¿Ğ¾Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼Ğ¸Ñ‚ÑŒÑÑ'},{en:'Do you speak English?',ru:'Ğ’Ñ‹ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ¿Ğ¾-Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸?'},
  {en:'I don\'t speak Russian',ru:'Ğ¯ Ğ½Ğµ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ Ğ¿Ğ¾-Ñ€ÑƒÑÑĞºĞ¸'},{en:'Good morning',ru:'Ğ”Ğ¾Ğ±Ñ€Ğ¾Ğµ ÑƒÑ‚Ñ€Ğ¾'},
  {en:'Good evening',ru:'Ğ”Ğ¾Ğ±Ñ€Ñ‹Ğ¹ Ğ²ĞµÑ‡ĞµÑ€'},{en:'Good night',ru:'Ğ¡Ğ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ¾Ğ¹ Ğ½Ğ¾Ñ‡Ğ¸'},
  {en:'Happy birthday',ru:'Ğ¡ Ğ´Ğ½Ñ‘Ğ¼ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ'},{en:'Cheers!',ru:'Ğ—Ğ° Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ!'},
  {en:'I am hungry',ru:'Ğ¯ Ğ³Ğ¾Ğ»Ğ¾Ğ´ĞµĞ½ / Ğ³Ğ¾Ğ»Ğ¾Ğ´Ğ½Ğ°'},{en:'I am tired',ru:'Ğ¯ ÑƒÑÑ‚Ğ°Ğ» / ÑƒÑÑ‚Ğ°Ğ»Ğ°'},
  {en:'That is beautiful',ru:'Ğ­Ñ‚Ğ¾ ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ¾'},{en:'What time is it?',ru:'ĞšĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ‡Ğ°Ñ?'},
  {en:'How are you?',ru:'ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°?'},{en:'Fine, thank you',ru:'Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾, ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾'},
  {en:'Where are you from?',ru:'ĞÑ‚ĞºÑƒĞ´Ğ° Ğ²Ñ‹?'},{en:'I don\'t know',ru:'Ğ¯ Ğ½Ğµ Ğ·Ğ½Ğ°Ñ'},
  {en:'Can you help me?',ru:'Ğ’Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¼Ğ½Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‡ÑŒ?'},{en:'I need...',ru:'ĞœĞ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾...'},
  {en:'How do you say...?',ru:'ĞšĞ°Ğº ÑĞºĞ°Ğ·Ğ°Ñ‚ÑŒ...?'},{en:'Let\'s go',ru:'ĞŸĞ¾ÑˆĞ»Ğ¸'},
  {en:'Wait a moment',ru:'ĞŸĞ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ'},{en:'I am sorry',ru:'ĞœĞ½Ğµ Ğ¶Ğ°Ğ»ÑŒ'},
  {en:'No problem',ru:'ĞĞµÑ‚ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼'},{en:'Of course',ru:'ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾'},
  {en:'Maybe',ru:'ĞœĞ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ'},{en:'Never mind',ru:'ĞĞµ Ğ²Ğ°Ğ¶Ğ½Ğ¾'},
  {en:'Again please',ru:'ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°'},{en:'More slowly please',ru:'ĞŸĞ¾Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½ĞµĞµ, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°'},
  {en:'I understand',ru:'Ğ¯ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ'},{en:'Very good',ru:'ĞÑ‡ĞµĞ½ÑŒ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾'},
  {en:'Welcome',ru:'Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ'},{en:'Congratulations',ru:'ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑÑ'},
  {en:'Good luck',ru:'Ğ£Ğ´Ğ°Ñ‡Ğ¸'},{en:'Take care',ru:'Ğ‘ĞµÑ€ĞµĞ³Ğ¸ ÑĞµĞ±Ñ'},
  {en:'See you later',ru:'Ğ”Ğ¾ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸'},{en:'I miss you',ru:'Ğ¯ ÑĞºÑƒÑ‡Ğ°Ñ Ğ¿Ğ¾ Ñ‚ĞµĞ±Ğµ'},
  {en:'You\'re welcome',ru:'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° / ĞĞµ Ğ·Ğ° Ñ‡Ñ‚Ğ¾'},{en:'It\'s delicious',ru:'Ğ­Ñ‚Ğ¾ Ğ²ĞºÑƒÑĞ½Ğ¾'},
];
function renderHowTo(filter) {
  const grid = document.getElementById('howtoGrid');
  const rows = HOW_TO.filter(r => !filter || r.en.toLowerCase().includes(filter.toLowerCase()) || r.ru.includes(filter));
  grid.innerHTML = rows.map(r => `
    <div class="howto-row" onclick="loadPhrase('${r.en.replace(/'/g,"\\'")}')">
      <span class="howto-en">${r.en}</span>
      <span class="howto-ru">${r.ru}</span>
      <button class="howto-copy-btn" onclick="copyPhrase('${r.ru.replace(/'/g,"\\'")}',event)" title="Copy Russian">ğŸ“‹</button>
    </div>`).join('') || `<div style="padding:12px;color:var(--xfaint);font-size:.88rem;">No matches found</div>`;
}
function filterHowTo(val) { renderHowTo(val); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FAQ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleFaq(btn) {
  const ans = btn.nextElementSibling, isOpen = btn.classList.contains('open');
  document.querySelectorAll('.faq-q.open').forEach(b => { b.classList.remove('open'); b.nextElementSibling.classList.remove('open'); });
  if (!isOpen) { btn.classList.add('open'); ans.classList.add('open'); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD SHORTCUTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('inputText').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); doTranslate(); }
});
document.addEventListener('keydown', e => {
  if (e.ctrlKey && e.key === 'Enter') doTranslate();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   URL SHARE RESTORE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function checkUrlHash() {
  if (!location.hash) return;
  try {
    const { input, direction: d } = JSON.parse(decodeURIComponent(atob(location.hash.slice(1))));
    if (d !== direction) { direction = d; syncPills(); updateUI(); }
    document.getElementById('inputText').value = input;
    onInput();
    doTranslate();
  } catch {}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('load', () => {
  loadTheme();
  renderPhrasebook('business');
  renderHowTo();
  loadHistory();
  checkUrlHash();
});
</script>
</body>
</html>
