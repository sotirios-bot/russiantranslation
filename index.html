<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Best AI English to Russian Translator</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: #f0f4ff;
      min-height: 100vh;
      color: #1a1a2e;
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 20px 40px;
    }

    /* â”€â”€ HEADER â”€â”€ */
    header {
      text-align: center;
      padding: 28px 0 32px;
    }
    header h1 {
      font-size: 2.3rem;
      font-weight: 800;
      color: #2253cb;
      letter-spacing: -0.5px;
      line-height: 1.2;
    }
    header p {
      color: #5570a0;
      margin-top: 10px;
      font-size: 0.97rem;
      letter-spacing: 0.2px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }

    /* â”€â”€ CARD â”€â”€ */
    .card {
      background: #ffffff;
      border: 1px solid #d0dcf5;
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 18px;
      box-shadow: 0 4px 20px rgba(34, 83, 203, 0.07);
    }

    /* â”€â”€ DIRECTION TOGGLE â”€â”€ */
    .direction-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 18px;
      margin-bottom: 24px;
    }
    .lang-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f0f4ff;
      border: 2px solid #d0dcf5;
      border-radius: 50px;
      padding: 10px 22px;
      font-size: 1rem;
      font-weight: 600;
      min-width: 150px;
      justify-content: center;
      color: #3a4a7a;
      transition: border-color 0.2s, color 0.2s;
    }
    .lang-pill.active-lang {
      border-color: #2253cb;
      color: #2253cb;
      background: #eaf0ff;
    }
    .swap-btn {
      background: #2253cb;
      border: none;
      border-radius: 50%;
      width: 48px; height: 48px;
      font-size: 1.3rem;
      cursor: pointer;
      color: #fff;
      transition: transform 0.3s, box-shadow 0.2s, background 0.2s;
      flex-shrink: 0;
      box-shadow: 0 4px 14px rgba(34, 83, 203, 0.3);
    }
    .swap-btn:hover {
      transform: rotate(180deg);
      box-shadow: 0 6px 20px rgba(34, 83, 203, 0.45);
      background: #1a40a8;
    }

    /* â”€â”€ GENDER SELECTORS â”€â”€ */
    .gender-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 22px;
    }
    .gender-box label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: #7a8fb5;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .gender-btns { display: flex; gap: 8px; }
    .g-btn {
      flex: 1;
      padding: 10px 8px;
      border: 2px solid #d0dcf5;
      border-radius: 12px;
      background: #f8faff;
      color: #7a8fb5;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s;
      text-align: center;
      font-weight: 500;
    }
    .g-btn:hover { border-color: #2253cb; color: #2253cb; background: #eaf0ff; }
    .g-btn.on {
      background: #eaf0ff;
      border-color: #2253cb;
      color: #2253cb;
      font-weight: 700;
      box-shadow: 0 0 0 3px rgba(34,83,203,0.1);
    }

    /* â”€â”€ INPUT â”€â”€ */
    .input-wrap { position: relative; }
    textarea {
      width: 100%;
      min-height: 130px;
      background: #f8faff;
      border: 2px solid #d0dcf5;
      border-radius: 14px;
      padding: 16px;
      color: #1a1a2e;
      font-size: 1.05rem;
      font-family: inherit;
      resize: vertical;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      line-height: 1.6;
    }
    textarea:focus {
      border-color: #2253cb;
      box-shadow: 0 0 0 3px rgba(34,83,203,0.1);
      background: #fff;
    }
    textarea::placeholder { color: #b0bcd8; }
    .char-count {
      text-align: right;
      font-size: 0.78rem;
      color: #b0bcd8;
      margin-top: 5px;
    }

    /* â”€â”€ TRANSLATE BTN â”€â”€ */
    .translate-btn {
      width: 100%;
      padding: 16px;
      background: #2253cb;
      border: none;
      border-radius: 14px;
      color: #fff;
      font-size: 1.05rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      cursor: pointer;
      margin-top: 14px;
      transition: all 0.2s;
      box-shadow: 0 4px 16px rgba(34,83,203,0.3);
    }
    .translate-btn:hover:not(:disabled) {
      background: #1a40a8;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(34,83,203,0.4);
    }
    .translate-btn:disabled { opacity: 0.55; cursor: not-allowed; transform: none; }
    .hint {
      text-align: center;
      font-size: 0.75rem;
      color: #b0bcd8;
      margin-top: 8px;
    }
    .hint kbd {
      background: #eaf0ff;
      border: 1px solid #d0dcf5;
      border-radius: 4px;
      padding: 1px 5px;
      color: #2253cb;
      font-size: 0.72rem;
    }

    /* â”€â”€ LOADING â”€â”€ */
    .loading { display: none; text-align: center; padding: 30px; color: #7a8fb5; }
    .loading.show { display: block; }
    .spinner {
      display: inline-block;
      width: 36px; height: 36px;
      border: 3px solid rgba(34,83,203,0.15);
      border-top-color: #2253cb;
      border-radius: 50%;
      animation: spin 0.75s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ RESULTS â”€â”€ */
    .results { display: none; }
    .results.show { display: block; }

    .results-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 14px;
      font-size: 0.78rem;
      color: #7a8fb5;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      font-weight: 700;
    }
    .results-header::before, .results-header::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #d0dcf5;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-bottom: 18px;
    }
    @media (max-width: 680px) { .results-grid { grid-template-columns: 1fr; } }

    .result-card {
      border-radius: 16px;
      padding: 18px;
      border: 2px solid;
      background: #fff;
      position: relative;
      box-shadow: 0 2px 12px rgba(34,83,203,0.06);
    }
    .result-card.formal  { border-color: rgba(34,83,203,0.3);  background: #fafcff; }
    .result-card.casual  { border-color: rgba(251,146,60,0.35); background: #fffaf6; }
    .result-card.alt     { border-color: rgba(34,180,100,0.3);  background: #f6fdf9; }

    .rc-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }
    .rc-label {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      font-weight: 700;
    }
    .formal .rc-label { color: #2253cb; }
    .casual .rc-label { color: #ea7000; }
    .alt    .rc-label { color: #1a9e5c; }

    .copy-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      opacity: 0.4;
      transition: opacity 0.2s, transform 0.2s;
      padding: 2px;
    }
    .copy-btn:hover { opacity: 1; transform: scale(1.2); }

    .rc-text {
      font-size: 1.05rem;
      line-height: 1.7;
      color: #1a1a2e;
      min-height: 48px;
    }
    .rc-note {
      font-size: 0.78rem;
      color: #9aadcc;
      margin-top: 8px;
      font-style: italic;
    }

    /* â”€â”€ BREAKDOWN â”€â”€ */
    .breakdown-card {
      border-radius: 20px;
      overflow: hidden;
      border: 1px solid #d0dcf5;
      background: #fff;
      box-shadow: 0 2px 12px rgba(34,83,203,0.06);
    }
    .breakdown-title {
      padding: 16px 22px 12px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      color: #7a8fb5;
      font-weight: 700;
      border-bottom: 1px solid #eaf0ff;
      background: #fafcff;
    }
    table { width: 100%; border-collapse: collapse; }
    thead th {
      padding: 10px 18px;
      text-align: left;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #9aadcc;
      background: #f8faff;
      border-bottom: 1px solid #eaf0ff;
      font-weight: 700;
    }
    tbody tr { transition: background 0.15s; }
    tbody tr:hover { background: #f8faff; }
    tbody td {
      padding: 11px 18px;
      border-bottom: 1px solid #f0f4ff;
      font-size: 0.93rem;
      vertical-align: middle;
      color: #1a1a2e;
    }
    tbody tr:last-child td { border-bottom: none; }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .tag-verb   { background: rgba(34,83,203,0.1);   color: #2253cb; }
    .tag-noun   { background: rgba(234,112,0,0.1);   color: #ea7000; }
    .tag-phrase { background: rgba(26,158,92,0.1);   color: #1a9e5c; }
    .tag-adj    { background: rgba(160,50,220,0.1);  color: #a032dc; }
    .tag-adv    { background: rgba(220,150,0,0.1);   color: #c68800; }

    .orig-word  { color: #3a4a7a; font-weight: 500; }
    .trans-word { color: #2253cb; font-weight: 700; }
    .note-cell  { color: #9aadcc; font-size: 0.82rem; }

    /* â”€â”€ TOAST â”€â”€ */
    #toast {
      position: fixed;
      bottom: 24px; right: 24px;
      background: #2253cb;
      border-radius: 10px;
      padding: 10px 18px;
      font-size: 0.88rem;
      color: #fff;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.25s, transform 0.25s;
      pointer-events: none;
      z-index: 9999;
      box-shadow: 0 4px 16px rgba(34,83,203,0.35);
    }
    #toast.show { opacity: 1; transform: translateY(0); }

    /* â”€â”€ FOOTER â”€â”€ */
    footer {
      text-align: center;
      padding: 28px 0 12px;
      border-top: 1px solid #d0dcf5;
      margin-top: 10px;
    }
    .footer-brand {
      font-size: 0.88rem;
      font-weight: 700;
      color: #2253cb;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .footer-address {
      font-size: 0.78rem;
      color: #9aadcc;
      margin-top: 4px;
    }
  </style>
</head>
<body>

<div class="app">

  <!-- HEADER -->
  <header>
    <h1>ğŸ‡¬ğŸ‡§ â†” ğŸ‡·ğŸ‡º Best AI English to Russian Translator</h1>
    <p id="subheading">âœ¨ Smart English to Russian and Russian to English translations with gender context, formality levels &amp; learning breakdowns âœ¨</p>
  </header>

  <!-- INPUT CARD -->
  <div class="card">

    <!-- Direction toggle -->
    <div class="direction-row">
      <div class="lang-pill active-lang" id="srcPill">ğŸ‡¬ğŸ‡§ English</div>
      <button class="swap-btn" onclick="swapDirection()" title="Swap languages">â‡„</button>
      <div class="lang-pill" id="tgtPill">ğŸ‡·ğŸ‡º Russian</div>
    </div>

    <!-- Gender selectors -->
    <div class="gender-row">
      <div class="gender-box">
        <label id="speakerLabel">ğŸ‘¤ I am speaking as...</label>
        <div class="gender-btns">
          <button class="g-btn on" id="sp-m" onclick="setGender('speaker','male')"><span id="maleLabel1">ğŸ‘¨ Male</span></button>
          <button class="g-btn"    id="sp-f" onclick="setGender('speaker','female')"><span id="femaleLabel1">ğŸ‘© Female</span></button>
        </div>
      </div>
      <div class="gender-box">
        <label id="listenerLabel">ğŸ—£ï¸ I am talking to...</label>
        <div class="gender-btns">
          <button class="g-btn on" id="ls-m" onclick="setGender('listener','male')"><span id="maleLabel2">ğŸ‘¨ Male</span></button>
          <button class="g-btn"    id="ls-f" onclick="setGender('listener','female')"><span id="femaleLabel2">ğŸ‘© Female</span></button>
        </div>
      </div>
    </div>

    <!-- Textarea -->
    <div class="input-wrap">
      <textarea id="inputText" placeholder="âœï¸  Type or paste your text here..." oninput="countChars()"></textarea>
      <div class="char-count"><span id="charNum">0</span> <span id="charsLabel">characters</span></div>
    </div>

    <button class="translate-btn" id="translateBtn" onclick="doTranslate()">
      ğŸ”„ &nbsp;<span id="translateBtnText">Translate</span>
    </button>
    <p class="hint" id="hintText">Tip: Press <kbd>Ctrl + Enter</kbd> to translate quickly</p>

  </div>

  <!-- LOADING -->
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p style="margin-top:12px; color:#7a8fb5;" id="loadingText">Translatingâ€¦ ğŸŒ</p>
  </div>

  <!-- RESULTS -->
  <div class="results" id="results">

    <div class="results-header" id="resultsHeader">âœ¨ Translations</div>

    <div class="results-grid">
      <div class="result-card formal">
        <div class="rc-head">
          <span class="rc-label" id="formalLabel">ğŸ© Formal</span>
          <button class="copy-btn" onclick="copyCard('formalText')" title="Copy">ğŸ“‹</button>
        </div>
        <div class="rc-text" id="formalText"></div>
        <div class="rc-note" id="formalNote"></div>
      </div>
      <div class="result-card casual">
        <div class="rc-head">
          <span class="rc-label" id="casualLabel">ğŸ˜Š Casual</span>
          <button class="copy-btn" onclick="copyCard('casualText')" title="Copy">ğŸ“‹</button>
        </div>
        <div class="rc-text" id="casualText"></div>
        <div class="rc-note" id="casualNote"></div>
      </div>
      <div class="result-card alt">
        <div class="rc-head">
          <span class="rc-label" id="altLabel">ğŸ’¡ Alternative</span>
          <button class="copy-btn" onclick="copyCard('altText')" title="Copy">ğŸ“‹</button>
        </div>
        <div class="rc-text" id="altText"></div>
        <div class="rc-note" id="altNote"></div>
      </div>
    </div>

    <!-- WORD BREAKDOWN -->
    <div class="breakdown-card" id="breakdownCard">
      <div class="breakdown-title" id="breakdownTitle">ğŸ“š Word &amp; Phrase Breakdown â€” for learning</div>
      <table>
        <thead>
          <tr>
            <th id="thType">Type</th>
            <th id="thOrig">Original</th>
            <th id="thTrans">Translation</th>
            <th id="thNotes">Notes</th>
          </tr>
        </thead>
        <tbody id="breakdownBody">
          <tr><td colspan="4" style="padding:14px 18px; color:#b0bcd8;">Loadingâ€¦</td></tr>
        </tbody>
      </table>
    </div>

  </div>

  <!-- FOOTER -->
  <footer>
    <div class="footer-brand">âš¡ Powered by MYTHEON TECHNOLOGIES</div>
    <div class="footer-address">133/1 Gagarin Avenue, Almaty, Kazakhstan</div>
  </footer>

</div>

<div id="toast">ğŸ“‹ Copied!</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let direction    = 'en-ru';
let speakerGend  = 'male';
let listenerGend = 'male';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI LANGUAGE STRINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LANG = {
  'en-ru': {
    speakerLabel:    'ğŸ‘¤ I am speaking as...',
    listenerLabel:   'ğŸ—£ï¸ I am talking to...',
    male:            'ğŸ‘¨ Male',
    female:          'ğŸ‘© Female',
    placeholder:     'âœï¸  Type or paste your text here...',
    charsLabel:      'characters',
    translateBtn:    'Translate',
    hint:            'Tip: Press <kbd>Ctrl + Enter</kbd> to translate quickly',
    loading:         'Translatingâ€¦ ğŸŒ',
    resultsHeader:   'âœ¨ Translations',
    formalLabel:     'ğŸ© Formal',
    casualLabel:     'ğŸ˜Š Casual',
    altLabel:        'ğŸ’¡ Alternative',
    breakdownTitle:  'ğŸ“š Word & Phrase Breakdown â€” for learning',
    thType:          'Type',
    thOrig:          'Original',
    thTrans:         'Translation',
    thNotes:         'Notes',
    analysing:       'ğŸ” Analysingâ€¦',
    noBreakdown:     'No breakdown available for this text.',
    noText:          'âœï¸ Please type some text first!',
    copied:          'ğŸ“‹ Copied!',
    tagVerb:         'Verb',
    tagNoun:         'Noun',
    tagAdj:          'Adj',
    tagAdv:          'Adverb',
    tagPhrase:       'Phrase',
    noteVerb:        'ğŸ‘© fem. form applied',
    noteNoun:        'ğŸ“Œ memorise gender!',
    notePhrase:      'ğŸ’¬ Common phrase',
    formalNoteEnRu:  'ğŸ© Uses "Ğ’Ñ‹" â€” polite address',
    casualNoteEnRu:  'ğŸ˜Š Uses "Ñ‚Ñ‹" â€” friendly / informal',
    altNoteEnRu:     'ğŸ’¡ Alternative phrasing',
    formalNoteRuEn:  'ğŸ© Direct translation',
    casualNoteRuEn:  'ğŸ˜Š From casual Russian form',
    altNoteRuEn:     'ğŸ’¡ Simplified version',
    errText:         'âŒ Translation failed â€” check your connection.',
  },
  'ru-en': {
    speakerLabel:    'ğŸ‘¤ Ğ¯ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ ĞºĞ°Ğº...',
    listenerLabel:   'ğŸ—£ï¸ Ğ¯ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ°Ñ€Ğ¸Ğ²Ğ°Ñ Ñ...',
    male:            'ğŸ‘¨ ĞœÑƒĞ¶Ñ‡Ğ¸Ğ½Ğ°',
    female:          'ğŸ‘© Ğ–ĞµĞ½Ñ‰Ğ¸Ğ½Ğ°',
    placeholder:     'âœï¸  Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ·Ğ´ĞµÑÑŒ...',
    charsLabel:      'ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²',
    translateBtn:    'ĞŸĞµÑ€ĞµĞ²ĞµÑÑ‚Ğ¸',
    hint:            'Ğ¡Ğ¾Ğ²ĞµÑ‚: ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ <kbd>Ctrl + Enter</kbd> Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°',
    loading:         'ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ğ¼â€¦ ğŸŒ',
    resultsHeader:   'âœ¨ ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹',
    formalLabel:     'ğŸ© ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹',
    casualLabel:     'ğŸ˜Š ĞĞµÑ„Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹',
    altLabel:        'ğŸ’¡ ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹',
    breakdownTitle:  'ğŸ“š Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ ÑĞ»Ğ¾Ğ² Ğ¸ Ñ„Ñ€Ğ°Ğ· â€” Ğ´Ğ»Ñ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ',
    thType:          'Ğ¢Ğ¸Ğ¿',
    thOrig:          'ĞÑ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»',
    thTrans:         'ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´',
    thNotes:         'Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ¸',
    analysing:       'ğŸ” ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼â€¦',
    noBreakdown:     'Ğ Ğ°Ğ·Ğ±Ğ¾Ñ€ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ° Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½.',
    noText:          'âœï¸ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚!',
    copied:          'ğŸ“‹ Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!',
    tagVerb:         'Ğ“Ğ»Ğ°Ğ³Ğ¾Ğ»',
    tagNoun:         'Ğ¡ÑƒÑ‰ĞµÑÑ‚.',
    tagAdj:          'ĞŸÑ€Ğ¸Ğ»Ğ°Ğ³.',
    tagAdv:          'ĞĞ°Ñ€ĞµÑ‡Ğ¸Ğµ',
    tagPhrase:       'Ğ¤Ñ€Ğ°Ğ·Ğ°',
    noteVerb:        'ğŸ‘© Ğ¶ĞµĞ½ÑĞºĞ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°',
    noteNoun:        'ğŸ“Œ Ğ·Ğ°Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ Ñ€Ğ¾Ğ´!',
    notePhrase:      'ğŸ’¬ Ğ£ÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾Ğµ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ',
    formalNoteEnRu:  'ğŸ© Uses "Ğ’Ñ‹" â€” polite address',
    casualNoteEnRu:  'ğŸ˜Š Uses "Ñ‚Ñ‹" â€” friendly / informal',
    altNoteEnRu:     'ğŸ’¡ Alternative phrasing',
    formalNoteRuEn:  'ğŸ© ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´',
    casualNoteRuEn:  'ğŸ˜Š Ğ˜Ğ· Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ñ‹',
    altNoteRuEn:     'ğŸ’¡ Ğ£Ğ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
    errText:         'âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ.',
  }
};

function t(key) { return LANG[direction][key] || LANG['en-ru'][key]; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPDATE ALL UI TEXT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateUI() {
  const L = LANG[direction];
  document.getElementById('speakerLabel').textContent   = L.speakerLabel;
  document.getElementById('listenerLabel').textContent  = L.listenerLabel;
  document.getElementById('maleLabel1').textContent     = L.male;
  document.getElementById('femaleLabel1').textContent   = L.female;
  document.getElementById('maleLabel2').textContent     = L.male;
  document.getElementById('femaleLabel2').textContent   = L.female;
  document.getElementById('inputText').placeholder      = L.placeholder;
  document.getElementById('charsLabel').textContent     = L.charsLabel;
  document.getElementById('translateBtnText').textContent = L.translateBtn;
  document.getElementById('hintText').innerHTML         = 'Tip: Press <kbd>Ctrl + Enter</kbd> to translate quickly'.replace(
    'Tip: Press', direction === 'ru-en' ? 'Ğ¡Ğ¾Ğ²ĞµÑ‚: ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ' : 'Tip: Press'
  ).replace('to translate quickly', direction === 'ru-en' ? 'Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°' : 'to translate quickly');
  document.getElementById('loadingText').textContent    = L.loading;
  document.getElementById('resultsHeader').textContent  = L.resultsHeader;
  document.getElementById('formalLabel').textContent    = L.formalLabel;
  document.getElementById('casualLabel').textContent    = L.casualLabel;
  document.getElementById('altLabel').textContent       = L.altLabel;
  document.getElementById('breakdownTitle').textContent = L.breakdownTitle;
  document.getElementById('thType').textContent         = L.thType;
  document.getElementById('thOrig').textContent         = L.thOrig;
  document.getElementById('thTrans').textContent        = L.thTrans;
  document.getElementById('thNotes').textContent        = L.thNotes;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function countChars() {
  document.getElementById('charNum').textContent =
    document.getElementById('inputText').value.length;
}

function swapDirection() {
  direction = direction === 'en-ru' ? 'ru-en' : 'en-ru';
  document.getElementById('srcPill').textContent   = direction === 'en-ru' ? 'ğŸ‡¬ğŸ‡§ English' : 'ğŸ‡·ğŸ‡º Russian';
  document.getElementById('tgtPill').textContent   = direction === 'en-ru' ? 'ğŸ‡·ğŸ‡º Russian' : 'ğŸ‡¬ğŸ‡§ English';
  document.getElementById('srcPill').classList.add('active-lang');
  document.getElementById('tgtPill').classList.remove('active-lang');
  document.getElementById('results').classList.remove('show');
  document.getElementById('inputText').value = '';
  countChars();
  updateUI();
}

function setGender(role, val) {
  if (role === 'speaker') {
    speakerGend = val;
    document.getElementById('sp-m').classList.toggle('on', val === 'male');
    document.getElementById('sp-f').classList.toggle('on', val === 'female');
  } else {
    listenerGend = val;
    document.getElementById('ls-m').classList.toggle('on', val === 'male');
    document.getElementById('ls-f').classList.toggle('on', val === 'female');
  }
}

function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg || t('copied');
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 1800);
}

async function copyCard(id) {
  const text = document.getElementById(id).textContent;
  try { await navigator.clipboard.writeText(text); }
  catch {
    const ta = Object.assign(document.createElement('textarea'), { value: text });
    document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
  }
  showToast(t('copied'));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function fetchMM(text, lp) {
  const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${lp}`;
  const r = await fetch(url);
  const d = await r.json();
  if (d.responseStatus === 200) return d.responseData.translatedText;
  throw new Error('API error ' + d.responseStatus);
}

const delay = ms => new Promise(res => setTimeout(res, ms));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RUSSIAN GRAMMAR HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TY_TO_VY = [
  [/\bÑ‚Ñ‹\b/g,'Ğ’Ñ‹'],[/\bÑ‚ĞµĞ±Ñ\b/g,'Ğ’Ğ°Ñ'],[/\bÑ‚ĞµĞ±Ğµ\b/g,'Ğ’Ğ°Ğ¼'],
  [/\bÑ‚Ğ¾Ğ±Ğ¾Ğ¹\b/g,'Ğ’Ğ°Ğ¼Ğ¸'],[/\bÑ‚Ğ²Ğ¾Ğ¹\b/g,'Ğ’Ğ°Ñˆ'],[/\bÑ‚Ğ²Ğ¾Ñ\b/g,'Ğ’Ğ°ÑˆĞ°'],
  [/\bÑ‚Ğ²Ğ¾Ñ‘\b/g,'Ğ’Ğ°ÑˆĞµ'],[/\bÑ‚Ğ²Ğ¾Ğ¸\b/g,'Ğ’Ğ°ÑˆĞ¸'],[/\bÑ‚Ğ²Ğ¾ĞµĞ³Ğ¾\b/g,'Ğ’Ğ°ÑˆĞµĞ³Ğ¾'],
  [/\bÑ‚Ğ²Ğ¾ĞµĞ¹\b/g,'Ğ’Ğ°ÑˆĞµĞ¹'],[/\bÑ‚Ğ²Ğ¾ĞµĞ¼Ñƒ\b/g,'Ğ’Ğ°ÑˆĞµĞ¼Ñƒ'],
];
const VY_TO_TY = [
  [/\bĞ’Ñ‹\b/g,'Ñ‚Ñ‹'],[/\bĞ’Ğ°Ñ\b/g,'Ñ‚ĞµĞ±Ñ'],[/\bĞ’Ğ°Ğ¼\b/g,'Ñ‚ĞµĞ±Ğµ'],
  [/\bĞ’Ğ°Ğ¼Ğ¸\b/g,'Ñ‚Ğ¾Ğ±Ğ¾Ğ¹'],[/\bĞ’Ğ°Ñˆ\b/g,'Ñ‚Ğ²Ğ¾Ğ¹'],[/\bĞ’Ğ°ÑˆĞ°\b/g,'Ñ‚Ğ²Ğ¾Ñ'],
  [/\bĞ’Ğ°ÑˆĞµ\b/g,'Ñ‚Ğ²Ğ¾Ñ‘'],[/\bĞ’Ğ°ÑˆĞ¸\b/g,'Ñ‚Ğ²Ğ¾Ğ¸'],[/\bĞ’Ğ°ÑˆĞµĞ³Ğ¾\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ³Ğ¾'],
  [/\bĞ’Ğ°ÑˆĞµĞ¹\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ¹'],[/\bĞ’Ğ°ÑˆĞµĞ¼Ñƒ\b/g,'Ñ‚Ğ²Ğ¾ĞµĞ¼Ñƒ'],
];
const GENDER_MAP_F = [
  [/\bĞ¿Ñ€Ğ¸ÑˆÑ‘Ğ»\b/g,'Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ°'],[/\bÑƒÑˆÑ‘Ğ»\b/g,'ÑƒÑˆĞ»Ğ°'],[/\bĞ½Ğ°ÑˆÑ‘Ğ»\b/g,'Ğ½Ğ°ÑˆĞ»Ğ°'],
  [/\bĞ±Ñ‹Ğ»\b/g,'Ğ±Ñ‹Ğ»Ğ°'],[/\bÑĞºĞ°Ğ·Ğ°Ğ»\b/g,'ÑĞºĞ°Ğ·Ğ°Ğ»Ğ°'],[/\bĞ¿Ğ¾ĞµÑ…Ğ°Ğ»\b/g,'Ğ¿Ğ¾ĞµÑ…Ğ°Ğ»Ğ°'],
  [/\bĞ¿Ñ€Ğ¸ĞµÑ…Ğ°Ğ»\b/g,'Ğ¿Ñ€Ğ¸ĞµÑ…Ğ°Ğ»Ğ°'],[/\bÑĞ´ĞµĞ»Ğ°Ğ»\b/g,'ÑĞ´ĞµĞ»Ğ°Ğ»Ğ°'],[/\bĞ¿Ğ¾ÑˆÑ‘Ğ»\b/g,'Ğ¿Ğ¾ÑˆĞ»Ğ°'],
  [/\bÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»\b/g,'Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ°'],[/\bĞ·Ğ½Ğ°Ğ»\b/g,'Ğ·Ğ½Ğ°Ğ»Ğ°'],[/\bĞ´ÑƒĞ¼Ğ°Ğ»\b/g,'Ğ´ÑƒĞ¼Ğ°Ğ»Ğ°'],
  [/\bÑ…Ğ¾Ñ‚ĞµĞ»\b/g,'Ñ…Ğ¾Ñ‚ĞµĞ»Ğ°'],[/\bĞ¼Ğ¾Ğ³\b/g,'Ğ¼Ğ¾Ğ³Ğ»Ğ°'],[/\bÑƒÑÑ‚Ğ°Ğ»\b/g,'ÑƒÑÑ‚Ğ°Ğ»Ğ°'],
  [/\bÑ€Ğ°Ğ´\b/g,'Ñ€Ğ°Ğ´Ğ°'],[/\bĞ¿Ğ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ğ»\b/g,'Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ½Ğ¸Ğ»Ğ°'],[/\bÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ»\b/g,'ÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ»Ğ°'],
  [/\bĞ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»\b/g,'Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ»Ğ°'],[/\bÑ€ĞµÑˆĞ¸Ğ»\b/g,'Ñ€ĞµÑˆĞ¸Ğ»Ğ°'],[/\bĞ½Ğ°Ñ‡Ğ°Ğ»\b/g,'Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°'],
  [/\bĞ¿Ğ¾Ğ½ÑĞ»\b/g,'Ğ¿Ğ¾Ğ½ÑĞ»Ğ°'],[/\bĞ²Ğ·ÑĞ»\b/g,'Ğ²Ğ·ÑĞ»Ğ°'],[/\bĞ´Ğ°Ğ»\b/g,'Ğ´Ğ°Ğ»Ğ°'],
];
const LISTENER_F_MAP = [
  [/\bĞ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾Ğ¹\b/g,'Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°Ñ'],[/\bÑƒĞ²Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğ¹\b/g,'ÑƒĞ²Ğ°Ğ¶Ğ°ĞµĞ¼Ğ°Ñ'],[/\bĞ¼Ğ¸Ğ»Ñ‹Ğ¹\b/g,'Ğ¼Ğ¸Ğ»Ğ°Ñ'],
];

function applyMap(text, map) {
  let out = text;
  map.forEach(([re, rep]) => { out = out.replace(re, rep); });
  return out;
}
function makeFormal(text)            { return applyMap(text, TY_TO_VY); }
function makeCasual(text)            { return applyMap(text, VY_TO_TY); }
function applyGender(text, g)        { return g === 'female' ? applyMap(text, GENDER_MAP_F) : text; }
function applyListenerGender(text,g) { return g === 'female' ? applyMap(text, LISTENER_F_MAP) : text; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORD BREAKDOWN HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EN_STOP = new Set(['the','a','an','in','on','at','to','for','of','and','or','but',
  'is','it','i','my','me','you','your','he','she','we','they','this','that','with',
  'from','not','are','was','were','be','have','has','had','do','does','did','will',
  'would','could','should','may','might','shall','as','by','up','if','so','no','yes',
  'just','also','very','more','about']);
const RU_STOP = new Set(['Ğ¸','Ğ²','Ğ½Ğ°','Ñ','Ğ¿Ğ¾','Ğ´Ğ»Ñ','Ğ¾Ñ‚','Ğ¸Ğ·','Ğº','Ğ°','Ğ½Ğ¾','Ñ‡Ñ‚Ğ¾','ÑÑ‚Ğ¾',
  'Ñ','Ñ‚Ñ‹','Ğ¾Ğ½','Ğ¾Ğ½Ğ°','Ğ¼Ñ‹','Ğ²Ñ‹','Ğ¾Ğ½Ğ¸','Ğ½Ğµ','Ğ´Ğ°','Ğ½ĞµÑ‚','Ğ¶Ğµ','ÑƒĞ¶Ğµ','ĞºĞ°Ğº','Ñ‚Ğ°Ğº','Ğ±Ñ‹',
  'Ğ»Ğ¸','Ğ¸Ğ»Ğ¸','Ñ‚Ğ¾','Ğ²ÑÑ‘','Ñ‚Ğ°Ğ¼','Ñ‚ÑƒÑ‚','ĞµÑ‰Ñ‘','Ğ²Ğ¾Ñ‚']);

function detectType(word) {
  const w = word.toLowerCase();
  const isRu = /[Ğ°-ÑÑ‘]/i.test(w);
  if (!isRu) {
    if (['is','are','was','were','be','have','has','had','do','does','did','go','went',
         'come','came','want','like','love','need','know','think','see','look','say',
         'tell','ask','work','live','feel','seem','call','get','put','give','take',
         'make','let','run','turn','help','try','use','keep','play','move','hear',
         'speak','write','read','meet'].includes(w)
      || w.endsWith('ing') || w.endsWith('ate') || w.endsWith('ify')) return 'verb';
    if (w.endsWith('ly')) return 'adverb';
    if (w.endsWith('ful')||w.endsWith('less')||w.endsWith('ous')||w.endsWith('ive')||w.endsWith('al')) return 'adj';
  } else {
    if (w.endsWith('Ñ‚ÑŒ')||w.endsWith('Ñ‚ÑÑ')||w.endsWith('Ñ‚ÑŒÑÑ')||w.endsWith('ĞµÑ‚')||w.endsWith('ÑÑ‚')||w.endsWith('Ğ°Ñ‚ÑŒ')) return 'verb';
    if (w.endsWith('Ğ½Ğ¾')||w.endsWith('ĞºĞ¾')||w.endsWith('ÑĞºĞ¸')) return 'adverb';
    if (w.endsWith('Ñ‹Ğ¹')||w.endsWith('Ğ¸Ğ¹')||w.endsWith('Ğ¾Ğ¹')||w.endsWith('Ğ°Ñ')||w.endsWith('ÑÑ')) return 'adj';
  }
  return 'noun';
}

function getTagConfig() {
  return {
    verb:   { emoji: 'âš¡', css: 'tag-verb',   label: t('tagVerb')   },
    noun:   { emoji: 'ğŸ“¦', css: 'tag-noun',   label: t('tagNoun')   },
    adj:    { emoji: 'ğŸ¨', css: 'tag-adj',    label: t('tagAdj')    },
    adverb: { emoji: 'ğŸ’¨', css: 'tag-adv',    label: t('tagAdv')    },
    phrase: { emoji: 'ğŸ’¬', css: 'tag-phrase', label: t('tagPhrase') },
  };
}

function extractWords(text) {
  const stop = direction === 'ru-en' ? RU_STOP : EN_STOP;
  return [...new Set(
    text.split(/\s+/)
      .map(w => w.replace(/[^a-zA-ZĞ°-ÑÑ‘Ğ-Ğ¯Ğ]/g,'').toLowerCase())
      .filter(w => w.length > 3 && !stop.has(w))
  )].slice(0, 6);
}

function extractPhrases(text) {
  const words = text.trim().split(/\s+/);
  const phrases = [];
  for (let i = 0; i < Math.min(words.length - 1, 4); i++) {
    const p = words[i] + ' ' + words[i+1];
    if (p.replace(/[^a-zA-ZĞ°-ÑÑ‘Ğ-Ğ¯Ğ]/g,'').length > 5) phrases.push(p);
  }
  return phrases.slice(0, 2);
}

function genderNote(type) {
  if (direction !== 'en-ru') return '';
  if (type === 'verb' && speakerGend === 'female') return t('noteVerb');
  if (type === 'noun') return t('noteNoun');
  return '';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN TRANSLATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function doTranslate() {
  const input = document.getElementById('inputText').value.trim();
  if (!input) { showToast(t('noText')); return; }

  const btn = document.getElementById('translateBtn');
  btn.disabled = true;
  document.getElementById('translateBtnText').textContent = 'â³ ' + t('translateBtn') + 'â€¦';

  document.getElementById('loading').classList.add('show');
  document.getElementById('results').classList.remove('show');

  try {
    const lp = direction === 'en-ru' ? 'en|ru' : 'ru|en';
    let base = await fetchMM(input, lp);
    let formal, casual, alt;

    if (direction === 'en-ru') {
      base   = applyGender(base, speakerGend);
      base   = applyListenerGender(base, listenerGend);
      formal = makeFormal(base);
      casual = makeCasual(base);

      await delay(400);
      const altInput = input
        .replace(/\bI would like\b/gi, 'I want')
        .replace(/\bCould you\b/gi, 'Can you')
        .replace(/\bplease\b/gi, '').trim();
      alt = await fetchMM(altInput !== input ? altInput : input, lp);
      alt = applyGender(alt, speakerGend);
      if (alt.toLowerCase() === base.toLowerCase()) {
        await delay(300);
        alt = await fetchMM('In other words: ' + input, lp);
      }

      document.getElementById('formalNote').textContent = t('formalNoteEnRu');
      document.getElementById('casualNote').textContent = t('casualNoteEnRu');
      document.getElementById('altNote').textContent    = t('altNoteEnRu');
    } else {
      formal = base;
      await delay(400);
      casual = await fetchMM(makeCasual(input), lp);
      if (casual.toLowerCase() === formal.toLowerCase()) casual = base + ' (informal)';
      await delay(300);
      alt = await fetchMM('Simply put: ' + input, lp);
      if (alt.toLowerCase() === formal.toLowerCase()) alt = formal;

      document.getElementById('formalNote').textContent = t('formalNoteRuEn');
      document.getElementById('casualNote').textContent = t('casualNoteRuEn');
      document.getElementById('altNote').textContent    = t('altNoteRuEn');
    }

    document.getElementById('formalText').textContent = formal;
    document.getElementById('casualText').textContent = casual;
    document.getElementById('altText').textContent    = alt;

    document.getElementById('loading').classList.remove('show');
    document.getElementById('results').classList.add('show');

    await buildBreakdown(input, lp);

  } catch (err) {
    document.getElementById('loading').classList.remove('show');
    document.getElementById('results').classList.add('show');
    document.getElementById('formalText').textContent = t('errText');
    document.getElementById('casualText').textContent = '';
    document.getElementById('altText').textContent    = '';
    document.getElementById('breakdownBody').innerHTML =
      `<tr><td colspan="4" style="padding:14px 18px; color:#ef4444;">Error: ${err.message}</td></tr>`;
    console.error(err);
  }

  btn.disabled = false;
  document.getElementById('translateBtnText').textContent = t('translateBtn');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BREAKDOWN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function buildBreakdown(input, lp) {
  const tbody = document.getElementById('breakdownBody');
  tbody.innerHTML = `<tr><td colspan="4" style="padding:14px 18px; color:#b0bcd8;">${t('analysing')}</td></tr>`;

  const words   = extractWords(input);
  const phrases = extractPhrases(input);
  const rows    = [];

  for (const w of words) {
    try {
      await delay(220);
      const tr = await fetchMM(w, lp);
      const type = detectType(w);
      rows.push({ type, orig: w, trans: tr, note: genderNote(type) });
    } catch { /* skip */ }
  }
  for (const ph of phrases) {
    try {
      await delay(250);
      const tr = await fetchMM(ph, lp);
      rows.push({ type: 'phrase', orig: ph, trans: tr, note: t('notePhrase') });
    } catch { /* skip */ }
  }

  tbody.innerHTML = '';
  if (!rows.length) {
    tbody.innerHTML = `<tr><td colspan="4" style="padding:14px 18px; color:#b0bcd8;">${t('noBreakdown')}</td></tr>`;
    return;
  }

  const TAG = getTagConfig();
  rows.forEach(({ type, orig, trans, note }) => {
    const cfg = TAG[type] || TAG.noun;
    const tr  = document.createElement('tr');
    tr.innerHTML = `
      <td><span class="tag ${cfg.css}">${cfg.emoji} ${cfg.label}</span></td>
      <td class="orig-word">${orig}</td>
      <td class="trans-word">${trans}</td>
      <td class="note-cell">${note}</td>`;
    tbody.appendChild(tr);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD SHORTCUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('keydown', e => {
  if (e.ctrlKey && e.key === 'Enter') doTranslate();
});
</script>

</body>
</html>
