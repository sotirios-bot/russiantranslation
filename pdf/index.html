<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-NRZ5N9GV');</script>
  <!-- End Google Tag Manager -->

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5220550180754289"
       crossorigin="anonymous"></script>

  <title>PDF & Word Translator â€” English â†” Russian | Mytheon Technologies</title>
  <meta name="description" content="Upload a PDF or Word document in English or Russian and download the translation instantly. Free online document translator â€” no signup, no limits."/>
  <link rel="canonical" href="https://englishtorussian.ai/pdf/"/>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: ['selector', '[data-theme="dark"]'],
      theme: {
        extend: {
          colors: {
            primary: { DEFAULT: '#2253cb', dark: '#1a40a8' }
          }
        }
      }
    }
  </script>

  <style>
    /* JS-toggled classes that Tailwind can't handle via utilities */
    .active-lang {
      border-color: #2253cb !important;
      background-color: #eaf0ff !important;
      color: #2253cb !important;
    }
    [data-theme="dark"] .active-lang {
      border-color: #5b85f5 !important;
      background-color: rgba(91,133,245,0.15) !important;
      color: #7599ff !important;
    }
    .drop-zone.dragover {
      border-color: #2253cb;
      background-color: #eaf0ff;
    }
    [data-theme="dark"] .drop-zone.dragover {
      border-color: #5b85f5;
      background-color: rgba(91,133,245,0.12);
    }
    #progressFill { transition: width 0.4s ease; }
    #toast.show  { opacity: 1 !important; transform: translateY(0) !important; }
    .swap-btn    { transition: transform 0.35s ease, background-color 0.2s; }
    .swap-btn:hover { transform: rotate(180deg); }
    /* Prevent body scroll-x on mobile */
    body { overflow-x: hidden; }
  </style>
</head>

<body data-theme="light"
      class="bg-slate-100 dark:bg-slate-900 min-h-screen text-slate-800 dark:text-slate-100 transition-colors duration-300">

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NRZ5N9GV"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- â•â•â• WRAPPER â•â•â• -->
<div class="max-w-2xl mx-auto px-4 pb-16">

  <!-- â•â•â• TOP BAR â•â•â• -->
  <div class="flex items-center justify-between pt-4 pb-0 gap-2 flex-wrap">
    <a href="/"
       class="flex items-center gap-1.5 text-sm font-semibold text-blue-600 dark:text-blue-400
              border border-slate-200 dark:border-slate-700 rounded-full px-3 py-1.5
              bg-white dark:bg-slate-800 hover:bg-blue-50 dark:hover:bg-slate-700
              hover:border-blue-400 transition-all no-underline">
      â† Text Translator
    </a>
    <button id="themeBtn" onclick="toggleTheme()"
            class="flex items-center gap-1.5 text-sm font-medium text-slate-500 dark:text-slate-400
                   border border-slate-200 dark:border-slate-700 rounded-full px-3 py-1.5
                   bg-white dark:bg-slate-800 hover:bg-blue-50 hover:border-blue-400
                   hover:text-blue-600 transition-all cursor-pointer">
      ğŸŒ™ Dark
    </button>
  </div>

  <!-- â•â•â• HEADER â•â•â• -->
  <header class="text-center py-8">
    <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-600 dark:text-blue-400 tracking-tight leading-tight">
      ğŸ“„ PDF &amp; Word Translator
    </h1>
    <p class="text-slate-500 dark:text-slate-400 mt-3 text-sm sm:text-base leading-relaxed max-w-sm mx-auto">
      Upload a PDF or .docx â€” we extract, translate, and let you download the result.
    </p>
  </header>

  <!-- â•â•â• DIRECTION TOGGLE â•â•â• -->
  <div class="flex items-center justify-center gap-3 mb-6 flex-wrap">
    <div id="srcPill" onclick="swapDir()"
         class="active-lang flex items-center justify-center gap-2 border-2 font-semibold
                rounded-full px-5 py-2.5 text-sm cursor-pointer flex-1 max-w-[155px]
                transition-all select-none">
      ğŸ‡¬ğŸ‡§ English
    </div>
    <button onclick="swapDir()"
            class="swap-btn bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600
                   text-white rounded-full w-11 h-11 flex items-center justify-center
                   text-lg flex-shrink-0 shadow-md cursor-pointer border-none">
      â‡„
    </button>
    <div id="tgtPill" onclick="swapDir()"
         class="flex items-center justify-center gap-2 border-2 border-slate-200 dark:border-slate-600
                bg-slate-50 dark:bg-slate-800 text-slate-400 dark:text-slate-500 font-semibold
                rounded-full px-5 py-2.5 text-sm cursor-pointer flex-1 max-w-[155px]
                transition-all select-none">
      ğŸ‡·ğŸ‡º Russian
    </div>
  </div>

  <!-- â•â•â• DROP ZONE â•â•â• -->
  <div id="dropZone"
       class="drop-zone border-2 border-dashed border-slate-300 dark:border-slate-600
              rounded-2xl bg-white dark:bg-slate-800 text-center cursor-pointer
              transition-all p-10 sm:p-14 hover:border-blue-500 hover:bg-blue-50
              dark:hover:bg-slate-700 relative mb-4">
    <span class="text-5xl block mb-4">ğŸ“„</span>
    <div class="text-base sm:text-lg font-bold text-slate-700 dark:text-slate-200 mb-1">
      Drop your PDF or Word document here
    </div>
    <div class="text-sm text-slate-400 dark:text-slate-500 mb-5">PDF or .docx â€” max 15 MB</div>
    <button onclick="event.stopPropagation(); document.getElementById('fileInput').click()"
            class="inline-flex items-center gap-2 bg-blue-600 dark:bg-blue-500 hover:bg-blue-700
                   text-white rounded-full px-6 py-2.5 text-sm font-bold shadow
                   hover:-translate-y-0.5 transition-all relative z-10 border-none cursor-pointer">
      ğŸ“‚ Choose file
    </button>
    <input type="file" id="fileInput"
           accept=".pdf,.docx,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
           onchange="handleFileInput(this)"
           class="absolute inset-0 opacity-0 cursor-pointer w-full h-full"/>
  </div>

  <!-- â•â•â• FILE INFO â•â•â• -->
  <div id="fileInfo" style="display:none"
       class="mb-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700
              rounded-xl px-4 py-3 flex items-center gap-3 shadow-sm">
    <span class="text-3xl flex-shrink-0">ğŸ“„</span>
    <div class="flex-1 min-w-0">
      <div id="fileName" class="font-bold text-sm text-slate-700 dark:text-slate-200 truncate"></div>
      <div id="fileMeta" class="text-xs text-slate-400 mt-0.5"></div>
    </div>
    <button onclick="resetAll()"
            class="text-slate-300 hover:text-red-400 text-xl flex-shrink-0 transition-colors
                   bg-transparent border-none cursor-pointer p-1 leading-none">
      âœ•
    </button>
  </div>

  <!-- â•â•â• WARNING (scanned PDF) â•â•â• -->
  <div id="warningBox" style="display:none"
       class="mb-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-300
              dark:border-orange-700 rounded-xl p-3.5 text-sm text-orange-700
              dark:text-orange-400 leading-relaxed">
    âš ï¸ <strong>Low text detected.</strong> This file may be a scanned or image-based PDF.
    Text extraction only works on files with selectable text.
  </div>

  <!-- â•â•â• ERROR â•â•â• -->
  <div id="errorBox" style="display:none"
       class="mb-4 bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700
              rounded-xl p-3.5 text-sm text-red-600 dark:text-red-400 leading-relaxed">
  </div>

  <!-- â•â•â• PROGRESS â•â•â• -->
  <div id="progressArea" style="display:none"
       class="mb-4 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700
              rounded-xl p-5 shadow-sm">
    <div id="progressLabel"
         class="text-sm text-slate-500 dark:text-slate-400 font-medium mb-3">
      Reading fileâ€¦
    </div>
    <div class="bg-slate-100 dark:bg-slate-700 rounded-full h-2.5 overflow-hidden">
      <div id="progressFill"
           class="h-full bg-gradient-to-r from-blue-500 to-blue-700 rounded-full w-0">
      </div>
    </div>
    <div id="progressPct" class="text-xs text-slate-400 mt-2 text-right">0%</div>
  </div>

  <!-- â•â•â• RESULTS â•â•â• -->
  <div id="resultsArea" style="display:none">

    <!-- Stats -->
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4 bg-white dark:bg-slate-800
                border border-slate-200 dark:border-slate-700 rounded-xl p-4 shadow-sm">
      <div class="flex flex-col gap-0.5">
        <span id="statPages" class="text-xl font-extrabold text-blue-600 dark:text-blue-400">-</span>
        <span class="text-xs text-slate-400 uppercase tracking-wide font-semibold">Pages</span>
      </div>
      <div class="flex flex-col gap-0.5">
        <span id="statWords" class="text-xl font-extrabold text-blue-600 dark:text-blue-400">-</span>
        <span class="text-xs text-slate-400 uppercase tracking-wide font-semibold">Words</span>
      </div>
      <div class="flex flex-col gap-0.5">
        <span id="statChars" class="text-xl font-extrabold text-blue-600 dark:text-blue-400">-</span>
        <span class="text-xs text-slate-400 uppercase tracking-wide font-semibold">Chars</span>
      </div>
      <div class="flex flex-col gap-0.5">
        <span id="statChunks" class="text-xl font-extrabold text-blue-600 dark:text-blue-400">-</span>
        <span class="text-xs text-slate-400 uppercase tracking-wide font-semibold">Chunks</span>
      </div>
    </div>

    <!-- Preview panels â€” stacked on mobile, side by side on md+ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">

      <!-- Original -->
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700
                  rounded-2xl overflow-hidden shadow-sm flex flex-col">
        <div class="flex items-center justify-between px-4 py-3 bg-slate-50 dark:bg-slate-700/50
                    border-b border-slate-200 dark:border-slate-700 flex-shrink-0">
          <span id="origLabel"
                class="text-xs font-bold uppercase tracking-widest text-slate-400">
            Original (English)
          </span>
          <button onclick="copyText('origBody')"
                  class="text-xs text-slate-400 border border-slate-200 dark:border-slate-600
                         rounded-lg px-2.5 py-1 hover:border-blue-400 hover:text-blue-600
                         transition-all bg-transparent cursor-pointer">
            ğŸ“‹ Copy
          </button>
        </div>
        <div id="origBody"
             class="p-4 h-52 overflow-y-auto text-sm leading-7 text-slate-700
                    dark:text-slate-300 whitespace-pre-wrap break-words">
        </div>
        <div id="origFoot"
             class="px-4 py-2 bg-slate-50 dark:bg-slate-700/50 border-t border-slate-200
                    dark:border-slate-700 text-xs text-slate-400 flex-shrink-0">
        </div>
      </div>

      <!-- Translated -->
      <div class="bg-white dark:bg-slate-800 border-2 border-blue-200 dark:border-blue-900/60
                  rounded-2xl overflow-hidden shadow-sm flex flex-col">
        <div class="flex items-center justify-between px-4 py-3 bg-blue-50 dark:bg-blue-900/20
                    border-b border-blue-200 dark:border-blue-900/60 flex-shrink-0">
          <span id="transLabel"
                class="text-xs font-bold uppercase tracking-widest text-blue-500 dark:text-blue-400">
            Translation (Russian)
          </span>
          <button onclick="copyText('transBody')"
                  class="text-xs text-blue-500 border border-blue-200 dark:border-blue-700
                         rounded-lg px-2.5 py-1 hover:border-blue-500 hover:bg-blue-50
                         dark:hover:bg-blue-900/30 transition-all bg-transparent cursor-pointer">
            ğŸ“‹ Copy
          </button>
        </div>
        <div id="transBody"
             class="p-4 h-52 overflow-y-auto text-sm leading-7 text-slate-700
                    dark:text-slate-300 whitespace-pre-wrap break-words">
        </div>
        <div id="transFoot"
             class="px-4 py-2 bg-blue-50 dark:bg-blue-900/20 border-t border-blue-200
                    dark:border-blue-900/60 text-xs text-slate-400 flex-shrink-0">
        </div>
      </div>

    </div>

    <!-- Action buttons -->
    <div class="flex flex-col sm:flex-row gap-3 mb-6">
      <button onclick="downloadPDF()"
              class="flex-1 flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700
                     dark:bg-blue-500 dark:hover:bg-blue-600 text-white font-bold rounded-xl
                     py-3.5 px-6 text-sm shadow hover:-translate-y-0.5 transition-all
                     border-none cursor-pointer">
        â¬‡ï¸ Download as PDF
      </button>
      <button onclick="copyText('transBody')"
              class="flex items-center justify-center gap-2 bg-white dark:bg-slate-800
                     hover:bg-blue-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300
                     font-semibold border border-slate-200 dark:border-slate-600
                     hover:border-blue-400 rounded-xl py-3 px-5 text-sm transition-all cursor-pointer">
        ğŸ“‹ Copy translation
      </button>
      <button onclick="resetAll()"
              class="flex items-center justify-center gap-2 bg-white dark:bg-slate-800
                     hover:bg-red-50 dark:hover:bg-slate-700 text-slate-400 dark:text-slate-500
                     hover:text-red-500 font-semibold border border-slate-200 dark:border-slate-600
                     hover:border-red-300 rounded-xl py-3 px-5 text-sm transition-all cursor-pointer">
        ğŸ”„ Translate another
      </button>
    </div>

  </div><!-- /resultsArea -->

  <!-- â•â•â• HOW IT WORKS â•â•â• -->
  <div id="howSection" class="mt-6">
    <div class="text-xs font-bold text-blue-600 dark:text-blue-400 mb-3 uppercase tracking-widest">
      How it works
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700
                  rounded-2xl p-4 flex sm:flex-col items-start sm:items-center
                  sm:text-center gap-3 sm:gap-2 shadow-sm">
        <span class="text-3xl flex-shrink-0">ğŸ“„</span>
        <div>
          <div class="font-bold text-sm text-slate-700 dark:text-slate-200 mb-0.5">Upload your file</div>
          <div class="text-xs text-slate-400 leading-relaxed">PDF or Word (.docx) â€” contracts, emails, reports.</div>
        </div>
      </div>
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700
                  rounded-2xl p-4 flex sm:flex-col items-start sm:items-center
                  sm:text-center gap-3 sm:gap-2 shadow-sm">
        <span class="text-3xl flex-shrink-0">ğŸŒ</span>
        <div>
          <div class="font-bold text-sm text-slate-700 dark:text-slate-200 mb-0.5">We translate it</div>
          <div class="text-xs text-slate-400 leading-relaxed">Text extracted page by page, translated in chunks via Google.</div>
        </div>
      </div>
      <div class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700
                  rounded-2xl p-4 flex sm:flex-col items-start sm:items-center
                  sm:text-center gap-3 sm:gap-2 shadow-sm">
        <span class="text-3xl flex-shrink-0">â¬‡ï¸</span>
        <div>
          <div class="font-bold text-sm text-slate-700 dark:text-slate-200 mb-0.5">Download the result</div>
          <div class="text-xs text-slate-400 leading-relaxed">Save as PDF via your browser's print dialog. Supports all languages.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â• FOOTER â•â•â• -->
  <footer class="text-center pt-6 pb-2 border-t border-slate-200 dark:border-slate-700 mt-8">
    <div class="text-xs font-bold text-blue-600 dark:text-blue-400 uppercase tracking-widest">
      âš¡ Powered by MYTHEON TECHNOLOGIES
    </div>
    <div class="text-xs text-slate-400 mt-1">133/1 Gagarin Avenue, Almaty, Kazakhstan</div>
  </footer>

</div><!-- /wrapper -->

<!-- Toast -->
<div id="toast"
     class="fixed bottom-5 left-4 right-4 sm:left-auto sm:right-5 sm:w-auto
            bg-blue-600 text-white text-sm rounded-xl px-5 py-2.5
            pointer-events-none z-50 text-center shadow-lg
            transition-all duration-300"
     style="opacity:0; transform:translateY(10px)">
</div>

<!-- pdf.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<!-- mammoth.js for .docx -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let direction = 'en-ru';
let currentFile = null;
let extractedText = '';
let translatedTextContent = '';
let totalPages = 0;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF.js SETUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
pdfjsLib.GlobalWorkerOptions.workerSrc =
  'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function() {
  const saved = localStorage.getItem('theme');
  if (saved) document.body.dataset.theme = saved;
  updateThemeBtn();
})();

function toggleTheme() {
  const isDark = document.body.dataset.theme === 'dark';
  document.body.dataset.theme = isDark ? 'light' : 'dark';
  localStorage.setItem('theme', document.body.dataset.theme);
  updateThemeBtn();
}
function updateThemeBtn() {
  const isDark = document.body.dataset.theme === 'dark';
  document.getElementById('themeBtn').textContent = isDark ? 'â˜€ï¸ Light' : 'ğŸŒ™ Dark';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIRECTION TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function swapDir() {
  direction = direction === 'en-ru' ? 'ru-en' : 'en-ru';
  const src = document.getElementById('srcPill');
  const tgt = document.getElementById('tgtPill');
  if (direction === 'en-ru') {
    src.textContent = 'ğŸ‡¬ğŸ‡§ English'; tgt.textContent = 'ğŸ‡·ğŸ‡º Russian';
    src.classList.add('active-lang'); tgt.classList.remove('active-lang');
  } else {
    src.textContent = 'ğŸ‡·ğŸ‡º Russian'; tgt.textContent = 'ğŸ‡¬ğŸ‡§ English';
    src.classList.add('active-lang'); tgt.classList.remove('active-lang');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAG & DROP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const dropZone = document.getElementById('dropZone');

dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (file) handleFile(file);
});
dropZone.addEventListener('click', e => {
  if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'INPUT') {
    document.getElementById('fileInput').click();
  }
});

function handleFileInput(input) {
  if (input.files[0]) handleFile(input.files[0]);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HANDLE FILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getFileType(file) {
  const name = file.name.toLowerCase();
  if (name.endsWith('.pdf') || file.type === 'application/pdf') return 'pdf';
  if (name.endsWith('.docx') || file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') return 'docx';
  return null;
}

function handleFile(file) {
  hideError();
  hide('warningBox');

  const type = getFileType(file);
  if (!type) {
    showError('Please upload a PDF (.pdf) or Word (.docx) file.');
    return;
  }
  if (file.size > 15 * 1024 * 1024) {
    showError('File is too large. Maximum allowed size is 15 MB.');
    return;
  }

  currentFile = file;
  showFileInfo(file, type);
  hide('dropZone');
  hide('resultsArea');
  startProcessing(file, type);
}

function showFileInfo(file, type) {
  document.getElementById('fileName').textContent = file.name;
  const label = type === 'docx' ? 'Word document (.docx)' : 'PDF document';
  document.getElementById('fileMeta').textContent = formatBytes(file.size) + ' â€¢ ' + label;
  show('fileInfo', 'flex');
}

function formatBytes(b) {
  if (b < 1024) return b + ' B';
  if (b < 1024 * 1024) return (b / 1024).toFixed(1) + ' KB';
  return (b / (1024 * 1024)).toFixed(1) + ' MB';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROCESSING PIPELINE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function startProcessing(file, type) {
  show('progressArea');
  hide('resultsArea');
  hide('howSection');
  setProgress(0, type === 'docx' ? 'Reading Word documentâ€¦' : 'Reading PDFâ€¦');

  try {
    const { text, pages } = type === 'docx'
      ? await extractTextFromDocx(file)
      : await extractText(file);
    totalPages = pages;

    if (!text.trim() || text.trim().length < 20) {
      show('warningBox');
      hideProgress();
      return;
    }

    extractedText = text;

    const sl = direction === 'en-ru' ? 'en' : 'ru';
    const tl = direction === 'en-ru' ? 'ru' : 'en';
    setProgress(38, 'Starting translationâ€¦');
    const { translated, chunks } = await translateInChunks(text, sl, tl);
    translatedTextContent = translated;

    setProgress(100, 'Done!');
    await sleep(400);
    hideProgress();
    showResults(text, translated, pages, chunks);

  } catch (err) {
    hideProgress();
    showError('An error occurred: ' + (err.message || err));
    console.error(err);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEXT EXTRACTION (pdf.js)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function extractText(file) {
  const arrayBuffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
  const numPages = pdf.numPages;
  let fullText = '';

  for (let i = 1; i <= numPages; i++) {
    const pct = Math.round((i / numPages) * 35);
    setProgress(pct, `Reading page ${i} of ${numPages}â€¦`);

    const page = await pdf.getPage(i);
    const content = await page.getTextContent();

    let pageText = '';
    let lastY = null;
    for (const item of content.items) {
      if ('str' in item) {
        if (lastY !== null && Math.abs(item.transform[5] - lastY) > 4) {
          pageText += '\n';
        }
        pageText += item.str;
        lastY = item.transform[5];
      }
    }
    fullText += pageText.trim() + '\n\n';
  }

  return { text: fullText.trim(), pages: numPages };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TEXT EXTRACTION (mammoth.js â€” .docx)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function extractTextFromDocx(file) {
  setProgress(10, 'Reading Word documentâ€¦');
  const arrayBuffer = await file.arrayBuffer();
  setProgress(25, 'Extracting text from Word documentâ€¦');

  const result = await mammoth.extractRawText({ arrayBuffer });

  if (result.messages && result.messages.length) {
    console.warn('Mammoth warnings:', result.messages);
  }

  const text = result.value.trim();
  const wordCount = text.split(/\s+/).filter(Boolean).length;
  const estimatedPages = Math.max(1, Math.round(wordCount / 300));

  setProgress(35, 'Text extracted successfullyâ€¦');
  return { text, pages: estimatedPages };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHUNKED TRANSLATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function translateInChunks(text, sl, tl) {
  const MAX = 2000;
  const chunks = [];
  const paragraphs = text.split(/\n{2,}/);
  let current = '';

  for (const para of paragraphs) {
    if (current.length + para.length > MAX && current.trim()) {
      chunks.push(current.trim());
      current = para + '\n\n';
    } else {
      current += para + '\n\n';
    }
  }
  if (current.trim()) chunks.push(current.trim());

  const results = [];
  for (let i = 0; i < chunks.length; i++) {
    const pct = 38 + Math.round(((i + 1) / chunks.length) * 58);
    setProgress(pct, `Translatingâ€¦ ${i + 1} of ${chunks.length} chunk${chunks.length > 1 ? 's' : ''}`);

    try {
      const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sl}&tl=${tl}&dt=t&q=${encodeURIComponent(chunks[i])}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      const result = data[0].map(s => s[0]).join('');
      results.push(result);
    } catch {
      results.push('[Translation error â€” chunk ' + (i + 1) + ']');
    }

    if (i < chunks.length - 1) await sleep(350);
  }

  return { translated: results.join('\n\n'), chunks: chunks.length };
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOW RESULTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showResults(orig, trans, pages, chunks) {
  const sl = direction === 'en-ru' ? 'English' : 'Russian';
  const tl = direction === 'en-ru' ? 'Russian' : 'English';

  document.getElementById('origLabel').textContent = `Original (${sl})`;
  document.getElementById('transLabel').textContent = `Translation (${tl})`;

  document.getElementById('origBody').textContent = orig;
  document.getElementById('transBody').textContent = trans;

  const words = orig.trim().split(/\s+/).length;
  const chars = orig.length;
  document.getElementById('origFoot').textContent =
    `${words.toLocaleString()} words â€¢ ${chars.toLocaleString()} chars`;
  document.getElementById('transFoot').textContent =
    `${trans.trim().split(/\s+/).length.toLocaleString()} words â€¢ ${trans.length.toLocaleString()} chars`;

  document.getElementById('statPages').textContent = pages;
  document.getElementById('statWords').textContent = words.toLocaleString();
  document.getElementById('statChars').textContent = chars.toLocaleString();
  document.getElementById('statChunks').textContent = chunks;

  show('resultsArea');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOWNLOAD AS PDF (print dialog)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function downloadPDF() {
  const sl = direction === 'en-ru' ? 'English' : 'Russian';
  const tl = direction === 'en-ru' ? 'Russian' : 'English';
  const fname = (currentFile?.name || 'document').replace(/\.(pdf|docx)$/i, '');
  const date = new Date().toLocaleDateString('en-GB', { day:'numeric', month:'long', year:'numeric' });
  const words = translatedTextContent.trim().split(/\s+/).length;

  const safe = translatedTextContent
    .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
    .replace(/\n/g, '<br>');

  const win = window.open('', '_blank');
  if (!win) {
    showError('Pop-up blocked. Please allow pop-ups for this site and try again.');
    return;
  }

  win.document.write(`<!DOCTYPE html>
<html lang="${tl === 'Russian' ? 'ru' : 'en'}">
<head>
<meta charset="UTF-8"/>
<title>${escHtml(fname)} â€” Translated ${sl} to ${tl}</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap');
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:'Noto Sans','Segoe UI',Arial,sans-serif;max-width:820px;margin:0 auto;padding:40px 44px;color:#1a1a2e;line-height:1.85;font-size:13.5px;}
  .doc-header{border-bottom:3px solid #2253cb;padding-bottom:18px;margin-bottom:26px;}
  .doc-title{font-size:1.25rem;font-weight:800;color:#2253cb;}
  .doc-meta{font-size:.78rem;color:#777;margin-top:6px;display:flex;gap:18px;flex-wrap:wrap;}
  .badge{display:inline-block;background:#eaf0ff;color:#2253cb;border-radius:20px;padding:2px 10px;font-weight:700;font-size:.72rem;}
  .content{white-space:pre-wrap;word-break:break-word;}
  .doc-footer{margin-top:44px;padding-top:14px;border-top:1px solid #e5e5e5;text-align:center;font-size:.73rem;color:#bbb;}
  .print-btn{position:fixed;bottom:24px;right:24px;background:#2253cb;color:#fff;border:none;border-radius:12px;padding:12px 24px;font-size:.93rem;font-weight:700;cursor:pointer;box-shadow:0 4px 18px rgba(34,83,203,.4);display:flex;align-items:center;gap:7px;transition:all .2s;}
  .print-btn:hover{background:#1a40a8;transform:translateY(-2px);}
  @media print{body{padding:20px 24px;}.print-btn{display:none;}}
</style>
</head>
<body>
<div class="doc-header">
  <div class="doc-title">${escHtml(fname)}</div>
  <div class="doc-meta">
    <span><span class="badge">${sl} â†’ ${tl}</span></span>
    <span>${date}</span>
    <span>${totalPages} page${totalPages !== 1 ? 's' : ''} &nbsp;â€¢&nbsp; ${words.toLocaleString()} words</span>
    <span>englishtorussian.ai</span>
  </div>
</div>
<div class="content">${safe}</div>
<div class="doc-footer">Translated by Mytheon Technologies â€” englishtorussian.ai â€” 133/1 Gagarin Avenue, Almaty, Kazakhstan</div>
<button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ Save as PDF</button>
</body></html>`);
  win.document.close();
  setTimeout(() => { try { win.print(); } catch(e) {} }, 900);
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COPY TEXT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function copyText(elId) {
  const text = document.getElementById(elId).textContent;
  navigator.clipboard.writeText(text).catch(() => {
    const ta = Object.assign(document.createElement('textarea'), { value: text });
    document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
  });
  showToast('ğŸ“‹ Copied to clipboard!');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function resetAll() {
  currentFile = null;
  extractedText = '';
  translatedTextContent = '';
  totalPages = 0;

  const fi = document.getElementById('fileInput');
  fi.value = '';

  hide('fileInfo');
  hide('progressArea');
  hide('resultsArea');
  hide('warningBox');
  hideError();
  show('dropZone', 'block');
  show('howSection', 'block');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setProgress(pct, label) {
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressPct').textContent = pct + '%';
  document.getElementById('progressLabel').textContent = label;
}
function hideProgress() {
  hide('progressArea');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function show(id, display) {
  const el = document.getElementById(id);
  if (el) el.style.display = display || 'block';
}
function hide(id) {
  const el = document.getElementById(id);
  if (el) el.style.display = 'none';
}
function showError(msg) {
  const el = document.getElementById('errorBox');
  el.textContent = 'âŒ ' + msg;
  el.style.display = 'block';
}
function hideError() {
  document.getElementById('errorBox').style.display = 'none';
}
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}
</script>
</body>
</html>
